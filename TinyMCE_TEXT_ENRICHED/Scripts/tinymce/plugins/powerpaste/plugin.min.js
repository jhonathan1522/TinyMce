!function (y) { "use strict"; var n = function (t) { return parseInt(t, 10) }, r = function (t, e, n) { return { major: t, minor: e, patch: n } }, o = function (t) { var e = /([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t); return e ? r(n(e[1]), n(e[2]), n(e[3])) : r(0, 0, 0) }, i = function (t, e) { var n = t - e; return 0 === n ? 0 : 0 < n ? 1 : -1 }, c = function (t, e) { return -1 === function (t, e) { var n = i(t.major, e.major); if (0 !== n) return n; var r = i(t.minor, e.minor); if (0 !== r) return r; var o = i(t.patch, e.patch); return 0 !== o ? o : 0 }((n = t) ? o([(r = n).majorVersion, r.minorVersion].join(".").split(".").slice(0, 3).join(".")) : null, o(e)); var n, r }, C = function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e] }, g = function (n, r) { return function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; return n(r.apply(null, t)) } }, v = function (t) { return function () { return t } }, l = function (t) { return t }; function N(r) { for (var o = [], t = 1; t < arguments.length; t++)o[t - 1] = arguments[t]; return function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; var n = o.concat(t); return r.apply(null, n) } } var t, e, a, u, s, f = function (t) { return function () { throw new Error(t) } }, d = v(!1), m = v(!0), p = d, h = m, b = function () { return x }, x = (u = { fold: function (t, e) { return t() }, is: p, isSome: p, isNone: h, getOr: a = function (t) { return t }, getOrThunk: e = function (t) { return t() }, getOrDie: function (t) { throw new Error(t || "error: getOrDie called on none.") }, getOrNull: function () { return null }, getOrUndefined: function () { }, or: a, orThunk: e, map: b, ap: b, each: function () { }, bind: b, flatten: b, exists: p, forall: h, filter: b, equals: t = function (t) { return t.isNone() }, equals_: t, toArray: function () { return [] }, toString: v("none()") }, Object.freeze && Object.freeze(u), u), T = function (n) { var t = function () { return n }, e = function () { return o }, r = function (t) { return t(n) }, o = { fold: function (t, e) { return e(n) }, is: function (t) { return n === t }, isSome: h, isNone: p, getOr: t, getOrThunk: t, getOrDie: t, getOrNull: t, getOrUndefined: t, or: e, orThunk: e, map: function (t) { return T(t(n)) }, ap: function (t) { return t.fold(b, function (t) { return T(t(n)) }) }, each: function (t) { t(n) }, bind: r, flatten: t, exists: r, forall: r, filter: function (t) { return t(n) ? o : x }, equals: function (t) { return t.is(n) }, equals_: function (t, e) { return t.fold(p, function (t) { return e(n, t) }) }, toArray: function () { return [n] }, toString: function () { return "some(" + n + ")" } }; return o }, D = { some: T, none: b, from: function (t) { return null == t ? x : T(t) } }, E = function (e) { return function (t) { return function (t) { if (null === t) return "null"; var e = typeof t; return "object" === e && Array.prototype.isPrototypeOf(t) ? "array" : "object" === e && String.prototype.isPrototypeOf(t) ? "string" : e }(t) === e } }, w = E("string"), I = E("object"), S = E("array"), L = E("boolean"), O = E("function"), A = E("number"), _ = void 0 === (s = Array.prototype.indexOf) ? function (t, e) { return Y(t, e) } : function (t, e) { return s.call(t, e) }, P = function (t, e) { return -1 < _(t, e) }, k = function (t, e) { return B(t, e).isSome() }, M = function (t, e) { for (var n = t.length, r = new Array(n), o = 0; o < n; o++) { var i = t[o]; r[o] = e(i, o, t) } return r }, R = function (t, e) { for (var n = 0, r = t.length; n < r; n++)e(t[n], n, t) }, F = function (t, e) { for (var n = [], r = 0, o = t.length; r < o; r++) { var i = t[r]; e(i, r, t) && n.push(i) } return n }, j = function (t, e, n) { return R(t, function (t) { n = e(n, t) }), n }, U = function (t, e) { for (var n = 0, r = t.length; n < r; n++) { var o = t[n]; if (e(o, n, t)) return D.some(o) } return D.none() }, B = function (t, e) { for (var n = 0, r = t.length; n < r; n++)if (e(t[n], n, t)) return D.some(n); return D.none() }, Y = function (t, e) { for (var n = 0, r = t.length; n < r; ++n)if (t[n] === e) return n; return -1 }, H = Array.prototype.push, W = function (t) { for (var e = [], n = 0, r = t.length; n < r; ++n) { if (!Array.prototype.isPrototypeOf(t[n])) throw new Error("Arr.flatten item " + n + " was not an array, input: " + t); H.apply(e, t[n]) } return e }, q = function (t, e) { var n = M(t, e); return W(n) }, $ = function (t, e) { for (var n = 0, r = t.length; n < r; ++n)if (!0 !== e(t[n], n, t)) return !1; return !0 }, V = Array.prototype.slice, X = (O(Array.from) && Array.from, function (t) { var n = D.none(), e = [], r = function (t) { o() ? a(t) : e.push(t) }, o = function () { return n.isSome() }, i = function (t) { R(t, a) }, a = function (e) { n.each(function (t) { setTimeout(function () { e(t) }, 0) }) }; return t(function (t) { n = D.some(t), i(e), e = [] }), { get: r, map: function (n) { return X(function (e) { r(function (t) { e(n(t)) }) }) }, isReady: o } }), G = { nu: X, pure: function (e) { return X(function (t) { t(e) }) } }, z = function (e) { var t = function (t) { var r; e((r = t, function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; var n = this; setTimeout(function () { r.apply(n, t) }, 0) })) }, n = function () { return G.nu(t) }; return { map: function (r) { return z(function (n) { t(function (t) { var e = r(t); n(e) }) }) }, bind: function (n) { return z(function (e) { t(function (t) { n(t).get(e) }) }) }, anonBind: function (n) { return z(function (e) { t(function (t) { n.get(e) }) }) }, toLazy: n, toCached: function () { var e = null; return z(function (t) { null === e && (e = n()), e.get(t) }) }, get: t } }, K = { nu: z, pure: function (e) { return z(function (t) { t(e) }) } }, Z = function (a, t) { return t(function (r) { var o = [], i = 0; 0 === a.length ? r([]) : R(a, function (t, e) { var n; t.get((n = e, function (t) { o[n] = t, ++i >= a.length && r(o) })) }) }) }, J = function (t) { return Z(t, K.nu) }, Q = function (t, e) { var n = M(t, e); return J(n) }, tt = Object.keys, et = function (t, e) { for (var n = tt(t), r = 0, o = n.length; r < o; r++) { var i = n[r]; e(t[i], i, t) } }, nt = function (t, r) { return rt(t, function (t, e, n) { return { k: e, v: r(t, e, n) } }) }, rt = function (r, o) { var i = {}; return et(r, function (t, e) { var n = o(t, e, r); i[n.k] = n.v }), i }, ot = function (t) { return n = function (t) { return t }, r = [], et(t, function (t, e) { r.push(n(t, e)) }), r; var n, r }, it = function (t) { return tt(t).length }, at = function (a) { if (!S(a)) throw new Error("cases must be an array"); if (0 === a.length) throw new Error("there must be at least one case"); var u = [], n = {}; return R(a, function (t, r) { var e = tt(t); if (1 !== e.length) throw new Error("one and only one name per case"); var o = e[0], i = t[o]; if (void 0 !== n[o]) throw new Error("duplicate key detected:" + o); if ("cata" === o) throw new Error("cannot have a case named cata (sorry)"); if (!S(i)) throw new Error("case arguments must be an array"); u.push(o), n[o] = function () { var t = arguments.length; if (t !== i.length) throw new Error("Wrong number of arguments to case " + o + ". Expected " + i.length + " (" + i + "), got " + t); for (var n = new Array(t), e = 0; e < n.length; e++)n[e] = arguments[e]; return { fold: function () { if (arguments.length !== a.length) throw new Error("Wrong number of arguments to fold. Expected " + a.length + ", got " + arguments.length); return arguments[r].apply(null, n) }, match: function (t) { var e = tt(t); if (u.length !== e.length) throw new Error("Wrong number of arguments to match. Expected: " + u.join(",") + "\nActual: " + e.join(",")); if (!$(u, function (t) { return P(e, t) })) throw new Error("Not all branches were specified when using match. Specified: " + e.join(", ") + "\nRequired: " + u.join(", ")); return t[o].apply(null, n) }, log: function (t) { console.log(t, { constructors: u, constructor: o, params: n }) } } } }), n }, ut = Object.prototype.hasOwnProperty, ct = function (a) { return function () { for (var t = new Array(arguments.length), e = 0; e < t.length; e++)t[e] = arguments[e]; if (0 === t.length) throw new Error("Can't merge zero objects"); for (var n = {}, r = 0; r < t.length; r++) { var o = t[r]; for (var i in o) ut.call(o, i) && (n[i] = a(n[i], o[i])) } return n } }, st = ct(function (t, e) { return I(t) && I(e) ? st(t, e) : e }), ft = ct(function (t, e) { return e }), lt = at([{ blob: ["id", "imageresult", "objurl"] }, { url: ["id", "url", "raw"] }]), dt = ft(lt, { cata: function (t, e, n) { return t.fold(e, n) } }); function mt(t, e) { return gt(document.createElement("canvas"), t, e) } function pt(t) { return t.getContext("2d") } function gt(t, e, n) { return t.width = e, t.height = n, t } var vt = { create: mt, clone: function (t) { var e; return pt(e = mt(t.width, t.height)).drawImage(t, 0, 0), e }, resize: gt, get2dContext: pt, get3dContext: function (t) { var e = null; try { e = t.getContext("webgl") || t.getContext("experimental-webgl") } catch (t) { } return e || (e = null), e } }, ht = { getWidth: function (t) { return t.naturalWidth || t.width }, getHeight: function (t) { return t.naturalHeight || t.height } }, yt = window.Promise ? window.Promise : function () { var t = function (t) { if ("object" != typeof this) throw new TypeError("Promises must be constructed via new"); if ("function" != typeof t) throw new TypeError("not a function"); this._state = null, this._value = null, this._deferreds = [], s(t, n(o, this), n(a, this)) }, e = t.immediateFn || "function" == typeof window.setImmediate && window.setImmediate || function (t) { setTimeout(t, 1) }; function n(t, e) { return function () { t.apply(e, arguments) } } var r = Array.isArray || function (t) { return "[object Array]" === Object.prototype.toString.call(t) }; function i(n) { var r = this; null !== this._state ? e(function () { var t = r._state ? n.onFulfilled : n.onRejected; if (null !== t) { var e; try { e = t(r._value) } catch (t) { return void n.reject(t) } n.resolve(e) } else (r._state ? n.resolve : n.reject)(r._value) }) : this._deferreds.push(n) } function o(t) { try { if (t === this) throw new TypeError("A promise cannot be resolved with itself."); if (t && ("object" == typeof t || "function" == typeof t)) { var e = t.then; if ("function" == typeof e) return void s(n(e, t), n(o, this), n(a, this)) } this._state = !0, this._value = t, u.call(this) } catch (t) { a.call(this, t) } } function a(t) { this._state = !1, this._value = t, u.call(this) } function u() { for (var t = 0, e = this._deferreds.length; t < e; t++)i.call(this, this._deferreds[t]); this._deferreds = null } function c(t, e, n, r) { this.onFulfilled = "function" == typeof t ? t : null, this.onRejected = "function" == typeof e ? e : null, this.resolve = n, this.reject = r } function s(t, e, n) { var r = !1; try { t(function (t) { r || (r = !0, e(t)) }, function (t) { r || (r = !0, n(t)) }) } catch (t) { if (r) return; r = !0, n(t) } } return t.prototype.catch = function (t) { return this.then(null, t) }, t.prototype.then = function (n, r) { var o = this; return new t(function (t, e) { i.call(o, new c(n, r, t, e)) }) }, t.all = function () { var u = Array.prototype.slice.call(1 === arguments.length && r(arguments[0]) ? arguments[0] : arguments); return new t(function (r, o) { if (0 === u.length) return r([]); var i = u.length; function a(e, t) { try { if (t && ("object" == typeof t || "function" == typeof t)) { var n = t.then; if ("function" == typeof n) return void n.call(t, function (t) { a(e, t) }, o) } u[e] = t, 0 == --i && r(u) } catch (t) { o(t) } } for (var t = 0; t < u.length; t++)a(t, u[t]) }) }, t.resolve = function (e) { return e && "object" == typeof e && e.constructor === t ? e : new t(function (t) { t(e) }) }, t.reject = function (n) { return new t(function (t, e) { e(n) }) }, t.race = function (o) { return new t(function (t, e) { for (var n = 0, r = o.length; n < r; n++)o[n].then(t, e) }) }, t }(), bt = "undefined" != typeof window ? window : Function("return this;")(), xt = function (t, e) { return function (t, e) { for (var n = null != e ? e : bt, r = 0; r < t.length && null != n; ++r)n = n[t[r]]; return n }(t.split("."), e) }, Tt = function (t, e) { return function (t, e) { for (var n, r, o = void 0 !== e ? e : bt, i = 0; i < t.length; ++i)n = o, r = t[i], void 0 !== n[r] && null !== n[r] || (n[r] = {}), o = n[r]; return o }(t.split("."), e) }, Et = { getOrDie: function (t, e) { var n = xt(t, e); if (null == n) throw t + " not available on this browser"; return n } }; function wt(t, e) { return new (Et.getOrDie("Blob"))(t, e) } function It() { return new (Et.getOrDie("FileReader")) } function St(t) { return new (Et.getOrDie("Uint8Array"))(t) } var Lt = { atob: function (t) { return Et.getOrDie("atob")(t) }, requestAnimationFrame: function (t) { Et.getOrDie("requestAnimationFrame")(t) } }; function Ct(u) { return new yt(function (t, e) { var n = URL.createObjectURL(u), r = new Image, o = function () { r.removeEventListener("load", i), r.removeEventListener("error", a) }; function i() { o(), t(r) } function a() { o(), e("Unable to load data of type " + u.type + ": " + n) } r.addEventListener("load", i), r.addEventListener("error", a), r.src = n, r.complete && i() }) } function Nt(r) { return new yt(function (t, n) { var e = new XMLHttpRequest; e.open("GET", r, !0), e.responseType = "blob", e.onload = function () { 200 == this.status && t(this.response) }, e.onerror = function () { var t, e = this; n(0 === this.status ? ((t = new Error("No access to download image")).code = 18, t.name = "SecurityError", t) : new Error("Error " + e.status + " downloading image")) }, e.send() }) } function Dt(t) { var e = t.split(","), n = /data:([^;]+)/.exec(e[0]); if (!n) return D.none(); for (var r = n[1], o = e[1], i = Lt.atob(o), a = i.length, u = Math.ceil(a / 1024), c = new Array(u), s = 0; s < u; ++s) { for (var f = 1024 * s, l = Math.min(f + 1024, a), d = new Array(l - f), m = f, p = 0; m < l; ++p, ++m)d[p] = i[m].charCodeAt(0); c[s] = St(d) } return D.some(wt(c, { type: r })) } function Ot(n) { return new yt(function (t, e) { Dt(n).fold(function () { e("uri is not base64: " + n) }, t) }) } function At(n) { return new yt(function (t) { var e = It(); e.onloadend = function () { t(e.result) }, e.readAsDataURL(n) }) } var _t = { blobToImage: Ct, imageToBlob: function (t) { var e = t.src; return 0 === e.indexOf("data:") ? Ot(e) : Nt(e) }, blobToArrayBuffer: function (n) { return new yt(function (t) { var e = It(); e.onloadend = function () { t(e.result) }, e.readAsArrayBuffer(n) }) }, blobToDataUri: At, blobToBase64: function (t) { return At(t).then(function (t) { return t.split(",")[1] }) }, dataUriToBlobSync: Dt, canvasToBlob: function (t, n, r) { return n = n || "image/png", HTMLCanvasElement.prototype.toBlob ? new yt(function (e) { t.toBlob(function (t) { e(t) }, n, r) }) : Ot(t.toDataURL(n, r)) }, canvasToDataURL: function (t, e, n) { return e = e || "image/png", t.then(function (t) { return t.toDataURL(e, n) }) }, blobToCanvas: function (t) { return Ct(t).then(function (t) { var e, n; return e = t, URL.revokeObjectURL(e.src), n = vt.create(ht.getWidth(t), ht.getHeight(t)), vt.get2dContext(n).drawImage(t, 0, 0), n }) }, uriToBlob: function (t) { return 0 === t.indexOf("blob:") ? Nt(t) : 0 === t.indexOf("data:") ? Ot(t) : null } }; function Pt(t, e, n) { var r = e.type; function o(e, n) { return t.then(function (t) { return _t.canvasToDataURL(t, e, n) }) } return { getType: v(r), toBlob: function () { return yt.resolve(e) }, toDataURL: function () { return n }, toBase64: function () { return n.split(",")[1] }, toAdjustedBlob: function (e, n) { return t.then(function (t) { return _t.canvasToBlob(t, e, n) }) }, toAdjustedDataURL: o, toAdjustedBase64: function (t, e) { return o(t, e).then(function (t) { return t.split(",")[1] }) }, toCanvas: function () { return t.then(vt.clone) } } } function kt(e) { return _t.blobToDataUri(e).then(function (t) { return Pt(_t.blobToCanvas(e), e, t) }) } var Mt = { fromBlob: kt, fromCanvas: function (e, t) { return _t.canvasToBlob(e, t).then(function (t) { return Pt(yt.resolve(e), t, e.toDataURL()) }) }, fromImage: function (t) { return _t.imageToBlob(t).then(function (t) { return kt(t) }) }, fromBlobAndUrlSync: function (t, e) { return Pt(_t.blobToCanvas(t), t, e) } }, Rt = function (t) { return t.toBlob() }, Ft = { blobToImageResult: function (t) { return Mt.fromBlob(t) }, fromBlobAndUrlSync: function (t, e) { return Mt.fromBlobAndUrlSync(t, e) }, imageToImageResult: function (t) { return Mt.fromImage(t) }, imageResultToBlob: function (t, e, n) { return void 0 === e && void 0 === n ? Rt(t) : t.toAdjustedBlob(e, n) }, imageResultToOriginalBlob: Rt, imageResultToDataURL: function (t) { return t.toDataURL() } }, jt = function (t) { return parseInt(t, 10) }, Ut = function (t, e, n) { return { major: v(t), minor: v(e), patch: v(n) } }, Bt = { getTinymceVersion: function () { var t, e, n = [tinymce.majorVersion, tinymce.minorVersion].join("."); return t = n.split(".").slice(0, 3).join("."), (e = /([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t)) ? Ut(jt(e[1]), jt(e[2]), jt(e[3])) : Ut(0, 0, 0) } }; function Yt(c) { var s = function (t, e) { return v(4 === (o = Bt.getTinymceVersion()).major() && o.minor() < 6 ? t : t + "." + (n = e.toLowerCase(), (r = { "image/jpeg": "jpg", "image/jpg": "jpg", "image/gif": "gif", "image/png": "png" }).hasOwnProperty(n) ? r[n] : "dat")); var n, r, o }; return { importImages: function (t) { var e = q(t, function (t) { return dt.cata(t, function (t, e, n) { var r, o, i, a, u = Ft.imageResultToDataURL(e); return [(r = t, o = e, i = u, a = n, K.nu(function (e) { Ft.imageResultToOriginalBlob(o).then(function (t) { c.editorUpload.blobCache.add({ id: v(r), name: v(r), filename: s(r, t.type), blob: v(t), base64: v(i.split(",")[1]), blobUri: v(a), uri: v(null) }), e(t) }) }))] }, v([])) }); return J(e) }, uploadImages: function () { c.uploadImages() }, prepareImages: C, getLocalURL: function (t, e, n) { return Ft.imageResultToDataURL(e) } } } function Ht(t) { var e = !1; return function () { e || (e = !0, t.apply(null, arguments)) } } var Wt = { "cement.dialog.paste.title": "Paste Formatting Options", "cement.dialog.paste.instructions": "Choose to keep or remove formatting in the pasted content.", "cement.dialog.paste.merge": "Keep Formatting", "cement.dialog.paste.clean": "Remove Formatting", "cement.dialog.flash.title": "Additional step needed to paste images", "cement.dialog.flash.trigger-paste": "Your browser requires you to take one more action to paste the images in your content. Please press the below keys to complete the image paste:", "cement.dialog.flash.missing": 'Adobe Flash is required to import images from Microsoft Office. Install the <a href="http://get.adobe.com/flashplayer/" target="_blank">Adobe Flash Player</a>.', "cement.dialog.flash.press-escape": 'Press <span class="ephox-polish-help-kbd">"Close"</span> to paste your content without images.', "loading.wait": "Please wait...", "flash.clipboard.no.rtf": tinymce.Env.mac && tinymce.Env.webkit ? 'Your browser security settings may be preventing images from being imported. <a href="https://support.ephox.com/entries/59328357-Safari-6-1-and-7-Flash-Sandboxing" style="text-decoration: underline">More information on paste for Safari</a>' : "Your browser security settings may be preventing images from being imported.", "safari.imagepaste": 'Safari does not support direct paste of images. <a href="https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work" style="text-decoration: underline">More information on image pasting for Safari</a>', "webview.imagepaste": 'Safari does not support direct paste of images. <a href="https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work" style="text-decoration: underline">More information on image pasting for Safari</a>', "error.code.images.not.found": "The images service was not found: (", "error.imageupload": "Image failed to upload: (", "error.full.stop": ").", "errors.local.images.disallowed": "Local image paste has been disabled. Local images have been removed from pasted content.", "flash.crashed": "Images have not been imported as Adobe Flash appears to have crashed. This may be caused by pasting large documents.", "errors.imageimport.failed": "Some images failed to import.", "errors.imageimport.unsupported": "Unsupported image type.", "errors.imageimport.invalid": "Image is invalid." }, qt = { translate: function (t) { return tinymce.translate(Wt[t]) } }, $t = { showDialog: function (t, e) { var n, r = { title: "Error", spacing: 10, padding: 10, items: [{ type: "container", html: e }], buttons: [{ text: "Ok", onclick: function () { n.close() } }] }; n = t.windowManager.open(r) } }, Vt = function (t) { return t.replace(/\./g, "-") }, Xt = function (t, e) { return t + "-" + e }, Gt = function (t) { var n = Vt(t); return { resolve: function (t) { var e = t.split(" "); return M(e, function (t) { return Xt(n, t) }).join(" ") } } }, zt = { resolve: Gt("ephox-salmon").resolve }, Kt = zt.resolve("upload-image-in-progress"), Zt = "data-" + zt.resolve("image-blob"), Jt = "data-" + zt.resolve("image-upload"), Qt = { uploadInProgress: v(Kt), blobId: v(Zt), trackedImage: v(Jt) }, te = (y.Node.ATTRIBUTE_NODE, y.Node.CDATA_SECTION_NODE, y.Node.COMMENT_NODE), ee = y.Node.DOCUMENT_NODE, ne = (y.Node.DOCUMENT_TYPE_NODE, y.Node.DOCUMENT_FRAGMENT_NODE, y.Node.ELEMENT_NODE), re = y.Node.TEXT_NODE, oe = (y.Node.PROCESSING_INSTRUCTION_NODE, y.Node.ENTITY_REFERENCE_NODE, y.Node.ENTITY_NODE, y.Node.NOTATION_NODE, function (t) { return t.dom().nodeName.toLowerCase() }), ie = function (t) { return t.dom().nodeType }, ae = function (e) { return function (t) { return ie(t) === e } }, ue = function (t) { return ie(t) === te || "#comment" === oe(t) }, ce = ae(ne), se = ae(re), fe = function (t, e, n) { if (!(w(n) || L(n) || A(n))) throw y.console.error("Invalid call to Attr.set. Key ", e, ":: Value ", n, ":: Element ", t), new Error("Attribute value was not simple"); t.setAttribute(e, n + "") }, le = function (t, e, n) { fe(t.dom(), e, n) }, de = function (t, e) { var n = t.dom(); et(e, function (t, e) { fe(n, e, t) }) }, me = function (t, e) { var n = t.dom().getAttribute(e); return null === n ? void 0 : n }, pe = function (t, e) { var n = t.dom(); return !(!n || !n.hasAttribute) && n.hasAttribute(e) }, ge = function (t, e) { t.dom().removeAttribute(e) }, ve = function (t, e) { var n = me(t, e); return void 0 === n || "" === n ? [] : n.split(" ") }, he = function (t) { return void 0 !== t.dom().classList }, ye = function (t) { return ve(t, "class") }, be = function (t, e) { return o = e, i = ve(n = t, r = "class").concat([o]), le(n, r, i.join(" ")), !0; var n, r, o, i }, xe = function (t, e) { return o = e, 0 < (i = F(ve(n = t, r = "class"), function (t) { return t !== o })).length ? le(n, r, i.join(" ")) : ge(n, r), !1; var n, r, o, i }, Te = function (t, e) { he(t) ? t.dom().classList.add(e) : be(t, e) }, Ee = function (t, e) { var n; he(t) ? t.dom().classList.remove(e) : xe(t, e), 0 === (he(n = t) ? n.dom().classList : ye(n)).length && ge(n, "class") }, we = function (t, e) { return he(t) && t.dom().classList.contains(e) }, Ie = function (t) { if (null == t) throw new Error("Node cannot be null or undefined"); return { dom: v(t) } }, Se = { fromHtml: function (t, e) { var n = (e || y.document).createElement("div"); if (n.innerHTML = t, !n.hasChildNodes() || 1 < n.childNodes.length) throw y.console.error("HTML does not have a single root node", t), new Error("HTML must have a single root node"); return Ie(n.childNodes[0]) }, fromTag: function (t, e) { var n = (e || y.document).createElement(t); return Ie(n) }, fromText: function (t, e) { var n = (e || y.document).createTextNode(t); return Ie(n) }, fromDom: Ie, fromPoint: function (t, e, n) { var r = t.dom(); return D.from(r.elementFromPoint(e, n)).map(Ie) } }, Le = function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; return function () { for (var n = [], t = 0; t < arguments.length; t++)n[t] = arguments[t]; if (e.length !== n.length) throw new Error('Wrong number of arguments to struct. Expected "[' + e.length + ']", got ' + n.length + " arguments"); var r = {}; return R(e, function (t, e) { r[t] = v(n[e]) }), r } }, Ce = function (t) { return t.slice(0).sort() }, Ne = function (e, t) { if (!S(t)) throw new Error("The " + e + " fields must be an array. Was: " + t + "."); R(t, function (t) { if (!w(t)) throw new Error("The value " + t + " in the " + e + " fields was not a string.") }) }, De = function (o, i) { var n, a = o.concat(i); if (0 === a.length) throw new Error("You must specify at least one required or optional field."); return Ne("required", o), Ne("optional", i), n = Ce(a), U(n, function (t, e) { return e < n.length - 1 && t === n[e + 1] }).each(function (t) { throw new Error("The field: " + t + " occurs more than once in the combined fields: [" + n.join(", ") + "].") }), function (e) { var n = tt(e); $(o, function (t) { return P(n, t) }) || function (t, e) { throw new Error("All required keys (" + Ce(t).join(", ") + ") were not specified. Specified keys were: " + Ce(e).join(", ") + ".") }(o, n); var t = F(n, function (t) { return !P(a, t) }); 0 < t.length && function (t) { throw new Error("Unsupported keys for object: " + Ce(t).join(", ")) }(t); var r = {}; return R(o, function (t) { r[t] = v(e[t]) }), R(i, function (t) { r[t] = v(Object.prototype.hasOwnProperty.call(e, t) ? D.some(e[t]) : D.none()) }), r } }, Oe = function (t, e) { for (var n = [], r = function (t) { return n.push(t), e(t) }, o = e(t); (o = o.bind(r)).isSome();); return n }, Ae = function (n) { var r, o = !1; return function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; return o || (o = !0, r = n.apply(null, t)), r } }, _e = function () { return Pe(0, 0) }, Pe = function (t, e) { return { major: t, minor: e } }, ke = { nu: Pe, detect: function (t, e) { var n = String(e).toLowerCase(); return 0 === t.length ? _e() : function (t, e) { var n = function (t, e) { for (var n = 0; n < t.length; n++) { var r = t[n]; if (r.test(e)) return r } }(t, e); if (!n) return { major: 0, minor: 0 }; var r = function (t) { return Number(e.replace(n, "$" + t)) }; return Pe(r(1), r(2)) }(t, n) }, unknown: _e }, Me = "Firefox", Re = function (t, e) { return function () { return e === t } }, Fe = function (t) { var e = t.current; return { current: e, version: t.version, isEdge: Re("Edge", e), isChrome: Re("Chrome", e), isIE: Re("IE", e), isOpera: Re("Opera", e), isFirefox: Re(Me, e), isSafari: Re("Safari", e) } }, je = { unknown: function () { return Fe({ current: void 0, version: ke.unknown() }) }, nu: Fe, edge: v("Edge"), chrome: v("Chrome"), ie: v("IE"), opera: v("Opera"), firefox: v(Me), safari: v("Safari") }, Ue = "Windows", Be = "Android", Ye = "Solaris", He = "FreeBSD", We = function (t, e) { return function () { return e === t } }, qe = function (t) { var e = t.current; return { current: e, version: t.version, isWindows: We(Ue, e), isiOS: We("iOS", e), isAndroid: We(Be, e), isOSX: We("OSX", e), isLinux: We("Linux", e), isSolaris: We(Ye, e), isFreeBSD: We(He, e) } }, $e = { unknown: function () { return qe({ current: void 0, version: ke.unknown() }) }, nu: qe, windows: v(Ue), ios: v("iOS"), android: v(Be), linux: v("Linux"), osx: v("OSX"), solaris: v(Ye), freebsd: v(He) }, Ve = function (t, e) { var n = String(e).toLowerCase(); return U(t, function (t) { return t.search(n) }) }, Xe = function (t, n) { return Ve(t, n).map(function (t) { var e = ke.detect(t.versionRegexes, n); return { current: t.name, version: e } }) }, Ge = function (t, n) { return Ve(t, n).map(function (t) { var e = ke.detect(t.versionRegexes, n); return { current: t.name, version: e } }) }, ze = function (t, e, n) { return "" === e || !(t.length < e.length) && t.substr(n, n + e.length) === e }, Ke = function (t, e) { return tn(t, e) ? (n = t, r = e.length, n.substring(r)) : t; var n, r }, Ze = function (t, e) { return en(t, e) ? (n = t, r = e.length, n.substring(0, n.length - r)) : t; var n, r }, Je = function (t, e) { return -1 !== t.indexOf(e) }, Qe = function (n) { return (t = n, "" === t ? D.none() : D.some(t.substr(0, 1))).bind(function (e) { return (t = n, "" === t ? D.none() : D.some(t.substring(1))).map(function (t) { return e.toUpperCase() + t }); var t }).getOr(n); var t }, tn = function (t, e) { return ze(t, e, 0) }, en = function (t, e) { return ze(t, e, t.length - e.length) }, nn = function (t) { return t.replace(/^\s+|\s+$/g, "") }, rn = /.*?version\/\ ?([0-9]+)\.([0-9]+).*/, on = function (e) { return function (t) { return Je(t, e) } }, an = [{ name: "Edge", versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/], search: function (t) { return Je(t, "edge/") && Je(t, "chrome") && Je(t, "safari") && Je(t, "applewebkit") } }, { name: "Chrome", versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/, rn], search: function (t) { return Je(t, "chrome") && !Je(t, "chromeframe") } }, { name: "IE", versionRegexes: [/.*?msie\ ?([0-9]+)\.([0-9]+).*/, /.*?rv:([0-9]+)\.([0-9]+).*/], search: function (t) { return Je(t, "msie") || Je(t, "trident") } }, { name: "Opera", versionRegexes: [rn, /.*?opera\/([0-9]+)\.([0-9]+).*/], search: on("opera") }, { name: "Firefox", versionRegexes: [/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/], search: on("firefox") }, { name: "Safari", versionRegexes: [rn, /.*?cpu os ([0-9]+)_([0-9]+).*/], search: function (t) { return (Je(t, "safari") || Je(t, "mobile/")) && Je(t, "applewebkit") } }], un = [{ name: "Windows", search: on("win"), versionRegexes: [/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/] }, { name: "iOS", search: function (t) { return Je(t, "iphone") || Je(t, "ipad") }, versionRegexes: [/.*?version\/\ ?([0-9]+)\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/] }, { name: "Android", search: on("android"), versionRegexes: [/.*?android\ ?([0-9]+)\.([0-9]+).*/] }, { name: "OSX", search: on("os x"), versionRegexes: [/.*?os\ x\ ?([0-9]+)_([0-9]+).*/] }, { name: "Linux", search: on("linux"), versionRegexes: [] }, { name: "Solaris", search: on("sunos"), versionRegexes: [] }, { name: "FreeBSD", search: on("freebsd"), versionRegexes: [] }], cn = { browsers: v(an), oses: v(un) }, sn = function (t) { var e, n, r, o, i, a, u, c, s, f, l, d = cn.browsers(), m = cn.oses(), p = Xe(d, t).fold(je.unknown, je.nu), g = Ge(m, t).fold($e.unknown, $e.nu); return { browser: p, os: g, deviceType: (n = p, r = t, o = (e = g).isiOS() && !0 === /ipad/i.test(r), i = e.isiOS() && !o, a = e.isAndroid() && 3 === e.version.major, u = e.isAndroid() && 4 === e.version.major, c = o || a || u && !0 === /mobile/i.test(r), s = e.isiOS() || e.isAndroid(), f = s && !c, l = n.isSafari() && e.isiOS() && !1 === /safari/i.test(r), { isiPad: v(o), isiPhone: v(i), isTablet: v(c), isPhone: v(f), isTouch: v(s), isAndroid: e.isAndroid, isiOS: e.isiOS, isWebView: v(l) }) } }, fn = { detect: Ae(function () { var t = y.navigator.userAgent; return sn(t) }) }, ln = ne, dn = ee, mn = function (t, e) { var n = t.dom(); if (n.nodeType !== ln) return !1; if (void 0 !== n.matches) return n.matches(e); if (void 0 !== n.msMatchesSelector) return n.msMatchesSelector(e); if (void 0 !== n.webkitMatchesSelector) return n.webkitMatchesSelector(e); if (void 0 !== n.mozMatchesSelector) return n.mozMatchesSelector(e); throw new Error("Browser lacks native selectors") }, pn = function (t) { return t.nodeType !== ln && t.nodeType !== dn || 0 === t.childElementCount }, gn = function (t, e) { var n = void 0 === e ? y.document : e.dom(); return pn(n) ? [] : M(n.querySelectorAll(t), Se.fromDom) }, vn = function (t, e) { var n = void 0 === e ? y.document : e.dom(); return pn(n) ? D.none() : D.from(n.querySelector(t)).map(Se.fromDom) }, hn = function (t, e) { return t.dom() === e.dom() }, yn = (fn.detect().browser.isIE(), mn), bn = function (t) { return Se.fromDom(t.dom().ownerDocument) }, xn = function (t) { var e = t.dom(); return D.from(e.parentNode).map(Se.fromDom) }, Tn = function (t, e) { for (var n = O(e) ? e : v(!1), r = t.dom(), o = []; null !== r.parentNode && void 0 !== r.parentNode;) { var i = r.parentNode, a = Se.fromDom(i); if (o.push(a), !0 === n(a)) break; r = i } return o }, En = function (t) { var e = t.dom(); return D.from(e.previousSibling).map(Se.fromDom) }, wn = function (t) { var e = t.dom(); return D.from(e.nextSibling).map(Se.fromDom) }, In = function (t) { return e = Oe(t, En), (n = V.call(e, 0)).reverse(), n; var e, n }, Sn = function (t) { var e = t.dom(); return M(e.childNodes, Se.fromDom) }, Ln = function (t) { return e = 0, n = t.dom().childNodes, D.from(n[e]).map(Se.fromDom); var e, n }, Cn = function (t) { return t.dom().childNodes.length }, Nn = (Le("element", "offset"), function (t, e) { var n = (e || y.document).createElement("div"); return n.innerHTML = t, Sn(Se.fromDom(n)) }), Dn = function (e, n) { xn(e).each(function (t) { t.dom().insertBefore(n.dom(), e.dom()) }) }, On = function (t, e) { wn(t).fold(function () { xn(t).each(function (t) { _n(t, e) }) }, function (t) { Dn(t, e) }) }, An = function (e, n) { Ln(e).fold(function () { _n(e, n) }, function (t) { e.dom().insertBefore(n.dom(), t.dom()) }) }, _n = function (t, e) { t.dom().appendChild(e.dom()) }, Pn = function (t, e) { Dn(t, e), _n(e, t) }, kn = function (r, o) { R(o, function (t, e) { var n = 0 === e ? r : o[e - 1]; On(n, t) }) }, Mn = function (e, t) { R(t, function (t) { _n(e, t) }) }, Rn = function (t) { var e = se(t) ? t.dom().parentNode : t.dom(); return null != e && e.ownerDocument.body.contains(e) }, Fn = function (t, e) { var n = []; return R(Sn(t), function (t) { e(t) && (n = n.concat([t])), n = n.concat(Fn(t, e)) }), n }, jn = function (t, e) { return gn(e, t) }, Un = function (t) { Ee(t, Qt.uploadInProgress()) }, Bn = function (t) { for (var e = 0; e < t.undoManager.data.length; e++) { var n = t.undoManager.data[e].content, r = Se.fromTag("div"); Mn(r, Nn(n)); var o = jn(r, "." + Qt.uploadInProgress()); R(o, Un), t.undoManager.data[e].content = r.dom().innerHTML } }, Yn = function (t, e, n) { for (var r = 0; r < t.undoManager.data.length; r++)t.undoManager.data[r].content = t.undoManager.data[r].content.split(e.objurl()).join(n.location) }, Hn = function () { return Et.getOrDie("URL") }, Wn = function (t) { return Hn().createObjectURL(t) }, qn = function (t) { Hn().revokeObjectURL(t) }, $n = Le("id", "imageresult", "objurl"); function Vn() { var o = {}, n = function (t) { qn(t.objurl()) }; return { add: function (t, e, n) { var r = $n(t, e, n); return o[t] = r }, get: function (t) { return D.from(o[t]) }, remove: function (t) { var e = o[t]; delete o[t], void 0 !== e && n(e) }, lookupByData: function (e) { return function (t, e) { for (var n = tt(t), r = 0, o = n.length; r < o; r++) { var i = n[r], a = t[i]; if (e(a, i, t)) return D.some(a) } return D.none() }(o, function (t) { return Ft.imageResultToDataURL(t.imageresult()) === e }) }, destroy: function () { et(o, n), o = {} } } } function Xn(t) { var n = Le.apply(null, t), r = []; return { bind: function (t) { if (void 0 === t) throw "Event bind error: undefined handler"; r.push(t) }, unbind: function (e) { r = F(r, function (t) { return t !== e }) }, trigger: function () { var e = n.apply(null, arguments); R(r, function (t) { t(e) }) } } } var Gn = { create: function (t) { return { registry: nt(t, function (t) { return { bind: t.bind, unbind: t.unbind } }), trigger: nt(t, function (t) { return t.trigger }) } } }, zn = Qt.trackedImage(), Kn = function (t, e) { return jn(t, "img[" + zn + '="' + e + '"]') }, Zn = function (t) { return jn(t, "img:not([" + zn + "])[" + Qt.blobId() + "]") }; function Jn() { var o = [], i = [], t = Gn.create({ complete: Xn(["response"]) }), a = function () { t.trigger.complete(i), i = [] }, u = function () { return 0 < o.length }; return { findById: Kn, findAll: Zn, register: function (t, e) { le(t, zn, e), o.push(e) }, report: function (t, e, r) { var n; R(e, function (t) { var e, n; ge(t, zn), e = r, n = t, i.push({ success: e, element: n.dom() }) }), n = t, o = F(o, function (t, e) { return t !== n }), !1 === u() && a() }, inProgress: u, isActive: function (t) { return P(o, t) }, events: t.registry } } var Qn = function (n) { return { is: function (t) { return n === t }, isValue: m, isError: d, getOr: v(n), getOrThunk: v(n), getOrDie: v(n), or: function (t) { return Qn(n) }, orThunk: function (t) { return Qn(n) }, fold: function (t, e) { return e(n) }, map: function (t) { return Qn(t(n)) }, mapError: function (t) { return Qn(n) }, each: function (t) { t(n) }, bind: function (t) { return t(n) }, exists: function (t) { return t(n) }, forall: function (t) { return t(n) }, toOption: function () { return D.some(n) } } }, tr = function (n) { return { is: d, isValue: d, isError: m, getOr: l, getOrThunk: function (t) { return t() }, getOrDie: function () { return f(String(n))() }, or: function (t) { return t }, orThunk: function (t) { return t() }, fold: function (t, e) { return t(n) }, map: function (t) { return tr(n) }, mapError: function (t) { return tr(t(n)) }, each: C, bind: function (t) { return tr(n) }, exists: d, forall: m, toOption: D.none } }, er = { value: Qn, error: tr }, nr = function (e, t) { R(t, function (t) { Te(e, t) }) }, rr = function (t) { return he(t) ? function (t) { for (var e = t.dom().classList, n = new Array(e.length), r = 0; r < e.length; r++)n[r] = e.item(r); return n }(t) : ye(t) }, or = function (e) { return function (t) { return we(t, e) } }, ir = function (t, e, n) { for (var r = t.dom(), o = O(n) ? n : v(!1); r.parentNode;) { r = r.parentNode; var i = Se.fromDom(r); if (e(i)) return D.some(i); if (o(i)) break } return D.none() }, ar = function (t, e) { return U(t.dom().childNodes, g(e, Se.fromDom)).map(Se.fromDom) }, ur = function (t, r) { var o = function (t) { for (var e = 0; e < t.childNodes.length; e++) { if (r(Se.fromDom(t.childNodes[e]))) return D.some(Se.fromDom(t.childNodes[e])); var n = o(t.childNodes[e]); if (n.isSome()) return n } return D.none() }; return o(t.dom()) }, cr = function (t) { return vn(t) }, sr = function (t, e, n) { return ir(t, function (t) { return mn(t, e) }, n) }, fr = function (t, e) { return vn(e, t) }, lr = function (t, e, n) { return r = sr, a = n, mn(o = t, i = e) ? D.some(o) : O(a) && a(o) ? D.none() : r(o, i, a); var r, o, i, a }, dr = Le("image", "blobInfo"), mr = at([{ failure: ["error"] }, { success: ["result", "images", "blob"] }]), pr = function (t, e, n, r, o) { var i = Ft.imageResultToDataURL(n), a = t.lookupByData(i).getOrThunk(function () { return t.add(e, n, r) }); return le(o, Qt.blobId(), a.id()), dr(o, a) }, gr = function (e, n) { return e.get(n).fold(function () { return er.error("Internal error with blob cache") }, function (t) { return e.remove(n), er.value(t) }) }, vr = function (t, e, n) { var r = t.isActive(e); return t.register(n, e), Te(n, Qt.uploadInProgress()), r ? D.none() : D.some(e) }, hr = function (t, n, a, r, u, e, c) { var s = function () { y.console.error("Internal error with blob cache", u), c(mr.failure({ status: v(666) })) }; t.upload(e, u, function (t) { var e, i = n.findById(r, u); R(i, (e = Qt.uploadInProgress(), function (t) { Ee(t, e) })), t.fold(function (t) { c(mr.failure(t)) }, function (e) { var t, n, r, o; (t = a, n = i, r = u, o = e, R(n, function (t) { le(t, "src", o.location), ge(t, Qt.blobId()) }), gr(t, r)).fold(s, function (t) { c(mr.success(e, i, t)) }) }), n.report(u, i, t.isValue()) }) }, yr = function (o, i, t) { return q(t, function (t) { return dt.cata(t, function (e, n, r) { return fr(i, 'img[src="' + r + '"]').fold(function () { return [er.error("Image that was just inserted could not be found: " + r)] }, function (t) { return [er.value(pr(o, e, n, r, t))] }) }, v([])) }) }, br = function (t, o, e) { var n = t.findAll(e); return t.inProgress() ? [] : M(n, function (t) { return e = o, r = me(n = t, Qt.blobId()), e.get(r).fold(function () { return er.error(r) }, function (t) { return er.value(dr(n, t)) }); var e, n, r }) }, xr = at([{ get: [] }, { post: [] }, { put: [] }, { del: [] }]), Tr = { get: xr.get, post: xr.post, put: xr.put, del: xr.del }, Er = function (t, e, n, r) { var o = t.bind(function (t) { return t.match({ file: function () { return D.none() }, form: function () { return D.some("application/x-www-form-urlencoded; charset=UTF-8") }, json: function () { return D.some("application/json") }, plain: function () { return D.some("text/plain") }, html: function () { return D.some("text/html") } }) }), i = n.match({ none: D.none, xhr: v(D.some(!0)) }), a = e.match({ json: D.none, blob: v(D.some("blob")), xml: v(D.some("document")), html: v(D.some("document")), text: v(D.some("text")) }), u = e.match({ json: v("application/json, text/javascript"), blob: v("application/octet-stream"), text: v("text/plain"), html: v("text/html"), xml: v("application/xml, text/xml") }) + ", */*; q=0.01", c = r; return { contentType: v(o), credentials: v(i), responseType: v(a), accept: v(u), headers: v(c) } }, wr = function (n, t) { t.contentType().each(function (t) { n.setRequestHeader("Content-Type", t) }); var e = t.accept(); n.setRequestHeader("Accept", e), t.credentials().each(function (t) { n.withCredentials = t }), t.responseType().each(function (t) { n.responseType = t }); var r = t.headers(); et(r, function (t, e) { w(e) || w(t) ? n.setRequestHeader(e, t) : y.console.error("Request header data was not a string: ", e, " -> ", t) }) }, Ir = function (e) { return K.nu(function (n) { var t = It(); t.onload = function (t) { var e = t.target; n(e.result) }, t.readAsText(e) }) }, Sr = function () { return Et.getOrDie("JSON") }, Lr = { parse: function (t) { return Sr().parse(t) }, stringify: function (t, e, n) { return Sr().stringify(t, e, n) } }, Cr = function (t) { try { var e = Lr.parse(t); return er.value(e) } catch (t) { return er.error("Response was not JSON") } }, Nr = De(["message", "status", "responseText"], []), Dr = function (t) { var e = Nr(t); return e.toString = e.message, e }, Or = { handle: function (n, t, r) { var e = function () { return K.pure(r.response) }; return t.match({ json: function () { return Cr(r.response).fold(e, K.pure) }, blob: function () { return t = r, D.from(t.response).map(Ir).getOr(K.pure("no response content")); var t }, text: e, html: e, xml: e }).map(function (t) { var e = 0 === r.status ? "Unknown HTTP error (possible cross-domain request)" : 'Could not load url "' + n + '": ' + r.statusText; return Dr({ message: e, status: r.status, responseText: t }) }) }, nu: Dr }, Ar = function () { return (Ar = Object.assign || function (t) { for (var e, n = 1, r = arguments.length; n < r; n++)for (var o in e = arguments[n]) Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]); return t }).apply(this, arguments) }, _r = function (i) { return Ar({}, i, { toCached: function () { return _r(i.toCached()) }, bindFuture: function (e) { return _r(i.bind(function (t) { return t.fold(function (t) { return K.pure(er.error(t)) }, function (t) { return e(t) }) })) }, bindResult: function (e) { return _r(i.map(function (t) { return t.bind(e) })) }, mapResult: function (e) { return _r(i.map(function (t) { return t.map(e) })) }, mapError: function (e) { return _r(i.map(function (t) { return t.mapError(e) })) }, foldResult: function (e, n) { return i.map(function (t) { return t.fold(e, n) }) }, withTimeout: function (t, o) { return _r(K.nu(function (e) { var n = !1, r = window.setTimeout(function () { n = !0, e(er.error(o())) }, t); i.get(function (t) { n || (window.clearTimeout(r), e(t)) }) })) } }) }, Pr = function (t) { return _r(K.nu(t)) }, kr = function (t) { return _r(K.pure(er.value(t))) }, Mr = Pr, Rr = kr, Fr = function (t) { return _r(K.pure(er.error(t))) }, jr = function (t, e) { var n, r, o = function () { return Rr(e.response) }, i = function (t) { return Or.nu({ message: t, status: e.status, responseText: e.responseText }) }; return t.match({ json: function () { return Cr(e.response).fold(function (t) { return Fr(i(t)) }, Rr) }, blob: o, text: o, html: o, xml: (n = "Invalid XML document", r = o, function () { return r().bindResult(function (t) { return null === t ? er.error(i(n)) : er.value(t) }) }) }) }, Ur = function (i, a, u, c, s, t) { var f = void 0 !== t ? t : {}; return Mr(function (e) { var t = a.match({ get: v("get"), put: v("put"), post: v("post"), del: v("delete") }), n = new (Et.getOrDie("XMLHttpRequest")); n.open(t, i, !0); var r = Er(u, c, s, f); wr(n, r); var o = function () { Or.handle(i, c, n).get(function (t) { e(er.error(t)) }) }; n.onload = function () { 0 !== n.status || tn(i, "file:") ? n.status < 100 || 400 <= n.status ? o() : jr(c, n).get(e) : o() }, n.onerror = o, u.fold(function () { n.send() }, function (t) { var e = t.match({ file: l, form: l, json: Lr.stringify, plain: l, html: l }); n.send(e) }) }).toLazy() }, Br = at([{ file: ["data"] }, { form: ["data"] }, { json: ["data"] }, { plain: ["data"] }, { html: ["data"] }]), Yr = { file: Br.file, form: Br.form, json: Br.json, plain: Br.plain, html: Br.html }, Hr = at([{ none: [] }, { xhr: [] }]), Wr = { none: Hr.none, xhr: Hr.xhr }, qr = at([{ json: [] }, { blob: [] }, { text: [] }, { html: [] }, { xml: [] }]), $r = { json: qr.json, blob: qr.blob, text: qr.text, html: qr.html, xml: qr.xml, cata: function (t, e, n, r, o, i) { return t.match({ json: e, blob: n, text: r, html: o, xml: i }) } }, Vr = Le("message", "status", "contents"), Xr = ["jpg", "png", "gif", "jpeg"], Gr = { failureObject: Vr, getFilename: function (t, e) { return w(t.name) && !en(t.name, ".tmp") ? t.name : function (t, e) { if (w(t.type) && tn(t.type, "image/")) { var n = t.type.substr("image/".length); return P(Xr, n) ? e + "." + n : e } return e }(t, e) }, buildData: function (t, e, n) { var r = new (Et.getOrDie("FormData")); return r.append(t, e, n), r } }, zr = function (t) { var e = ""; return "" !== t.protocol && (e += t.protocol, e += ":"), "" !== t.authority && (e += "//", e += t.authority), e += t.path, "" !== t.query && (e += "?", e += t.query), "" !== t.anchor && (e += "#", e += t.anchor), e }, Kr = { strictMode: !1, key: ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"], q: { name: "queryKey", parser: /(?:^|&)([^&=]*)=?([^&]*)/g }, parser: { strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/, loose: /^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/ } }, Zr = function (t, e) { return function (t, e) { for (var r = e, n = r.parser[r.strictMode ? "strict" : "loose"].exec(t), o = {}, i = 14; i--;)o[r.key[i]] = n[i] || ""; return o[r.q.name] = {}, o[r.key[12]].replace(r.q.parser, function (t, e, n) { e && (o[r.q.name][e] = n) }), o }(t, ft(Kr, e)) }, Jr = function (t) { return Ze(t, Qr(t)) }, Qr = function (t) { return t.substring(t.lastIndexOf("/")) }, to = function (t) { for (var e = t, n = ""; "" !== e;)if (tn(e, "../")) e = Ke(e, "../"); else if (tn(e, "./")) e = Ke(e, "./"); else if (tn(e, "/./")) e = "/" + Ke(e, "/./"); else if ("/." === e) e = "/"; else if (tn(e, "/../")) e = "/" + Ke(e, "/../"), n = Jr(n); else if ("/.." === e) e = "/", n = Jr(n); else if ("." === e || ".." === e) e = ""; else { var r = e.match(/(^\/?.*?)(\/|$)/)[1]; e = Ke(e, r), n += r } return n }, eo = function (t, e, n) { if ("" !== n && "" === t) return "/" + e; var r = t.substring(t.lastIndexOf("/") + 1); return Ze(t, r) + e }, no = function (t, e) { var n = { strictMode: !0 }, r = Zr(t, n), o = Zr(e, n), i = {}; return "" !== o.protocol ? (i.protocol = o.protocol, i.authority = o.authority, i.path = to(o.path), i.query = o.query) : ("" !== o.authority ? (i.authority = o.authority, i.path = to(o.path), i.query = o.query) : ("" === o.path ? (i.path = r.path, "" !== o.query ? i.query = o.query : i.query = r.query) : (tn(o.path, "/") ? i.path = to(o.path) : (i.path = eo(r.path, o.path, t.authority), i.path = to(i.path)), i.query = o.query), i.authority = r.authority), i.protocol = r.protocol), i.anchor = o.anchor, i }, ro = function (t, e) { var n = no(t, e); return zr(n) }; function oo(d) { var t, e, n, r, m = (t = d.url, e = t.lastIndexOf("/"), n = 0 < e ? t.substr(0, e) : t, r = void 0 === d.basePath ? n : d.basePath, en(r, "/") ? r : r + "/"), o = function (t, e, f) { var n, r, o, i, a, u, l = Gr.getFilename(t, e), c = !0 === d.credentials ? Wr.xhr() : Wr.none(), s = Yr.file(Gr.buildData("image", t, l)); (n = d.url, r = s, o = $r.text(), i = c, u = Tr.post(), Ur(n, u, D.some(r), o, i, a)).map(function (t) { t.fold(function (t) { f(er.error(Gr.failureObject(t.message(), t.status(), t.responseText()))) }, function (e) { var n, t, r, o; try { var i = Lr.parse(e); if (!w(i.location)) return t = "JSON response did not contain a string location", r = 500, o = e, void f(er.error(Gr.failureObject(t, r, o))); n = i.location } catch (t) { n = e } var a, u, c, s = (a = l, u = n.split(/\s+/), c = 1 === u.length && "" !== u[0] ? u[0] : a, ro(m, c)); f(er.value({ location: s })) }) }) }; return { upload: function (t, e, n) { var r = t.imageresult(); Ft.imageResultToBlob(r).then(function (t) { o(t, e, n) }) } } } Le("id", "filename", "blob", "base64"); var io = function (t) { return oo(t) }, ao = function (t) { return t.getParam("powerpaste_block_drop", !1, "boolean") }, uo = function (t) { return void 0 !== t.settings.images_upload_url }, co = function (r, t) { var o, e, i, a, n, u = Vn(), c = Jn(), s = (o = r, e = t.url, i = function () { return qt.translate("error.code.images.not.found") + e + qt.translate("error.full.stop") }, a = function () { return qt.translate("error.imageupload") + e + qt.translate("error.full.stop") }, n = function (t) { var e = t.status(), n = 0 === e || 400 <= e || e < 500 ? i : a; $t.showDialog(o, n()) }, { instance: function () { return Ht(n) } }), f = io(t), l = function () { return Se.fromDom(r.getBody()) }, d = function (e, t, n) { R(t, function (t) { le(t, "data-mce-src", e.location) }), Yn(r, n, e) }; c.events.complete.bind(function (t) { Bn(r) }); var m = function (o, i) { vr(c, o.blobInfo().id(), o.image()).each(function (t) { var e, n, r; e = t, n = o.blobInfo(), r = i, hr(f, c, u, l(), e, n, function (t) { t.fold(function (t) { r(t) }, d) }) }) }; return { importImages: function () { return K.pure([]) }, uploadImages: function (t) { var e, n, r, o, i; e = s.instance(), n = br(c, u, l()), R(n, function (t) { t.fold(function (t) { c.report(t, D.none(), !1) }, function (t) { m(t, e) }) }), r = t, o = s.instance(), i = yr(u, l(), r), R(i, function (t) { t.fold(function (t) { console.error(t) }, function (t) { m(t, o) }) }) }, prepareImages: C, getLocalURL: function (t, e, n) { return n } } }, so = function (o) { var t = Yt(o); return { importImages: function () { return K.pure([]) }, uploadImages: C, prepareImages: function (t) { R(t, function (t) { dt.cata(t, function (t, e, n) { var r = Ft.imageResultToDataURL(e); R(o.dom.select('img[src="' + n + '"]'), function (t) { o.dom.setAttrib(t, "src", r) }) }, C) }) }, getLocalURL: t.getLocalURL } }; function fo(t) { return void 0 !== t.uploadImages ? Yt(t) : function (t) { if (uo(t)) { var e = { url: t.settings.images_upload_url, basePath: t.settings.images_upload_base_path, credentials: t.settings.images_upload_credentials }; return co(t, e) } return so(t) }(t) } var lo, mo, po = { each: tinymce.each, trim: tinymce.trim, bind: function (t, e) { return function () { return t.apply(e, arguments) } }, extend: function (n) { for (var t = [], e = 1; e < arguments.length; e++)t[e - 1] = arguments[e]; return tinymce.each(Array.prototype.slice.call(arguments, 1), function (t) { for (var e in t) n[e] = t[e] }), n }, ephoxGetComputedStyle: function (t) { return t.ownerDocument.defaultView ? t.ownerDocument.defaultView.getComputedStyle(t, null) : t.currentStyle || {} }, log: function (t) { "undefined" != typeof console && console.log && console.log(t) }, compose: function (t) { var r = Array.prototype.slice.call(t).reverse(); return function (t) { for (var e = t, n = 0; n < r.length; n++)e = (0, r[n])(e); return e } } }, go = function (e, r, t, n) { var o, i, a, u, c, s = e.selection, f = e.dom, l = e.getBody(); if (c = t.isText(), t.reset(), n.clipboardData && n.clipboardData.getData("text/html")) { n.preventDefault(); var d = n.clipboardData.getData("text/html"), m = d.match(/<html[\s\S]+<\/html>/i), p = null === m ? d : m[0]; return r(p) } if (!f.get("_mcePaste")) { if (o = f.add(l, "div", { id: "_mcePaste", class: "mcePaste" }, '\ufeff<br _mce_bogus="1">'), u = l !== e.getDoc().body ? f.getPos(e.selection.getStart(), l).y : l.scrollTop, f.setStyles(o, { position: "absolute", left: -1e4, top: u, width: 1, height: 1, overflow: "hidden" }), tinymce.isIE) return (a = f.doc.body.createTextRange()).moveToElementText(o), a.execCommand("Paste"), f.remove(o), "\ufeff" === o.innerHTML ? (e.execCommand("mcePasteWord"), void n.preventDefault()) : (r(c ? o.innerText : o.innerHTML), tinymce.dom.Event.cancel(n)); var g = function (t) { t.preventDefault() }; if (f.bind(e.getDoc(), "mousedown", g), f.bind(e.getDoc(), "keydown", g), tinymce.isGecko && (a = e.selection.getRng(!0)).startContainer === a.endContainer && 3 === a.startContainer.nodeType) { var v = f.select("p,h1,h2,h3,h4,h5,h6,pre", o); 1 === v.length && f.remove(v.reverse(), !0) } i = e.selection.getRng(), o = o.firstChild, (a = e.getDoc().createRange()).setStart(o, 0), a.setEnd(o, 1), s.setRng(a), window.setTimeout(function () { var n = "", t = f.select("div.mcePaste"); po.each(t, function (t) { var e = t.firstChild; e && "DIV" === e.nodeName && e.style.marginTop && e.style.backgroundColor && f.remove(e, 1), po.each(f.select("div.mcePaste", t), function (t) { f.remove(t, 1) }), po.each(f.select("span.Apple-style-span", t), function (t) { f.remove(t, 1) }), po.each(f.select("br[_mce_bogus]", t), function (t) { f.remove(t) }), n += t.innerHTML }), po.each(t, function (t) { f.remove(t) }), i && s.setRng(i), r(n), f.unbind(e.getDoc(), "mousedown", g), f.unbind(e.getDoc(), "keydown", g) }, 0) } }, vo = { getOnPasteFunction: function (e, n, r) { return function (t) { go(e, n, r, t) } }, getOnKeyDownFunction: function (e, n, r) { return function (t) { (tinymce.isOpera || 0 < navigator.userAgent.indexOf("Firefox/2")) && ((tinymce.isMac ? t.metaKey : t.ctrlKey) && 86 === t.keyCode || t.shiftKey && 45 === t.keyCode) && go(e, n, r, t) } } }, ho = { insert: function (t, e) { var n, r = e.getDoc(), o = "ephoxInsertMarker", i = e.selection, a = e.dom; i.setContent('<span id="' + o + '">&nbsp;</span>'), n = a.get(o); for (var u = r.createDocumentFragment(); t.firstChild && !a.isBlock(t.firstChild);)u.appendChild(t.firstChild); for (var c = r.createDocumentFragment(); t.lastChild && !a.isBlock(t.lastChild);)c.appendChild(t.lastChild); if (n.parentNode.insertBefore(u, n), a.insertAfter(c, n), t.firstChild) { if (a.isBlock(t.firstChild)) { for (; !a.isBlock(n.parentNode) && n.parentNode !== a.getRoot();)n = a.split(n.parentNode, n); a.is(n.parentNode, "td,th") || n.parentNode === a.getRoot() || (n = a.split(n.parentNode, n)) } a.replace(t, n) } else a.remove(n) } }, yo = { officeStyles: "prompt", htmlStyles: "clean" }, bo = { strip_class_attributes: "all", retain_style_properties: "none" }, xo = { strip_class_attributes: "none", retain_style_properties: "valid" }, To = function (t, e, n) { var r = function (t, e) { if (t && "string" != typeof t) return t; switch (t) { case "clean": return bo; case "merge": return xo; default: return e } }(t, e); return r = po.extend(r, { base_64_images: n }) }, Eo = { create: function (t, e, n) { var r = To(t, bo, n), o = To(e, xo, n), i = o; return { setWordContent: function (t) { i = t ? r : o }, get: function (t) { return i[t] } } } }, wo = "startElement", Io = "endElement", So = "text", Lo = "comment", Co = function (o) { var i, e, a = 0, u = function () { return i }; e = function () { return i = {}, a = 0, po.each(o.attributes, function (t) { var e, n = t.nodeName, r = t.value; (!1 !== (e = t).specified || "name" === e.nodeName && "" !== e.value) && null != r && (i[n] = r, a++) }), void 0 === i.style && o.style.cssText && (i.style = o.style.cssText, a++), e = u, i }; var c, s, f = function (n) { po.each(e(), function (t, e) { n(e, t) }) }; return { get: function (t) { return e()[t] }, each: f, filter: function (t) { var n, r; c || (s = e), r = t, c = (n = c) && r ? function (t, e) { return r(t, n(t, e)) } : n || r, e = function () { return e = s, f(function (t, e) { var n = c(t, e); null === n ? (o.removeAttribute(t), delete i[t], a--) : n !== e && ("class" === t ? o.className = n : o.setAttribute(t, n), i[t] = n) }), e = u, i } }, getAttributes: function () { return e() }, getAttributeCount: function () { return e(), a } } }, No = function (t) { return t.replace(/-(.)/g, function (t, e) { return e.toUpperCase() }) }, Do = !1, Oo = function (i, t, e) { var n, r, o, a, u, c, s, f, l, d; switch (i.nodeType) { case 1: t ? n = Io : (n = wo, a = Co(i), u = {}, c = i, s = function (t, e) { u[t] = e }, null != (d = e || c.getAttribute("style")) && d.split || (d = c.style.cssText), po.each(d.split(";"), function (t) { var e = t.indexOf(":"); 0 < e && ((f = po.trim(t.substring(0, e))).toUpperCase() === f && (f = f.toLowerCase()), f = f.replace(/([A-Z])/g, function (t, e) { return "-" + e.toLowerCase() }), l = po.trim(t.substring(e + 1)), Do || (Do = 0 === f.indexOf("mso-")), s(f, l)) }), Do || (l = c.style["mso-list"]) && s("mso-list", l)), r = "HTML" !== i.scopeName && i.scopeName && i.tagName && i.tagName.indexOf(":") <= 0 ? (i.scopeName + ":" + i.tagName).toUpperCase() : i.tagName; break; case 3: n = So, o = i.nodeValue; break; case 8: n = Lo, o = i.nodeValue; break; default: po.log("WARNING: Unsupported node type encountered: " + i.nodeType) }var m = function () { return n }, p = function (t) { n === wo && a.filter(t) }; return { getNode: function () { return a && a.getAttributes(), i }, tag: function () { return r }, type: m, text: function () { return o }, toString: function () { return "Type: " + n + ", Tag: " + r + " Text: " + o }, getAttribute: function (t) { return a.get(t.toLowerCase()) }, filterAttributes: p, filterStyles: function (r) { if (m() === wo) { var o = ""; po.each(u, function (t, e) { var n = r(e, t); null === n ? (i.style.removeProperty ? i.style.removeProperty(No(e)) : i.style.removeAttribute(No(e)), delete u[e]) : (o += e + ": " + n + "; ", u[e] = n) }), o = o || null, p(function (t, e) { return "style" === t ? o : e }), i.style.cssText = o } }, getAttributeCount: function () { return a.getAttributeCount() }, attributes: function (t) { a.each(t) }, getStyle: function (t) { return u[t] }, styles: function (n) { po.each(u, function (t, e) { n(e, t) }) }, getComputedStyle: function () { return po.ephoxGetComputedStyle(i) }, isWhitespace: function () { return n === So && /^[\s\u00A0]*$/.test(o) } } }, Ao = function (t, e) { return Oo(e.createElement(t), !0) }, _o = Ao("HTML", window.document), Po = { START_ELEMENT_TYPE: wo, END_ELEMENT_TYPE: Io, TEXT_TYPE: So, COMMENT_TYPE: Lo, FINISHED: _o, token: Oo, createStartElement: function (t, e, n, r) { var o = r.createElement(t), i = ""; return po.each(e, function (t, e) { o.setAttribute(e, t) }), po.each(n, function (t, e) { i += e + ":" + t + ";", o.style[No(e)] = t }), Oo(o, !1, "" !== i ? i : null) }, createEndElement: Ao, createComment: function (t, e) { return Oo(e.createComment(t), !1) }, createText: function (t, e) { return Oo(e.createTextNode(t)) } }, ko = function (i) { var a = i.createDocumentFragment(), u = function (t) { a.appendChild(t) }; return { dom: a, receive: function (t) { var e, n, r, o; switch (t.type()) { case Po.START_ELEMENT_TYPE: o = t.getNode().cloneNode(!1), u(r = o), a = r; break; case Po.TEXT_TYPE: e = t, n = i.createTextNode(e.text()), u(n); break; case Po.END_ELEMENT_TYPE: a = a.parentNode; break; case Po.COMMENT_TYPE: break; default: throw { message: "Unsupported token type: " + t.type() } } } } }, Mo = function (t, o) { var i; o = o || window.document, i = o.createElement("div"), o.body.appendChild(i), i.style.position = "absolute", i.style.left = "-10000px", i.innerHTML = t; var a = i.firstChild || Po.FINISHED, u = [], c = !1; return { hasNext: function () { return void 0 !== a }, next: function () { var t, e, n = a, r = c; return !c && a.firstChild ? (u.push(a), a = a.firstChild) : c || 1 !== a.nodeType ? a.nextSibling ? (a = a.nextSibling, c = !1) : (a = u.pop(), c = !0) : c = !0, n === Po.FINISHED || a || (o.body.removeChild(i), a = Po.FINISHED), e = r, (t = n) === Po.FINISHED ? t : t ? Po.token(t, e) : void 0 } } }, Ro = function (p, g) { return function (e, t, n) { var r, o, i, a = !1, u = function () { g && g(m), a = !1, o = [], i = [] }, c = function (t) { po.each(t, function (t) { e.receive(t) }) }, s = function (t) { a ? i.push(t) : e.receive(t) }, f = function () { l(), c(i), u() }, l = function () { po.each(r, function (t) { s(t) }), d() }, d = function () { r = [] }, m = { document: n || window.document, settings: t || {}, emit: s, receive: function (t) { g && o.push(t), p(m, t), t === Po.FINISHED && f() }, startTransaction: function () { a = !0 }, rollback: function () { c(o), u() }, commit: f, defer: function (t) { (r = r || []).push(t) }, hasDeferred: function () { return r && 0 < r.length }, emitDeferred: l, dropDeferred: d }; return u(), m } }, Fo = Ro, jo = function (n) { return Ro(function (t, e) { e.filterAttributes(po.bind(n, t)), t.emit(e) }) }, Uo = /^(P|H[1-6]|T[DH]|LI|DIV|BLOCKQUOTE|PRE|ADDRESS|FIELDSET|DD|DT|CENTER)$/, Bo = function () { return null }, Yo = !1, Ho = Fo(function (t, e) { var n, r = function () { Yo || (t.emit(Po.createStartElement("P", {}, {}, t.document)), Yo = !0) }; switch (e.type()) { case Po.TEXT_TYPE: r(), t.emit(e); break; case Po.END_ELEMENT_TYPE: Yo && (n = e, Uo.test(n.tag()) || e === Po.FINISHED) ? (t.emit(Po.createEndElement("P", t.document)), Yo = !1) : "BR" === e.tag() && t.emit(e); break; case Po.START_ELEMENT_TYPE: "BR" === e.tag() ? (e.filterAttributes(Bo), e.filterStyles(Bo), t.emit(e)) : "IMG" === e.tag() && e.getAttribute("alt") && (r(), t.emit(Po.createText(e.getAttribute("alt"), t.document))) }e === Po.FINISHED && t.emit(e) }), Wo = function (t) { var e = t; return 65279 === e.charCodeAt(e.length - 1) ? e.substring(0, e.length - 1) : t }, qo = [Wo], $o = tinymce.isIE && 9 <= document.documentMode ? [function (t) { return t.replace(/<BR><BR>/g, "<br>") }, function (t) { return t.replace(/<br>/g, " ") }, function (t) { return t.replace(/<br><br>/g, "<BR><BR>") }, function (t) { return /<(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)/.test(t) ? t.replace(/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g, "$1") : t }].concat(qo) : qo, Vo = { all: po.compose($o), textOnly: Wo }, Xo = /^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/, Go = Fo(function (t, e) { var r, n = t.settings.get("retain_style_properties"); e.filterStyles((r = n, function (t, e) { var n = !1; switch (r) { case "all": case "*": n = !0; break; case "valid": n = !Xo.test(t); break; case void 0: case "none": n = "list-style-type" === t; break; default: n = 0 <= ("," + r + ",").indexOf("," + t + ",") }return n ? e : null })), t.emit(e) }), zo = Fo(function (t, e) { t.seenList || (t.inferring ? "LI" === e.tag() && (e.type() === Po.START_ELEMENT_TYPE ? t.inferring++ : (t.inferring-- , t.inferring || (t.needsClosing = !0))) : ("OL" === e.tag() || "UL" === e.tag() ? t.seenList = !0 : "LI" === e.tag() && (t.inferring = 1, t.needsClosing || t.emit(Po.createStartElement("UL", {}, {}, t.document))), !t.needsClosing || t.inferring || e.isWhitespace() || (t.needsClosing = !1, t.emit(Po.createEndElement("UL", t.document))))), t.emit(e) }), Ko = jo(function (t, e) { return "name" === t || "id" === t ? null : e }), Zo = jo(function (t, e) { if ("class" === t) switch (this.settings.get("strip_class_attributes")) { case "mso": return 0 === e.indexOf("Mso") ? null : e; case "none": return e; default: return null }return e }), Jo = function () { if (0 < navigator.userAgent.indexOf("Gecko") && navigator.userAgent.indexOf("WebKit") < 0) return !1; var t = document.createElement("div"); try { t.innerHTML = '<p style="mso-list: Ignore;">&nbsp;</p>' } catch (t) { return !1 } return "Ignore" === Po.token(t.firstChild).getStyle("mso-list") }(), Qo = function (t, e) { return t.type() === Po.START_ELEMENT_TYPE ? 0 === t.getAttributeCount() || e && 1 === t.getAttributeCount() && null !== t.getAttribute("style") && void 0 !== t.getAttribute("style") : t.type() === Po.END_ELEMENT_TYPE }, ti = Jo, ei = function (t) { return "A" === t.tag() || "SPAN" === t.tag() }, ni = function (t) { var e = t.getStyle("mso-list"); return e && "skip" !== e }, ri = [], oi = [], ii = !1, ai = function (t, e) { var n, r, o = 1; for (n = e + 1; n < t; n++)if ((r = ri[n]) && "SPAN" === r.tag()) if (r.type() === Po.START_ELEMENT_TYPE) o++; else if (r.type() === Po.END_ELEMENT_TYPE && 0 == --o) return void (ri[n] = null) }, ui = function (t, e) { if (ri.push(e), oi = oi || [], e.type() === Po.START_ELEMENT_TYPE) oi.push(e); else if (e.type() === Po.END_ELEMENT_TYPE && (oi.pop(), 0 === oi.length)) return void function (t) { if (ii) { var e = void 0, n = ri.length, r = void 0; for (r = 0; r < n; r++)(e = ri[r]) && (e.type() === Po.START_ELEMENT_TYPE && "SPAN" === e.tag() && Qo(e) ? ai(n, r) : t.emit(e)) } ri = [], ii = !(oi = []) }(t) }, ci = Fo(function (t, e) { var n = function (t) { return !(0 <= ",FONT,EM,STRONG,SAMP,ACRONYM,CITE,CODE,DFN,KBD,TT,B,I,U,S,SUB,SUP,INS,DEL,VAR,SPAN,".indexOf("," + t.tag() + ",") && Qo(t, !0)) }; 0 === (ri = ri || []).length ? e.type() === Po.START_ELEMENT_TYPE ? n(e) ? t.emit(e) : ui(t, e) : t.emit(e) : (ii || (ii = n(e)), ui(t, e)) }), si = jo(function (t, e) { return "style" === t && "" === e ? null : e }), fi = jo(function (t, e) { return "lang" === t ? null : e }), li = Fo(function (t, e) { if ("IMG" === e.tag()) { if (e.type() === Po.END_ELEMENT_TYPE && t.skipEnd) return void (t.skipEnd = !1); if (e.type() === Po.START_ELEMENT_TYPE) { if (/^file:/.test(e.getAttribute("src"))) return void (t.skipEnd = !0); if (t.settings.get("base_64_images") && /^data:image\/.*;base64/.test(e.getAttribute("src"))) return void (t.skipEnd = !0) } } t.emit(e) }), di = Fo(function (t, e) { "META" !== e.tag() && "LINK" !== e.tag() && t.emit(e) }), mi = function (t) { return !Qo(t) && !/^OLE_LINK/.test(t.getAttribute("name")) }, pi = [], gi = Fo(function (t, e) { var n; e.type() === Po.START_ELEMENT_TYPE && "A" === e.tag() ? (pi.push(e), mi(e) && t.defer(e)) : e.type() === Po.END_ELEMENT_TYPE && "A" === e.tag() ? (n = pi.pop(), mi(n) && t.defer(e), 0 === pi.length && t.emitDeferred()) : t.hasDeferred() ? t.defer(e) : t.emit(e) }), vi = !1, hi = [Fo(function (t, e) { "SCRIPT" === e.tag() ? vi = e.type() === Po.START_ELEMENT_TYPE : vi || (e.filterAttributes(function (t, e) { return /^on/.test(t) || "language" === t ? null : e }), t.emit(e)) }), Ko, li, Go, fi, si, Zo, gi, ci, di, zo], yi = Fo(function (t, n) { n.filterAttributes(function (t, e) { return "align" === t ? null : "UL" !== n.tag() && "OL" !== n.tag() || "type" !== t ? e : null }), t.emit(n) }), bi = jo(function (t, e) { return /^xmlns(:|$)/.test(t) ? null : e }), xi = Fo(function (t, e) { e.tag && /^([OVWXP]|U[0-9]+|ST[0-9]+):/.test(e.tag()) || t.emit(e) }), Ti = jo(function (t, e) { return "href" === t && (0 <= e.indexOf("#_Toc") || 0 <= e.indexOf("#_mso")) ? null : e }), Ei = jo(function (t, e) { return /^v:/.test(t) ? null : e }), wi = [{ regex: /^\(?[dc][\.\)]$/, type: { tag: "OL", type: "lower-alpha" } }, { regex: /^\(?[DC][\.\)]$/, type: { tag: "OL", type: "upper-alpha" } }, { regex: /^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/, type: { tag: "OL", type: "upper-roman" } }, { regex: /^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/, type: { tag: "OL", type: "lower-roman" } }, { regex: /^\(?[0-9]+[\.\)]$/, type: { tag: "OL" } }, { regex: /^([0-9]+\.)*[0-9]+\.?$/, type: { tag: "OL", variant: "outline" } }, { regex: /^\(?[a-z]+[\.\)]$/, type: { tag: "OL", type: "lower-alpha" } }, { regex: /^\(?[A-Z]+[\.\)]$/, type: { tag: "OL", type: "upper-alpha" } }], Ii = { "\u2022": { tag: "UL", type: "disc" }, "\xb7": { tag: "UL", type: "disc" }, "\xa7": { tag: "UL", type: "square" } }, Si = { o: { tag: "UL", type: "circle" }, "-": { tag: "UL", type: "disc" }, "\u25cf": { tag: "UL", type: "disc" } }, Li = function (t, e) { var n = { tag: t.tag, type: t.type, variant: e }; return t.start && (n.start = t.start), t.type || delete n.type, n }, Ci = function (t, e, n) { return t === e || t && e && t.tag === e.tag && t.type === e.type && (n || t.variant === e.variant) }, Ni = { guessListType: function (t, e, n) { var r, o, i, a = null; return t && (r = t.text, o = t.symbolFont), r = po.trim(r), (a = Si[r]) ? a = Li(a, r) : o ? a = (a = Ii[r]) ? Li(a, r) : { tag: "UL", variant: r } : (po.each(wi, function (t) { if (t.regex.test(r)) { if (e && Ci(t.type, e, !0)) return (a = t.type).start = parseInt(r, 10), !1; a || (a = t.type), a.start = parseInt(r, 10) } }), a && !a.variant && (i = "(" === r.charAt(0) ? "()" : ")" === r.charAt(r.length - 1) ? ")" : ".", a = Li(a, i))), a && "OL" === a.tag && n && ("P" !== n.tag() || /^MsoHeading/.test(n.getAttribute("class"))) && (a = null), a }, eqListType: Ci, checkFont: function (t, e) { if (t.type() === Po.START_ELEMENT_TYPE) { var n = t.getStyle("font-family"); n ? e = "Wingdings" === n || "Symbol" === n : /^(P|H[1-6]|DIV)$/.test(t.tag()) && (e = !1) } return e } }, Di = function (t) { var e = t.indexOf("."); if (0 <= e && void 0 === po.trim(t.substring(e + 1))) return (void 0)[2], !1 }, Oi = (lo = function (t, e) { var n, r = /([^{]+){([^}]+)}/g; for (r.lastIndex = 0; null !== (n = r.exec(t));)po.each(n[1].split(","), Di(void 0)); return !1 }, mo = {}, function (t, e) { var n, r = t + "," + e; return mo.hasOwnProperty(r) ? mo[r] : (n = lo.call(null, t, e), mo[r] = n) }), Ai = function (t, e) { var n, r, o, i = !1, a = function (t) { var e = t.style.fontFamily; e && (i = "Wingdings" === e || "Symbol" === e) }; if (t.type() === Po.START_ELEMENT_TYPE && e.openedTag && "SPAN" === t.tag()) { for (a(n = e.openedTag.getNode()), 1 < n.childNodes.length && "A" === n.firstChild.tagName && "" === n.firstChild.textContent && (n = n.childNodes[1]); n.firstChild && ("SPAN" === n.firstChild.tagName || "A" === n.firstChild.tagName);)a(n = n.firstChild); if (!(n = n.firstChild) || 3 !== n.nodeType) return n && "IMG" === n.tagName; if (r = n.value, po.trim(r) || (r = (n = n.parentNode.nextSibling) ? n.value : ""), !n || po.trim(n.parentNode.textContent) != r) return !1; if (o = Ni.guessListType({ text: r, symbolFont: i }, null, e.originalToken)) return n.nextSibling && "SPAN" === n.nextSibling.tagName && /^[\u00A0\s]/.test(n.nextSibling.firstChild.value) && ("P" === e.openedTag.tag() || "UL" === o.tag) } return !1 }, _i = function () { var a, u; return { guessIndentLevel: function (t, e, n, r) { var o, i; return r && /^([0-9]+\.)+[0-9]+\.?$/.test(r.text) ? r.text.replace(/([0-9]+|\.$)/g, "").length + 1 : (o = u || parseInt(Oi(n, e.getAttribute("class"))), i = function (t, e) { var n, r = 0; for (n = t.parentNode; null != n && n !== e.parentNode;)r += n.offsetLeft, n = n.offsetParent; return r }(t.getNode(), e.getNode()), o ? a ? i += a : 0 === i && (i += a = o) : o = 48, u = o = Math.min(i, o), Math.max(1, Math.floor(i / o)) || 1) } } }, Pi = function () { var e = !1; return { check: function (t) { return e && t.type() === Po.TEXT_TYPE ? (t.text(), !0) : t.type() === Po.START_ELEMENT_TYPE && "STYLE" === t.tag() ? e = !0 : t.type() === Po.END_ELEMENT_TYPE && "STYLE" === t.tag() && !(e = !1) } } }, ki = ["disc", "circle", "square"]; function Mi(a, u) { var i, o = [], c = [], s = 0, f = function (t, e) { var n = {}, r = {}; s++ , e && t.type && (n = { "list-style-type": t.type }), t.start && 1 < t.start && (r = { start: t.start }), o.push(t), a.emit(Po.createStartElement(t.tag, r, n, u)), i = t }, l = function () { a.emit(Po.createEndElement(o.pop().tag, u)), s-- , i = o[o.length - 1] }, d = function () { var t = c ? c.pop() : "P"; "P" !== t && a.emit(Po.createEndElement(t, u)), a.emit(Po.createEndElement("LI", u)) }, m = function (t, e, n) { var r = {}; if (t) { var o = t.getStyle("margin-left"); void 0 !== o && (r["margin-left"] = o) } else r["list-style-type"] = "none"; i && !Ni.eqListType(i, e) && (l(), n && (a.emit(Po.createStartElement("P", {}, {}, u)), a.emit(Po.createText("\xa0", u)), a.emit(Po.createEndElement("P", u))), f(e, !0)), a.emit(Po.createStartElement("LI", {}, r, u)), t && "P" !== t.tag() ? (c.push(t.tag()), t.filterStyles(function () { return null }), a.emit(t)) : c.push("P") }; return { openList: f, closelist: l, closeAllLists: function () { for (; 0 < s;)d(), l(); a.commit() }, closeItem: d, openLI: m, openItem: function (t, e, n, r) { if (n) { for (s || (s = 0); t < s;)d(), l(); var o, i; if (i = t, "UL" === (o = n).tag && ki[i - 1] === o.type && (o = { tag: "UL" }), n = o, s === t) d(), m(e, n, r); else for (1 < t && 0 < c.length && "P" !== c[c.length - 1] && (a.emit(Po.createEndElement(c[c.length - 1], u)), c[c.length - 1] = "P"); s < t;)f(n, s === t - 1), m(s === t ? e : void 0, n) } }, getCurrentListType: function () { return i }, getCurrentLevel: function () { return s } } } var Ri = function (t, e) { po.log("Unexpected token in list conversion: " + e.toString()), t.rollback() }, Fi = function (t, e, n) { n.type() === Po.TEXT_TYPE && "" === po.trim(n.text()) ? t.defer(n) : e.skippedPara || n.type() !== Po.START_ELEMENT_TYPE || "P" !== n.tag() || ni(n) ? Ui(t, e, n) : (e.openedTag = n, t.defer(n), e.nextFilter = ji) }, ji = function (t, e, n) { n.type() !== Po.START_ELEMENT_TYPE || "SPAN" !== n.tag() || 0 !== e.spanCount.length || !ti && Ai(n, e) || ni(n) ? n.type() === Po.END_ELEMENT_TYPE ? "SPAN" === n.tag() ? (t.defer(n), e.spanCount.pop()) : "P" === n.tag() ? (t.defer(n), e.skippedPara = !0, e.openedTag = null, e.nextFilter = Fi) : (e.nextFilter = Ui, e.nextFilter(t, e, n)) : n.isWhitespace() ? t.defer(n) : (e.nextFilter = Ui, e.nextFilter(t, e, n)) : (t.defer(n), e.spanCount.push(n)) }, Ui = function (t, e, n) { var r = function () { e.emitter.closeAllLists(), t.emitDeferred(), e.openedTag = null, t.emit(n), e.nextFilter = Ui }; if (n.type() === Po.START_ELEMENT_TYPE && ni(n) && "LI" !== n.tag()) { var o = / level([0-9]+)/.exec(n.getStyle("mso-list")); o && o[1] ? (e.itemLevel = parseInt(o[1], 10) + e.styleLevelAdjust, e.nextFilter === Ui ? t.emitDeferred() : t.dropDeferred(), e.nextFilter = Yi, t.startTransaction(), e.originalToken = n, e.commentMode = !1) : r() } else !ti && (n.type() === Po.COMMENT_TYPE && "[if !supportLists]" === n.text() || Ai(n, t)) ? (n.type() === Po.START_ELEMENT_TYPE && "SPAN" === n.tag() && e.spanCount.push(n), e.nextFilter = Yi, t.startTransaction(), e.originalToken = e.openedTag, e.commentMode = !0, e.openedTag = null, t.dropDeferred()) : n.type() === Po.END_ELEMENT_TYPE && ei(n) ? (t.defer(n), e.spanCount.pop()) : n.type() === Po.START_ELEMENT_TYPE ? ei(n) ? (t.defer(n), e.spanCount.push(n)) : (e.openedTag && (e.emitter.closeAllLists(), t.emitDeferred()), e.openedTag = n, t.defer(n)) : r() }, Bi = function (t, e, n) { n.type() === Po.END_ELEMENT_TYPE && e.originalToken.tag() === n.tag() && (e.nextFilter = Fi, e.styleLevelAdjust = -1), t.emit(n) }, Yi = function (t, e, n) { if (n.type() === Po.START_ELEMENT_TYPE && "Ignore" === n.getStyle("mso-list") && (e.nextFilter = Hi), n.type() === Po.START_ELEMENT_TYPE && "SPAN" === n.tag()) e.spanCount.push(n), (e.commentMode && "" === n.getAttribute("style") || null === n.getAttribute("style")) && (e.nextFilter = Hi); else if ("A" === n.tag()) n.type() === Po.START_ELEMENT_TYPE ? e.spanCount.push(n) : e.spanCount.pop(); else if (n.type() === Po.TEXT_TYPE) if (e.commentMode) e.nextFilter = Hi, e.nextFilter(t, e, n); else { var r = e.originalToken, o = e.spanCount; e.emitter.closeAllLists(), t.emit(r), po.each(o, po.bind(t.emit, t)), t.emit(n), t.commit(), e.originalToken = r, e.nextFilter = Bi } else (e.commentMode || n.type() !== Po.COMMENT_TYPE) && Ri(t, n) }, Hi = function (t, e, n) { n.type() === Po.TEXT_TYPE ? n.isWhitespace() || (e.nextFilter = Wi, e.bulletInfo = { text: n.text(), symbolFont: e.symbolFont }) : ei(n) ? n.type() === Po.START_ELEMENT_TYPE ? e.spanCount.push(n) : e.spanCount.pop() : n.type() === Po.START_ELEMENT_TYPE && "IMG" === n.tag() ? (e.nextFilter = Wi, e.bulletInfo = { text: "\u2202", symbolFont: !0 }) : Ri(t, n) }, Wi = function (t, e, n) { n.type() === Po.START_ELEMENT_TYPE && ei(n) ? (e.spanCount.push(n), e.nextFilter = qi) : n.type() === Po.END_ELEMENT_TYPE && ei(n) ? (e.spanCount.pop(), e.nextFilter = $i) : n.type() === Po.END_ELEMENT_TYPE && "IMG" === n.tag() || Ri(t, n) }, qi = function (t, e, n) { n.type() === Po.END_ELEMENT_TYPE && (ei(n) && e.spanCount.pop(), e.nextFilter = $i) }, $i = function (o, i, a) { var t = function (t) { var e, n, r; if (i.nextFilter = Vi, i.commentMode && (i.itemLevel = i.indentGuesser.guessIndentLevel(a, i.originalToken, i.styles.styles, i.bulletInfo)), i.listType = Ni.guessListType(i.bulletInfo, (e = i.emitter.getCurrentListType(), n = i.emitter.getCurrentLevel(), r = i.itemLevel, n === r ? e : null), i.originalToken), i.listType) { for (i.emitter.openItem(i.itemLevel, i.originalToken, i.listType, i.skippedPara), o.emitDeferred(); 0 < i.spanCount.length;)o.emit(i.spanCount.shift()); t && o.emit(a) } else po.log("Unknown list type: " + i.bulletInfo.text + " Symbol font? " + i.bulletInfo.symbolFont), o.rollback() }; a.type() === Po.TEXT_TYPE || a.type() === Po.START_ELEMENT_TYPE ? t(!0) : a.type() === Po.COMMENT_TYPE ? t("[endif]" !== a.text()) : a.type() === Po.END_ELEMENT_TYPE ? ei(a) && i.spanCount.pop() : Ri(o, a) }, Vi = function (t, e, n) { n.type() === Po.END_ELEMENT_TYPE && n.tag() === e.originalToken.tag() ? (e.nextFilter = Fi, e.skippedPara = !1) : t.emit(n) }, Xi = { initial: Ui }, Gi = {}, zi = function (t) { Gi.nextFilter = Xi.initial, Gi.itemLevel = 0, Gi.originalToken = null, Gi.commentMode = !1, Gi.openedTag = null, Gi.symbolFont = !1, Gi.listType = null, Gi.indentGuesser = _i(), Gi.emitter = Mi(t, t.document), Gi.styles = Pi(), Gi.spanCount = [], Gi.skippedPara = !1, Gi.styleLevelAdjust = 0, Gi.bulletInfo = void 0 }; zi({}); var Ki = [xi, Fo(function (t, e) { Gi.styles.check(e) || (Gi.symbolFont = Ni.checkFont(e, Gi.symbolFont), Gi.nextFilter(t, Gi, e)) }, function (t) { zi(t) }), Ti, Ei, bi, yi], Zi = function (t, e, n, r) { for (var o = ko(n), i = Mo(t, n), a = function (t, e, n, r) { var o, i = e; for (o = t.length - 1; 0 <= o; o--)i = t[o](i, n, r); return i }(r, o, e, n); i.hasNext();)a.receive(i.next()); return o.dom }, Ji = function (t) { return 0 <= t.indexOf("<o:p>") || 0 <= t.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal") || 0 <= t.indexOf("MsoListParagraphCxSpFirst") || 0 <= t.indexOf("<w:WordDocument>") }, Qi = { filter: function (t, e, n) { var r = Vo.all(t), o = Ji(r); e.setWordContent(o); var i = hi; return o && (i = Ki.concat(hi)), Zi(r, e, n, i) }, filterPlainText: function (t, e, n) { var r = Vo.textOnly(t); return Zi(r, e, n, [Ho]) }, isWordContent: Ji }; function ta(l, d) { return { showDialog: function (o) { var t, e, n, r, i, a, u = l.settings.powerpaste_word_import || yo.officeStyles, c = l.settings.powerpaste_html_import || yo.htmlStyles, s = Qi.isWordContent(o) ? u : c, f = function (t) { var e = { content: o }; l.fire("PastePreProcess", { content: e, internal: !1 }); var n = Eo.create(t, t, !0), r = Qi.filter(e.content, n, l.getDoc()); l.fire("PastePostProcess", { node: r, internal: !1 }), l.undoManager.transact(function () { ho.insert(r, l) }) }; "clean" === (a = s) || "merge" === a ? f(s) : (e = d("cement.dialog.paste.clean"), n = d("cement.dialog.paste.merge"), r = [{ text: e, ariaLabel: e, onclick: function () { t.close(), f("clean") } }, { text: n, ariaLabel: n, onclick: function () { t.close(), f("merge") } }], i = { title: d("cement.dialog.paste.title"), spacing: 10, padding: 10, items: [{ type: "container", html: d("cement.dialog.paste.instructions") }], buttons: r }, t = l.windowManager.open(i), setTimeout(function () { t && t.getEl().focus() }, 1)) } } } var ea = function (t) { return _t.blobToDataUri(t) }, na = function (t) { return _t.dataUriToBlobSync(t) }, ra = function (t) { return D.from(_t.uriToBlob(t)) }, oa = 0, ia = function (t) { var e = (new Date).getTime(); return t + "_" + Math.floor(1e9 * Math.random()) + ++oa + String(e) }, aa = fn.detect(), ua = function (t) { var e = Wn(t); return ca(t, e) }, ca = function (i, a) { return K.nu(function (o) { ea(i).then(function (t) { var e = Ft.fromBlobAndUrlSync(i, t), n = ia("image"), r = dt.blob(n, e, a); o(r) }) }) }, sa = function (t) { return 1 === t.length && P(t, "Files") }, fa = function (t) { return !P(t, "text/_moz_htmlcontext") }, la = function (t) { return P(t, "Files") }, da = function (t) { return !0 }, ma = { multiple: function (t) { return 0 === t.length ? K.pure([]) : Q(t, ua) }, toFiles: function (t) { return t.raw().target.files || t.raw().dataTransfer.files }, isFiles: aa.browser.isChrome() || aa.browser.isSafari() || aa.browser.isOpera() ? la : aa.browser.isFirefox() ? fa : aa.browser.isIE() ? sa : da, fromImages: function (t) { var e = M(t, function (t) { var e = ia("image"); return dt.url(e, me(t, "src"), t) }); return K.pure(e) }, single: ua, singleWithUrl: ca }, pa = { multiple: function (t) { return ma.multiple(t) }, single: function (t) { return ma.single(t) }, singleWithUrl: function (t, e) { return ma.singleWithUrl(t, e) } }; function ga(u, t, e, r) { var c, s = /^image\/(jpe?g|png|gif|bmp)$/i; u.on("dragstart dragend", function (t) { c = "dragstart" === t.type }), u.on("dragover dragend dragleave", function (t) { c || t.preventDefault() }); var f = function (t, e) { return e in t && 0 < t[e].length }, l = function (t) { var e = t["text/plain"]; return !!e && 0 === e.indexOf("file://") }, d = function (t) { pa.multiple(t).get(function (t) { var e = M(t, function (t) { var e = Se.fromTag("img"), n = dt.cata(t, r.getLocalURL, function (t, e, n) { return e }); return le(e, "src", n), e.dom().outerHTML }).join(""); u.insertContent(e, { merge: !1 !== u.settings.paste_merge_formats }), r.uploadImages(t) }) }; u.on("drop", function (t) { if (!c) { if (tinymce.dom.RangeUtils && tinymce.dom.RangeUtils.getCaretRangeFromPoint) { var e = tinymce.dom.RangeUtils.getCaretRangeFromPoint(t.clientX, t.clientY, u.getDoc()); e && u.selection.setRng(e) } var n = (a = (i = t).target.files || i.dataTransfer.files, F(a, function (t) { return s.test(t.type) })); if (0 < n.length) return d(n), void t.preventDefault(); var r = function (t) { var e = {}; if (t) { if (t.getData) { var n = t.getData("Text"); n && 0 < n.length && (e["text/plain"] = n) } if (t.types) for (var r = 0; r < t.types.length; r++) { var o = t.types[r]; e[o] = t.getData(o) } } return e }(t.dataTransfer); l(o = r) || !f(o, "text/html") && !f(o, "text/plain") || (ta(u, qt.translate).showDialog(r["text/html"] || r["text/plain"]), t.preventDefault()) } var o, i, a }) } var va = ["officeStyles", "htmlStyles", "isWord", "isGoogleDocs", "proxyBin", "isInternal", "backgroundAssets"], ha = De([], va), ya = { nu: ha, merge: function (t, n) { var r = {}; return R(va, function (e) { n[e]().or(t[e]()).each(function (t) { r[e] = t }) }), ha(r) } }, ba = at([{ error: ["message"] }, { paste: ["elements", "correlated"] }, { cancel: [] }, { incomplete: ["elements", "correlated", "message"] }]), xa = function (t, e, n, r, o) { return t.fold(e, n, r, o) }, Ta = { error: ba.error, paste: ba.paste, cancel: ba.cancel, incomplete: ba.incomplete, cata: xa, carry: function (t, r) { return xa(t, D.none, D.none, D.none, function (t, e, n) { return xa(r, D.none, function (t, e) { return D.some(ba.incomplete(t, e, n)) }, D.none, D.none) }).getOr(r) } }, Ea = De(["response", "bundle"], []), wa = function (e) { return Ia(function (t) { t(Ea(e)) }) }, Ia = function (e) { var t = function (t) { e(t) }, o = Ia; return { get: t, map: function (r) { return o(function (n) { t(function (t) { var e = r(t); n(e) }) }) }, bind: function (n) { return o(function (e) { t(function (t) { n(t).get(e) }) }) } } }, Sa = { call: function (t, e) { t(Ea(e)) }, sync: Ia, pure: wa, pass: function (t) { return wa({ response: t.response(), bundle: t.bundle() }) }, done: Ea, error: function (t) { return wa({ response: Ta.error(t), bundle: ya.nu({}) }) }, initial: function () { return wa({ response: Ta.paste([], []), bundle: ya.nu({}) }) }, cancel: function () { return wa({ response: Ta.cancel(), bundle: ya.nu({}) }) } }, La = function (t, e) { for (var n = 0; n < t.length; n++) { var r = e(t[n], n); if (r.isSome()) return r } return D.none() }, Ca = Le("steps", "input", "label", "capture"), Na = { choose: function (t, e, n) { var r; return (r = n, La(t, function (e) { return e.getAvailable(r).map(function (t) { return Ca(e.steps(), t, e.label(), e.capture()) }) })).getOrThunk(function () { var t = e.getAvailable(n); return Ca(e.steps(), t, e.label(), e.capture()) }) }, run: function (t, a) { return j(t, function (t, i) { return t.bind(function (t) { var r, e, n, o; return r = t, e = function () { return i(a, t) }, n = N(Sa.pass, r), o = function () { return e().map(function (t) { var e = ya.merge(r.bundle(), t.bundle()), n = Ta.carry(r.response(), t.response()); return Sa.done({ response: n, bundle: e }) }) }, Ta.cata(r.response(), n, o, n, o) }) }, Sa.initial()) } }, Da = function (t) { t.dom().textContent = "", R(Sn(t), function (t) { Oa(t) }) }, Oa = function (t) { var e = t.dom(); null !== e.parentNode && e.parentNode.removeChild(e) }, Aa = function (t) { var e, n = Sn(t); 0 < n.length && (e = t, R(n, function (t) { Dn(e, t) })), Oa(t) }, _a = function (t) { return e = t, n = !1, Se.fromDom(e.dom().cloneNode(n)); var e, n }, Pa = function (t) { return void 0 !== t.style }, ka = function (t, e, n) { if (!w(n)) throw y.console.error("Invalid call to CSS.set. Property ", e, ":: Value ", n, ":: Element ", t), new Error("CSS value must be a string: " + n); Pa(t) && t.style.setProperty(e, n) }, Ma = function (t, e, n) { var r = t.dom(); ka(r, e, n) }, Ra = function (t, e) { var n = t.dom(); et(e, function (t, e) { ka(n, e, t) }) }, Fa = function (t, e) { var n = t.dom(), r = y.window.getComputedStyle(n).getPropertyValue(e), o = "" !== r || Rn(t) ? r : ja(n, e); return null === o ? void 0 : o }, ja = function (t, e) { return Pa(t) ? t.style.getPropertyValue(e) : "" }, Ua = function (t, e) { var n = t.dom(), r = ja(n, e); return D.from(r).filter(function (t) { return 0 < t.length }) }, Ba = function (t, e) { var n, r, o = t.dom(); r = e, Pa(n = o) && n.style.removeProperty(r), pe(t, "style") && "" === nn(me(t, "style")) && ge(t, "style") }, Ya = function (t) { return ue(t) ? (e = "v:shape", n = t.dom().nodeValue, r = Se.fromTag("div"), o = n.indexOf("]>"), r.dom().innerHTML = n.substr(o + "]>".length), ur(r, function (t) { return oe(t) === e })) : D.none(); var e, n, r, o }, Ha = function (t) { return jn(t, ".rtf-data-image") }, Wa = { local: function (t) { if ("img" === oe(t)) { var e = me(t, "src"); if (null != e && tn(e, "file://")) { var n = _a(t), r = e.split(/[\/\\]/), o = r[r.length - 1]; return le(n, "data-image-id", o), ge(n, "src"), le(n, "data-image-type", "local"), Te(n, "rtf-data-image"), D.some(n) } return D.none() } return D.none() }, vshape: function (t) { return Ya(t).map(function (t) { var e = me(t, "o:spid"), n = void 0 === e ? me(t, "id") : e, r = Se.fromTag("img"); return Te(r, "rtf-data-image"), le(r, "data-image-id", n.substr("_x0000_".length)), le(r, "data-image-type", "code"), Ra(r, { width: Fa(t, "width"), height: Fa(t, "height") }), r }) }, find: Ha, exists: function (t) { return 0 < Ha(t).length }, scour: Ya }, qa = function () { return /^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/ }, $a = function () { return /^(font|em|strong|samp|acronym|cite|code|dfn|kbd|tt|b|i|u|s|sub|sup|ins|del|var|span)$/ }, Va = at([{ starts: ["value", "f"] }, { pattern: ["regex", "f"] }, { contains: ["value", "f"] }, { exact: ["value", "f"] }, { all: [] }, { not: ["stringMatch"] }]), Xa = function (t, n) { return t.fold(function (t, e) { return 0 === e(n).indexOf(e(t)) }, function (t, e) { return t.test(e(n)) }, function (t, e) { return 0 <= e(n).indexOf(e(t)) }, function (t, e) { return e(n) === e(t) }, function () { return !0 }, function (t) { return !Xa(t, n) }) }, Ga = { starts: Va.starts, pattern: Va.pattern, contains: Va.contains, exact: Va.exact, all: Va.all, not: Va.not, cata: function (t, e, n, r, o, i, a) { return t.fold(e, n, r, o, i, a) }, matches: Xa, caseSensitive: function (t) { return t }, caseInsensitive: function (t) { return t.toLowerCase() } }, za = function (t, e, n, r) { var o = r.name, i = void 0 !== r.condition ? r.condition : v(!0), a = void 0 !== r.value ? r.value : Ga.all(); return Ga.matches(o, n) && Ga.matches(a, e) && i(t) }, Ka = function (t, e) { var n = oe(t), r = e.name, o = void 0 !== e.condition ? e.condition : v(!0); return Ga.matches(r, n) && o(t) }, Za = function (t, e) { var n = {}; return R(t.dom().attributes, function (t) { e(t.value, t.name) || (n[t.name] = t.value) }), n }, Ja = function (t, e, n) { var r, o, i = M(t.dom().attributes, function (t) { return t.name }); it(e) !== i.length && (r = t, o = e, R(i, function (t) { ge(r, t) }), et(o, function (t, e) { le(r, e, t) })) }, Qa = (v({}), function (e) { var t = tt(e); return M(t, function (t) { return t + ": " + e[t] }).join("; ") }), tu = function (r, o) { var t = r.dom().style, i = {}; return R(null == t ? [] : t, function (t) { var e, n = (e = t, r.dom().style.getPropertyValue(e)); o(n, t) || (i[t] = n) }), i }, eu = function (n, t, e) { le(n, "style", ""); var r = it(t), o = it(e); if (0 === r && 0 === o) ge(n, "style"); else if (0 === r) le(n, "style", Qa(e)); else { et(t, function (t, e) { Ma(n, e, t) }); var i = me(n, "style"), a = 0 < o ? Qa(e) + "; " : ""; le(n, "style", a + i) } }, nu = function (t, e, n) { var r, o, i, a = t.dom().getAttribute("style"), u = (o = {}, i = null != (r = a) ? r.split(";") : [], R(i, function (t) { var e = t.split(":"); 2 === e.length && (o[nn(e[0])] = nn(e[1])) }), o), c = {}; return R(e, function (t) { var e = u[t]; void 0 === e || n(e, t) || (c[t] = e) }), c }, ru = ["mso-list"], ou = function (t, e) { var n = nu(t, ru, e), r = tu(t, e); eu(t, r, n) }, iu = function (t, e) { var n = Za(t, e); Ja(t, n, {}) }, au = ou, uu = iu, cu = function (t, e) { ou(Se.fromDom(t), e) }, su = function (t, r, o) { t(o, function (e, n) { return k(r, function (t) { return za(o, e, n, t) }) }) }, fu = function (t, e) { var r = ft({ styles: [], attributes: [], classes: [], tags: [] }, e), n = jn(t, "*"); R(n, function (n) { su(au, r.styles, n), su(uu, r.attributes, n), R(r.classes, function (e) { var t = pe(n, "class") ? rr(n) : []; R(t, function (t) { Ga.matches(e.name, t) && Ee(n, t) }) }) }); var o = jn(t, "*"); R(o, function (t) { k(r.tags, N(Ka, t)) && Oa(t) }) }, lu = function (t, e) { var n = ft({ tags: [] }, e), r = jn(t, "*"); R(r, function (t) { k(n.tags, N(Ka, t)) && Aa(t) }) }, du = function (t, e) { var n = ft({ tags: [] }, e), r = jn(t, "*"); R(r, function (e) { U(n.tags, N(Ka, e)).each(function (t) { t.mutate(e) }) }) }, mu = "startElement", pu = "endElement", gu = "comment", vu = function (t, e, n) { var r, o, i, a = Se.fromDom(t); switch (t.nodeType) { case 1: e ? r = pu : (r = mu, Ra(a, n || {})), o = "HTML" !== t.scopeName && t.scopeName && t.tagName && t.tagName.indexOf(":") <= 0 ? (t.scopeName + ":" + t.tagName).toUpperCase() : t.tagName; break; case 3: r = "text", i = t.nodeValue; break; case 8: r = gu, i = t.nodeValue; break; default: y.console.log("WARNING: Unsupported node type encountered: " + t.nodeType) }return { getNode: function () { return t }, tag: function () { return o }, type: function () { return r }, text: function () { return i } } }, hu = function (t, e) { return vu(e.createElement(t), !0) }, yu = hu("HTML", y.window.document), bu = { START_ELEMENT_TYPE: mu, END_ELEMENT_TYPE: pu, TEXT_TYPE: "text", COMMENT_TYPE: gu, FINISHED: yu, token: vu, createStartElement: function (t, e, n, r) { var o = r.createElement(t); return et(e, function (t, e) { o.setAttribute(e, t) }), vu(o, !1, n) }, createEndElement: hu, createComment: function (t, e) { return vu(e.createComment(t), !1) }, createText: function (t, e) { return vu(e.createTextNode(t)) } }, xu = function (i) { var a = i.createDocumentFragment(), u = a, c = function (t) { a.appendChild(t) }; return { dom: u, receive: function (t) { var e, n, r, o; switch (t.type()) { case bu.START_ELEMENT_TYPE: o = t.getNode().cloneNode(!1), c(r = o), a = r; break; case bu.TEXT_TYPE: e = t, n = i.createTextNode(e.text()), c(n); break; case bu.END_ELEMENT_TYPE: null === (a = a.parentNode) && (a = u); break; case bu.COMMENT_TYPE: break; default: throw { message: "Unsupported token type: " + t.type() } } }, label: "SERIALISER" } }, Tu = function (t, o) { var i; o = o || y.window.document, i = o.createElement("div"), o.body.appendChild(i), i.style.position = "absolute", i.style.left = "-10000px", i.innerHTML = t; var a = i.firstChild || bu.FINISHED, u = [], c = !1; return { hasNext: function () { return void 0 !== a }, next: function () { var t, e, n = a, r = c; return !c && a.firstChild ? (u.push(a), a = a.firstChild) : c || 1 !== a.nodeType ? a.nextSibling ? (a = a.nextSibling, c = !1) : (a = u.pop(), c = !0) : c = !0, n === bu.FINISHED || a || (o.body.removeChild(i), a = bu.FINISHED), e = r, (t = n) === bu.FINISHED ? t : t ? bu.token(t, e) : void 0 } } }, Eu = function (t, e, n) { var r, o = n; for (r = e.length - 1; 0 <= r; r--)o = e[r](o, {}, t); return o }, wu = function (t, e, n) { for (var r = xu(t), o = Tu(e, t), i = Eu(t, n, r); o.hasNext();) { var a = o.next(); i.receive(a) } return r.dom }, Iu = function (t) { return t.dom().innerHTML }, Su = function (t, e) { var n = bn(t).dom(), r = Se.fromDom(n.createDocumentFragment()), o = Nn(e, n); Mn(r, o), Da(t), _n(t, r) }, Lu = function (e) { return function (t) { fu(t, e) } }, Cu = function (e) { return function (t) { lu(t, e) } }, Nu = function (e) { return function (t) { du(t, e) } }, Du = function (o) { return function (t) { var e = Iu(t), n = bn(t), r = wu(n.dom(), e, o); Da(t), t.dom().appendChild(r) } }, Ou = function (t, e) { return 0 <= t.indexOf("<o:p>") || e.browser.isEdge() && 0 <= t.indexOf('v:shapes="') || e.browser.isEdge() && 0 <= t.indexOf("mso-") || 0 <= t.indexOf("mso-list") || 0 <= t.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal") || 0 <= t.indexOf("MsoListParagraphCxSpFirst") || 0 <= t.indexOf("<w:WordDocument>") }, Au = function (t, e, n) { var r = Se.fromTag("div", t.dom()); return r.dom().innerHTML = e, R(n, function (t) { t(r) }), Iu(r) }; function _u(a, u, t) { return function (e, t, n) { var r = function (t) { e.receive(t) }, o = function (t, e, n) { return n = void 0 !== n ? n : t.type() === bu.END_ELEMENT_TYPE, bu.token(e, n, {}) }, i = { emit: r, emitTokens: function (t) { R(t, r) }, receive: function (t) { a(i, t, o) }, document: y.window.document }; return u(i), i } } var Pu = function (t, e) { var n = Se.fromDom(t.getNode()); return me(n, e) }, ku = function (t, e) { var n = Se.fromDom(t.getNode()); return Fa(n, e) }, Mu = function (t) { return t.type() === bu.TEXT_TYPE && /^[\s\u00A0]*$/.test(t.text()) }, Ru = function (t, e, n) { return t === e || t && e && t.tag === e.tag && t.type === e.type && (n || t.variant === e.variant) }, Fu = { guessFrom: function (e, n) { return U(e, function (t) { return "UL" === t.tag || n && Ru(t, n, !0) }).orThunk(function () { return 0 === (t = e).length ? D.none() : D.some(t[0]); var t }) }, eqListType: Ru }, ju = function (t, e) { if (void 0 === t || void 0 === e) throw y.console.trace(), "brick"; t.nextFilter.set(e) }, Uu = function (t, e, n) { e.nextFilter.get()(t, e, n) }, Bu = ju, Yu = Uu, Hu = Le("level", "token", "type"), Wu = function (t, n, e, r) { var o = e.getCurrentListType(), i = e.getCurrentLevel() == r.level() ? o : null; return Fu.guessFrom(r.emblems(), i).filter(function (t) { return !("OL" === t.tag && (!P(["P"], (e = n).tag()) || /^MsoHeading/.test(Pu(e, "class")))); var e }) }, qu = function (t, e) { return pe(Se.fromDom(e.getNode()), "data-list-level") }, $u = function (d) { return function (t, e, n) { var r, o, i, a, u = (r = Se.fromDom(n.getNode()), o = parseInt(me(r, "data-list-level"), 10), i = me(r, "data-list-emblems"), a = JSON.parse(i), ge(r, "data-list-level"), ge(r, "data-list-emblems"), { level: v(o), emblems: v(a) }); u.level(), e.originalToken.set(n); var c, s, f, l = (c = n, s = u, Wu((f = e).listType.get(), c, f.emitter, s).each(f.listType.set), Hu(s.level(), f.originalToken.get(), f.listType.get())); e.emitter.openItem(l.level(), l.token(), l.type()), Bu(e, d.inside()) } }; function Vu(t, e, n) { return { pred: t, action: e, label: v(n) } } var Xu = function (t, r) { return function (t, e, n) { return r(t, e, n) } }; function Gu(t, r, e) { var o = Xu(0, e), n = function (t, e, n) { U(r, function (t) { return t.pred(e, n) }).fold(v(o), function (t) { var e = t.label(); return void 0 === e ? t.action : Xu(0, t.action) })(t, e, n) }; return n.toString = function () { return "Handlers for " + t }, n } var zu, Ku, Zu, Ju, Qu, tc = function (r) { return Gu("Inside.List.Item", [Vu(function (t, e) { return e.type() === bu.END_ELEMENT_TYPE && t.originalToken.get() && e.tag() === t.originalToken.get().tag() }, function (t, e, n) { Bu(e, r.outside()) }, "Closing open tag")], function (t, e, n) { t.emit(n) }) }, ec = function (r) { return Gu("Outside.List.Item", [Vu(qu, $u(r), "Data List ****"), Vu(function (t, e) { return e.type() === bu.TEXT_TYPE && Mu(e) }, function (t, e, n) { t.emit(n) }, "Whitespace")], function (t, e, n) { e.emitter.closeAllLists(), t.emit(n), Bu(e, r.outside()) }) }, nc = Le("state", "result"), rc = Le("state", "value"), oc = { state: Le("level", "type", "types", "items"), value: rc, result: nc }, ic = function (t, e) { var n = t.items().slice(0), r = void 0 !== e && "P" !== e ? D.some(e) : D.none(); r.fold(function () { n.push("P") }, function (t) { n.push(t) }); var o = oc.state(t.level(), t.type(), t.types(), n); return oc.value(o, r) }, ac = function (t) { var e = t.items().slice(0); if (0 < e.length && "P" !== e[e.length - 1]) { var n = e[e.length - 1]; e[e.length - 1] = "P"; var r = oc.state(t.level(), t.type(), t.types(), e); return oc.value(r, D.some(n)) } return oc.value(t, D.none()) }, uc = function (t, e, n) { for (var r = [], o = t; e(o);) { var i = n(o); o = i.state(), r = r.concat(i.result()) } return oc.result(o, r) }, cc = function (t, e, n) { return uc(t, function (t) { return t.level() < e }, n) }, sc = function (t, e, n) { return uc(t, function (t) { return t.level() > e }, n) }, fc = function (t) { var e; return t ? void 0 !== (e = ku(t, "margin-left")) && "0px" !== e ? { "margin-left": e } : {} : { "list-style-type": "none" } }, lc = function (t, e, n) { var r = e.start && 1 < e.start ? { start: e.start } : {}, o = t.level() + 1, i = e, a = t.types().concat([e]), u = [N(bu.createStartElement, e.tag, r, n)], c = oc.state(o, i, a, t.items()); return oc.result(c, u) }, dc = function (t) { var e = t.types().slice(0), n = [N(bu.createEndElement, e.pop().tag)], r = t.level() - 1, o = e[e.length - 1], i = oc.state(r, o, e, t.items()); return oc.result(i, n) }, mc = lc, pc = function (t, e, n) { var r, o, i, a = fc(e), u = t.type() && !Fu.eqListType(t.type(), n) ? (r = n, o = dc(t), i = lc(o.state(), r, r.type ? { "list-style-type": r.type } : {}), oc.result(i.state(), o.result().concat(i.result()))) : oc.result(t, []), c = [N(bu.createStartElement, "LI", {}, a)], s = ic(u.state(), e && e.tag()), f = s.value().map(function (t) { return cu(e.getNode(), v(!0)), [v(e)] }).getOr([]); return oc.result(s.state(), u.result().concat(c).concat(f)) }, gc = dc, vc = function (t) { var e = N(bu.createEndElement, "LI"), n = ac(t), r = n.value().fold(function () { return [e] }, function (t) { return [N(bu.createEndElement, t), e] }); return oc.result(n.state(), r) }, hc = function (t) { if (0 === t.length) throw "Compose must have at least one element in the list"; var e = t[t.length - 1], n = q(t, function (t) { return t.result() }); return oc.result(e.state(), n) }, yc = function (t) { var e = vc(t), n = gc(e.state()); return hc([e, n]) }, bc = function (t, c, s, f) { return cc(t, s, function (t) { return n = c, r = s, o = f, i = (e = t).level() === r - 1 && n.type ? { "list-style-type": n.type } : {}, a = mc(e, n, i), u = pc(a.state(), a.state().level() == r ? o : void 0, n), hc([a, u]); var e, n, r, o, i, a, u }) }, xc = function (t, e) { return sc(t, e, yc) }, Tc = { openItem: function (t, e, n, r) { var o, i, a, u, c, s, f, l, d, m, p, g, v = t.level() > e ? xc(t, e) : oc.result(t, []), h = v.state().level() === e ? (l = v.state(), d = r, m = n, p = 0 < l.level() ? vc(l) : oc.result(l, []), g = pc(p.state(), m, d), hc([p, g])) : (o = v.state(), i = r, u = n, c = 1 < (a = e) ? ac(o) : oc.value(o, D.none()), s = c.value().map(function (t) { return [N(bu.createEndElement, t)] }).getOr([]), c.state().level(), f = bc(c.state(), i, a, u), oc.result(f.state(), s.concat(f.result()))); return hc([v, h]) }, closeAllLists: xc }, Ec = ["disc", "circle", "square"], wc = function (t, e) { return "UL" === t.tag && Ec[e - 1] === t.type && (t = { tag: "UL" }), t }, Ic = function (t) { var e = t, n = function () { return e }; return { get: n, set: function (t) { e = t }, clone: function () { return Ic(n()) } } }, Sc = { getCurrentListType: function () { return Lc().getCurrentListType() }, getCurrentLevel: function () { return Lc().getCurrentLevel() }, closeAllLists: function () { return Lc().closeAllLists.apply(void 0, arguments) }, openItem: function () { return Lc().openItem.apply(void 0, arguments) } }, Lc = function () { return { getCurrentListType: v({}), getCurrentLevel: v(1), closeAllLists: l, openItem: l } }, Cc = { inside: function () { return Dc }, outside: function () { return Oc } }, Nc = (zu = !1, { check: function (t) { return zu && t.type() === bu.TEXT_TYPE ? (t.text(), !0) : t.type() === bu.START_ELEMENT_TYPE && "STYLE" === t.tag() ? zu = !0 : t.type() === bu.END_ELEMENT_TYPE && "STYLE" === t.tag() && !(zu = !1) } }), Dc = tc(Cc), Oc = ec(Cc), Ac = (Zu = Ic(Ku = Oc), Ju = Ic(null), Qu = Ic(null), { reset: function (t) { Zu.set(Ku), Ju.set(null), Qu.set(null); var n, r, i, a, e = (r = (n = t).document, i = oc.state(0, void 0, [], []), a = function (t) { R(t.result(), function (t) { var e = t(r); n.emit(e) }) }, { closeAllLists: function () { var t = Tc.closeAllLists(i, 0); i = t.state(), a(t) }, openItem: function (t, e, n) { if (n) { var r = wc(n, t), o = Tc.openItem(i, t, e, r); i = o.state(), a(o) } }, getCurrentListType: function () { return i.type() }, getCurrentLevel: function () { return i.level() } }); Lc = v(e) }, nextFilter: Zu, originalToken: Ju, listType: Qu, emitter: Sc }), _c = _u(function (t, e, n) { Nc.check(e) || Yu(t, Ac, e) }, Ac.reset), Pc = [{ regex: /^\(?[dc][\.\)]$/, type: { tag: "OL", type: "lower-alpha" } }, { regex: /^\(?[DC][\.\)]$/, type: { tag: "OL", type: "upper-alpha" } }, { regex: /^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/, type: { tag: "OL", type: "upper-roman" } }, { regex: /^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/, type: { tag: "OL", type: "lower-roman" } }, { regex: /^\(?[0-9]+[\.\)]$/, type: { tag: "OL" } }, { regex: /^([0-9]+\.)*[0-9]+\.?$/, type: { tag: "OL", variant: "outline" } }, { regex: /^\(?[a-z]+[\.\)]$/, type: { tag: "OL", type: "lower-alpha" } }, { regex: /^\(?[A-Z]+[\.\)]$/, type: { tag: "OL", type: "upper-alpha" } }], kc = { "\u2022": { tag: "UL", type: "disc" }, "\xb7": { tag: "UL", type: "disc" }, "\xa7": { tag: "UL", type: "square" } }, Mc = { o: { tag: "UL", type: "circle" }, "-": { tag: "UL", type: "disc" }, "\u25cf": { tag: "UL", type: "disc" }, "\ufffd": { tag: "UL", type: "circle" } }, Rc = function (u, t) { var e = Mc[u] ? [Mc[u]] : [], n = t && kc[u] ? [kc[u]] : t ? [{ tag: "UL", variant: u }] : [], r = q(Pc, function (t) { return t.regex.test(u) ? [ft(t.type, (r = u, o = r.split("."), i = function () { if (0 === o.length) return r; var t = o[o.length - 1]; return 0 === t.length && 1 < o.length ? o[o.length - 2] : t }(), a = parseInt(i, 10), isNaN(a) ? {} : { start: a }), { variant: (e = t.type, n = u, void 0 !== e.variant ? e.variant : "(" === n.charAt(0) ? "()" : ")" === n.charAt(n.length - 1) ? ")" : ".") })] : []; var e, n, r, o, i, a }), o = e.concat(n).concat(r); return M(o, function (t) { return void 0 !== t.variant ? t : ft(t, { variant: u }) }) }, Fc = function (t) { return t.dom().textContent }, jc = function (t) { return nu(t, ["mso-list"], v(!1))["mso-list"] }, Uc = function (t) { return ce(t) && Ua(t, "font-family").exists(function (t) { return P(["wingdings", "symbol"], t.toLowerCase()) }) }, Bc = { getMsoList: jc, extractLevel: function (t) { var e = jc(t), n = / level([0-9]+)/.exec(e); return n && n[1] ? D.some(parseInt(n[1], 10)) : D.none() }, extractEmblem: function (t, e) { var n = Fc(t).trim(), r = Rc(n, e); return 0 < r.length ? D.some(r) : D.none() }, extractSymSpan: function (t) { return ar(t, Uc) }, extractMsoIgnore: function (t) { return ur(t, function (t) { return !!(ce(t) ? nu(t, ["mso-list"], v(!1)) : [])["mso-list"] }) }, extractCommentSpan: function (t) { return ar(t, ue).bind(wn).filter(function (t) { return "span" === oe(t) }) }, isSymbol: Uc, deduceLevel: function (t) { return Ua(t, "margin-left").bind(function (t) { var e = parseInt(t, 10); return isNaN(e) ? D.none() : D.some(Math.max(1, Math.ceil(e / 18))) }) } }, Yc = function (t) { for (var e = []; null !== t.nextNode();)e.push(Se.fromDom(t.currentNode)); return e }, Hc = fn.detect().browser, Wc = Hc.isIE() || Hc.isEdge() ? function (t) { try { return Yc(t) } catch (t) { return [] } } : Yc, qc = v(v(!0)), $c = function (t, e) { var n = e.fold(qc, function (e) { return function (t) { return e(t.nodeValue) } }); n.acceptNode = n; var r = y.document.createTreeWalker(t.dom(), Et.getOrDie("NodeFilter").SHOW_COMMENT, n, !1); return Wc(r) }, Vc = function (t, e, n, r) { var o; !function (t, e, n) { le(t, "data-list-level", e); var r = JSON.stringify(n); le(t, "data-list-emblems", r) }(t, e, n), o = $c(t, D.none()), R(o, Oa), R(r, Oa), ge(t, "style"), ge(t, "class") }, Xc = function (t) { return (r = t, Bc.extractLevel(r).bind(function (n) { return Bc.extractSymSpan(r).bind(function (e) { return Bc.extractEmblem(e, !0).map(function (t) { return { mutate: function () { Vc(r, n, t, [e]) } } }) }) })).orThunk(function () { return r = t, Bc.extractLevel(r).bind(function (n) { return Bc.extractCommentSpan(r).bind(function (e) { return Bc.extractEmblem(e, Bc.isSymbol(e)).map(function (t) { return { mutate: function () { Vc(r, n, t, [e]) } } }) }) }); var r }).orThunk(function () { return r = t, Bc.extractLevel(r).bind(function (n) { return Bc.extractCommentSpan(r).bind(function (e) { return Bc.extractEmblem(e, Bc.isSymbol(e)).map(function (t) { return { mutate: function () { Vc(r, n, t, [e]) } } }) }) }); var r }).orThunk(function () { return "p" !== oe(r = t) ? D.none() : Bc.extractLevel(r).bind(function (n) { return Bc.extractMsoIgnore(r).bind(function (e) { return Bc.extractEmblem(e, !1).map(function (t) { return { mutate: function () { Vc(r, n, t, [xn(e).getOr(e)]) } } }) }) }); var r }).orThunk(function () { return "p" !== oe(r = t) ? D.none() : Bc.extractMsoIgnore(r).bind(function (t) { var n = xn(t).getOr(t), e = Bc.isSymbol(n); return Bc.extractEmblem(t, e).bind(function (e) { return Bc.deduceLevel(r).map(function (t) { return { mutate: function () { Vc(r, t, e, [n]) } } }) }) }); var r }); var r }, Gc = { filter: _c, preprocess: Nu({ tags: [{ name: Ga.pattern(/^(p|h\d+)$/, Ga.caseInsensitive), mutate: function (t) { Xc(t).each(function (t) { t.mutate() }) } }] }) }, zc = function (t, e) { return ur(t, e).isSome() }, Kc = function (t) { return void 0 === t.dom().attributes || null === t.dom().attributes || 0 === t.dom().attributes.length || 1 === t.dom().attributes.length && "style" === t.dom().attributes[0].name }, Zc = { isNotImage: function (t) { return "img" !== oe(t) }, hasContent: function (t) { return !Kc(t) || (n = (e = t).dom().attributes, r = null != n && 0 < n.length, ("span" !== oe(e) || r) && zc(t, function (t) { var e = !Kc(t), n = !P(["font", "em", "strong", "samp", "acronym", "cite", "code", "dfn", "kbd", "tt", "b", "i", "u", "s", "sub", "sup", "ins", "del", "var", "span"], oe(t)); return se(t) || e || n })); var e, n, r }, isList: function (t) { return "ol" === oe(t) || "ul" === oe(t) }, isLocal: function (t) { var e = me(t, "src"); return /^file:/.test(e) }, hasNoAttributes: Kc, isEmpty: function (t) { return 0 === Iu(t).length } }; function Jc(n, r) { var e = function (t) { return n(t) ? D.from(t.dom().nodeValue) : D.none() }, t = fn.detect().browser, o = t.isIE() && 10 === t.version.major ? function (t) { try { return e(t) } catch (t) { return D.none() } } : e; return { get: function (t) { if (!n(t)) throw new Error("Can only get " + r + " value of a " + r + " node"); return o(t).getOr("") }, getOption: o, set: function (t, e) { if (!n(t)) throw new Error("Can only set raw " + r + " value of a " + r + " node"); t.dom().nodeValue = e } } } var Qc, ts, es, ns, rs, os, is, as = Jc(se, "text"), us = function (t) { return as.get(t) }, cs = function (t, e) { as.set(t, e) }, ss = function (t, e) { var n = Se.fromTag(t); Dn(e, n); var r = e.dom().attributes; R(r, function (t) { n.dom().setAttribute(t.name, t.value) }); var o = Sn(e); return Mn(n, o), Oa(e), n }, fs = function (t) { return En(t).bind(function (t) { return se(t) && 0 === us(t).trim().length ? fs(t) : "li" === oe(t) ? D.some(t) : D.none() }) }, ls = { changeTag: ss, addBrTag: function (t) { 0 === Iu(t).length && _n(t, Se.fromTag("br")) }, properlyNest: function (n) { xn(n).each(function (t) { var e = oe(t); P(["ol", "ul"], e) && fs(n).fold(function () { var t = Se.fromTag("li"); Ma(t, "list-style-type", "none"), Pn(n, t) }, function (t) { _n(t, n) }) }) }, fontToSpan: function (t) { var o = ss("span", t), i = { "font-size": { 1: "8pt", 2: "10pt", 3: "12pt", 4: "14pt", 5: "18pt", 6: "24pt", 7: "36pt" } }; et({ face: "font-family", size: "font-size", color: "color" }, function (t, e) { if (pe(o, e)) { var n = me(o, e), r = void 0 !== i[t] && void 0 !== i[t][n] ? i[t][n] : n; Ma(o, t, r), ge(o, e) } }) } }, ds = function (t, e, n, r) { var o = bn(t).dom().createRange(); return o.setStart(t.dom(), e), o.setEnd(n.dom(), r), o }, ms = Jc(ue, "comment"), ps = function (t) { return ms.get(t) }, gs = Cu({ tags: [{ name: Ga.pattern(/^([OVWXP]|U[0-9]+|ST[0-9]+):/i, Ga.caseInsensitive) }] }), vs = Lu({ attributes: [{ name: Ga.exact("id", Ga.caseInsensitive), value: Ga.starts("docs-internal-guid", Ga.caseInsensitive) }] }), hs = [Du([Gc.filter])], ys = Lu({ attributes: [{ name: Ga.pattern(/^v:/, Ga.caseInsensitive) }, { name: Ga.exact("href", Ga.caseInsensitive), value: Ga.contains("#_toc", Ga.caseInsensitive) }, { name: Ga.exact("href", Ga.caseInsensitive), value: Ga.contains("#_mso", Ga.caseInsensitive) }, { name: Ga.pattern(/^xmlns(:|$)/, Ga.caseInsensitive) }, { name: Ga.exact("type", Ga.caseInsensitive), condition: Zc.isList }] }), bs = Lu({ tags: [{ name: Ga.exact("script", Ga.caseInsensitive) }, { name: Ga.exact("link", Ga.caseInsensitive) }, { name: Ga.exact("style", Ga.caseInsensitive), condition: Zc.isEmpty }], attributes: [{ name: Ga.starts("on", Ga.caseInsensitive) }, { name: Ga.exact('"', Ga.caseInsensitive) }, { name: Ga.exact("lang", Ga.caseInsensitive) }, { name: Ga.exact("language", Ga.caseInsensitive) }], styles: [{ name: Ga.all(), value: Ga.pattern(/OLE_LINK/i, Ga.caseInsensitive) }] }), xs = Lu({ tags: [{ name: Ga.exact("meta", Ga.caseInsensitive) }] }), Ts = Lu({ tags: [{ name: Ga.exact("style", Ga.caseInsensitive) }] }), Es = Lu({ styles: [{ name: Ga.not(Ga.pattern(/width|height|list-style-type/, Ga.caseInsensitive)), condition: function (t) { return !we(t, "ephox-limbo-transform") } }, { name: Ga.pattern(/width|height/, Ga.caseInsensitive), condition: Zc.isNotImage }] }), ws = Lu({ classes: [{ name: Ga.not(Ga.exact("rtf-data-image", Ga.caseInsensitive)) }] }), Is = Lu({ styles: [{ name: Ga.pattern(qa(), Ga.caseInsensitive) }] }), Ss = Lu({ classes: [{ name: Ga.pattern(/mso/i, Ga.caseInsensitive) }] }), Ls = Cu({ tags: [{ name: Ga.exact("img", Ga.caseInsensitive), condition: Zc.isLocal }, { name: Ga.exact("a", Ga.caseInsensitive), condition: Zc.hasNoAttributes }] }), Cs = Cu({ tags: [{ name: Ga.exact("a", Ga.caseInsensitive), condition: Zc.hasNoAttributes }] }), Ns = Lu({ attributes: [{ name: Ga.exact("style", Ga.caseInsensitive), value: Ga.exact("", Ga.caseInsensitive), debug: !0 }] }), Ds = Lu({ attributes: [{ name: Ga.exact("class", Ga.caseInsensitive), value: Ga.exact("", Ga.caseInsensitive), debug: !0 }] }), Os = Cu({ tags: [{ name: Ga.pattern($a(), Ga.caseInsensitive), condition: (Qc = Zc.hasContent, function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; return !Qc.apply(null, t) }) }] }), As = Cu({ tags: [{ name: Ga.exact("p", Ga.caseInsensitive), condition: (ts = "li", function (t) { return xn(t).exists(function (t) { return oe(t) === ts && 1 === Sn(t).length }) }) }] }), _s = Nu({ tags: [{ name: Ga.exact("p", Ga.caseInsensitive), mutate: ls.addBrTag }] }), Ps = Nu({ tags: [{ name: Ga.pattern(/ol|ul/, Ga.caseInsensitive), mutate: ls.properlyNest }] }), ks = Nu({ tags: [{ name: Ga.exact("b", Ga.caseInsensitive), mutate: N(ls.changeTag, "strong") }, { name: Ga.exact("i", Ga.caseInsensitive), mutate: N(ls.changeTag, "em") }, { name: Ga.exact("u", Ga.caseInsensitive), mutate: function (t) { var e = ls.changeTag("span", t); Te(e, "ephox-limbo-transform"), Ma(e, "text-decoration", "underline") } }, { name: Ga.exact("s", Ga.caseInsensitive), mutate: N(ls.changeTag, "strike") }, { name: Ga.exact("font", Ga.caseInsensitive), mutate: ls.fontToSpan, debug: !0 }] }), Ms = Lu({ classes: [{ name: Ga.exact("ephox-limbo-transform", Ga.caseInsensitive) }] }), Rs = Lu({ tags: [{ name: Ga.exact("br", Ga.caseInsensitive), condition: or("Apple-interchange-newline") }] }), Fs = { unwrapWordTags: gs, removeWordAttributes: ys, removeGoogleDocsId: vs, parseLists: hs, removeExcess: bs, removeMetaTags: xs, removeStyleTags: Ts, cleanStyles: Es, cleanClasses: ws, cleanupBrowserCruft: Lu({ styles: [{ name: Ga.pattern(/^-/, Ga.caseInsensitive) }, { name: Ga.all(), value: Ga.exact("initial", Ga.caseInsensitive) }, { name: Ga.exact("background-color", Ga.caseInsensitive), value: Ga.exact("transparent", Ga.caseInsensitive) }, { name: Ga.exact("font-style", Ga.caseInsensitive), value: Ga.exact("normal", Ga.caseInsensitive) }, { name: Ga.pattern(/font-variant.*/, Ga.caseInsensitive) }, { name: Ga.exact("letter-spacing", Ga.caseInsensitive) }, { name: Ga.exact("font-weight", Ga.caseInsensitive), value: Ga.pattern(/400|normal/, Ga.caseInsensitive) }, { name: Ga.exact("orphans", Ga.caseInsensitive) }, { name: Ga.exact("text-decoration", Ga.caseInsensitive), value: Ga.exact("none", Ga.caseInsensitive) }, { name: Ga.exact("text-size-adjust", Ga.caseInsensitive) }, { name: Ga.exact("text-indent", Ga.caseInsensitive), value: Ga.exact("0px", Ga.caseInsensitive) }, { name: Ga.exact("text-transform", Ga.caseInsensitive), value: Ga.exact("none", Ga.caseInsensitive) }, { name: Ga.exact("white-space", Ga.caseInsensitive), value: Ga.exact("normal", Ga.caseInsensitive) }, { name: Ga.exact("widows", Ga.caseInsensitive) }, { name: Ga.exact("word-spacing", Ga.caseInsensitive), value: Ga.exact("0px", Ga.caseInsensitive) }, { name: Ga.exact("text-align", Ga.caseInsensitive), value: Ga.pattern(/start|end/, Ga.caseInsensitive) }, { name: Ga.exact("font-weight", Ga.caseInsensitive), value: Ga.pattern(/700|bold/, Ga.caseInsensitive), condition: function (t) { return /^h\d$/.test(oe(t)) } }] }), cleanupBrowserTags: Rs, unwrapConvertedSpace: (ns = (es = function (t, n) { return function (e) { return t(e).filter(function (t) { return se(e) && n(Fc(t), " ") }).isSome() } })(En, en), rs = es(wn, tn), Nu({ tags: [{ name: Ga.exact("span", Ga.caseInsensitive), condition: or("Apple-converted-space"), mutate: function (t) { "\xa0" === Fc(t) && (ns(t) || rs(t) ? Aa(t) : (Dn(t, Se.fromText(" ")), Oa(t))) } }] })), mergeStyles: Is, mergeClasses: Ss, removeLocalImages: Ls, removeVacantLinks: Cs, removeEmptyStyle: Ns, removeEmptyClass: Ds, pruneInlineTags: Os, unwrapSingleParagraphsInlists: As, addPlaceholders: _s, nestedListFixes: Ps, inlineTagFixes: ks, cleanupFlags: Ms, distillAnchorsFromLocalLinks: (os = /^file:\/\/\/[^#]+(#[^#]+)$/, Nu({ tags: [{ name: Ga.exact("a", Ga.caseInsensitive), condition: function (t) { var e = me(t, "href"); return !!e && os.test(e) }, mutate: function (t) { var e = me(t, "href"); le(t, "href", e.replace(os, "$1")) } }] })), removeLocalLinks: Lu({ attributes: [{ name: Ga.exact("href", Ga.caseInsensitive), value: Ga.starts("file:///", Ga.caseInsensitive), debug: !0 }] }), replaceClipboardChangedUrls: Nu({ tags: [(is = function (t, n, r) { return { name: Ga.exact(t, Ga.caseInsensitive), condition: function (t) { return pe(t, n) }, mutate: function (t) { var e = me(t, n); le(t, r, e), ge(t, n) } } })("a", "data-ephox-href", "href"), is("img", "data-ephox-src", "src")] }), removeFragmentComments: function (a) { var u = ["table", "thead", "tbody", "tfoot", "th", "tr", "td", "ul", "ol", "li"], t = Fn(a, ue), e = U(t, function (t) { return Je(ps(t), "StartFragment") }), n = U(t, function (t) { return Je(ps(t), "EndFragment") }); e.each(function (i) { n.each(function (t) { for (var e, n = i, r = [], o = (e = ds(i, 0, t, 0), Se.fromDom(e.commonAncestorContainer)); void 0 !== o && !hn(o, a);)P(u, oe(o)) ? n = o : r.push(o), o = xn(o).getOr(void 0); R(r, Aa), R(In(n), Oa) }), Oa(i) }), n.each(Oa) }, none: C }, js = function (t) { return t.browser.isIE() && 11 <= t.browser.version.major }, Us = function (i, a) { return _u(function (t, e) { var r, o, n = (r = e, o = a, i(Se.fromDom(r.getNode())).fold(function () { return [r] }, function (t) { var e = r.type() === bu.END_ELEMENT_TYPE, n = [bu.token(t.dom(), e)]; return !e && o && n.push(bu.token(t.dom(), !0)), n })); R(n, t.emit) }, C) }, Bs = function (t, e, n) { var r, o, i, a, u, c, s, f, l, d, m, p, g, v = (r = t, i = (o = n).browser.isFirefox() || o.browser.isEdge(), a = i ? Wa.local : Wa.vshape, u = !i, c = js(o) ? Fs.none : Du([Us(a, u)]), { annotate: [r ? c : Fs.none], local: [i ? Fs.none : Fs.removeLocalImages] }); return W([(p = t, g = n, js(g) || !p ? [] : [Gc.preprocess]), v.annotate, [Fs.inlineTagFixes], function (t, e, n) { if (!t) return [Fs.none]; var r = [Fs.unwrapWordTags], o = js(n) ? [] : Fs.parseLists; return r.concat(o).concat([Fs.removeWordAttributes]) }(t, 0, n), [Fs.removeGoogleDocsId], [Fs.nestedListFixes], [Fs.removeExcess], [Fs.removeMetaTags], v.local, (m = e, m ? [Fs.mergeStyles, Fs.mergeClasses] : [Fs.cleanStyles, Fs.cleanClasses]), [Fs.distillAnchorsFromLocalLinks, Fs.removeLocalLinks, Fs.removeVacantLinks, Fs.replaceClipboardChangedUrls], [Fs.removeEmptyStyle], [Fs.removeEmptyClass], [Fs.pruneInlineTags], [Fs.cleanupBrowserTags], (l = t, d = e, !l && d ? [Fs.cleanupBrowserCruft] : []), [Fs.unwrapConvertedSpace], [Fs.addPlaceholders], (s = t, f = n, js(f) && s ? [Fs.unwrapSingleParagraphsInlists] : []), [Fs.cleanupFlags], [Fs.removeStyleTags]]) }, Ys = ["body", "p", "div", "article", "aside", "figcaption", "figure", "footer", "header", "nav", "section", "ol", "ul", "li", "table", "thead", "tbody", "tfoot", "caption", "tr", "td", "th", "h1", "h2", "h3", "h4", "h5", "h6", "blockquote", "pre", "address"]; Le("word", "pattern"); var Hs = { point: Le("element", "offset"), delta: Le("element", "deltaOffset"), range: Le("element", "start", "finish"), points: Le("begin", "end"), text: Le("element", "text") }, Ws = v(!1), qs = v(!0), $s = function (t) { return { isBoundary: function () { return t(qs, Ws, Ws) }, fold: t, toText: function () { return t(D.none, D.none, function (t, e) { return D.some(t) }) }, is: function (n) { return t(Ws, Ws, function (t, e) { return e.eq(t, n) }) }, len: function () { return t(v(0), v(1), function (t, e) { return e.property().getText(t).length }) } } }, Vs = function (r, o) { return $s(function (t, e, n) { return n(r, o) }) }, Xs = function (r, o) { return $s(function (t, e, n) { return t(r, o) }) }, Gs = function (r, o) { return $s(function (t, e, n) { return e(r, o) }) }, zs = function (t, e, n, r) { return t.fold(e, n, r) }, Ks = function (t, e) { var n = B(t, e).getOr(-1); return t.slice(0, n) }, Zs = at([{ include: ["item"] }, { excludeWith: ["item"] }, { excludeWithout: ["item"] }]), Js = { include: Zs.include, excludeWith: Zs.excludeWith, excludeWithout: Zs.excludeWithout, cata: function (t, e, n, r) { return t.fold(e, n, r) } }, Qs = function (t, n) { var r = [], o = []; return R(t, function (t) { var e = n(t); Js.cata(e, function () { o.push(t) }, function () { 0 < o.length && r.push(o), r.push([t]), o = [] }, function () { 0 < o.length && r.push(o), o = [] }) }), 0 < o.length && r.push(o), r }, tf = { splitby: function (t, e) { return Qs(t, function (t) { return e(t) ? Js.excludeWithout(t) : Js.include(t) }) }, splitbyAdv: Qs }, ef = function (t, e) { return tf.splitbyAdv(t, e) }, nf = function (t, e) { return Ks(t, e) }, rf = function (t) { return e = function (t, e) { return e.len() + t }, n = 0, function (t, e) { for (var n = t.length - 1; 0 <= n; n--)e(t[n], n, t) }(t, function (t) { n = e(n, t) }), n; var e, n }, of = function (t, e) { return nf(t, function (t) { return t.is(e) }) }, af = function (t) { return q(t, function (t) { return t.fold(v([]), v([]), function (t) { return [t] }) }) }, uf = function (e, t, n) { if (e.property().isText(t)) return [Vs(t, e)]; if (e.property().isEmptyTag(t)) return [Gs(t, e)]; if (e.property().isElement(t)) { var r = e.property().children(t), o = e.property().isBoundary(t) ? [Xs(t, e)] : [], i = void 0 !== n && n(t) ? [] : q(r, function (t) { return uf(e, t, n) }); return o.concat(i).concat(o) } return [] }, cf = function (t, e, n, r, o) { var i = uf(t, r, o), a = of(i, e), u = rf(a); return Hs.point(r, u + n) }, sf = { typed: uf, items: function (t, e, n) { var r = uf(t, e, n), o = function (t, e) { return t }; return M(r, function (t) { return t.fold(o, o, o) }) }, extractTo: function (e, n, r, t, o) { return e.up().predicate(n, t).fold(function () { return Hs.point(n, r) }, function (t) { return cf(e, n, r, t, o) }) }, extract: function (e, n, r, o) { return e.property().parent(n).fold(function () { return Hs.point(n, r) }, function (t) { return cf(e, n, r, t, o) }) } }, ff = function (t, n, e) { return j(t, function (e, t) { return n(t, e.len).fold(v(e), function (t) { return { len: t.finish(), list: e.list.concat([t]) } }) }, { len: void 0 !== e ? e : 0, list: [] }).list }, lf = function (t, e) { return e >= t.start() && e <= t.finish() }, df = function (t, e) { return B(t, function (t) { return t.start() === e }) }, mf = lf, pf = function (o, t, i) { var e = df(o, t), a = df(o, i); return e.bind(function (t) { var e, n, r = a.getOr((n = i, (e = o)[e.length - 1] && e[e.length - 1].finish() === n ? e.length + 1 : -1)); return -1 < r ? D.some(o.slice(t, r)) : D.none() }).getOr([]) }, gf = function (t, e) { return M(t, function (t) { return ft(t, { start: v(t.start() + e), finish: v(t.finish() + e) }) }) }, vf = function (t, o, i) { return 0 === o.length ? t : q(t, function (e) { var t, n, r = q(o, function (t) { return mf(e, t) ? [t - e.start()] : [] }); return 0 < r.length ? (n = i(t = e, r), gf(n, t.start())) : [e] }) }, hf = function (t, e, n) { return ff(t, e, n) }, yf = function (t, e, n) { return vf(t, e, n) }, bf = function (t, e, n) { return pf(t, e, n) }, xf = function (t, e, n) { return sf.typed(t, e, n) }, Tf = function (e, t, n) { var r = q(t, function (t) { return xf(e, t, n) }), o = ef(r, function (t) { return zs(t, function () { return Js.excludeWithout(t) }, function () { return Js.excludeWith(t) }, function () { return Js.include(t) }) }); return F(o, function (t) { return 0 < t.length }) }, Ef = function (t, e, n) { return Tf(t, e, n) }, wf = function (r, t) { if (0 === t.length) return [r]; var e = j(t, function (t, e) { if (0 === e) return t; var n = r.substring(t.prev, e); return { prev: e, values: t.values.concat([n]) } }, { prev: 0, values: [] }), n = t[t.length - 1]; return n < r.length ? e.values.concat(r.substring(n)) : e.values }, If = function (t, e) { return wf(t, e) }, Sf = function (o, t, e) { var n = o.property().getText(t), r = F(If(n, e), function (t) { return 0 < t.length }); if (r.length <= 1) return [Hs.range(t, 0, n.length)]; o.property().setText(t, r[0]); var i = hf(r.slice(1), function (t, e) { var n = o.create().text(t), r = Hs.range(n, e, e + t.length); return D.some(r) }, r[0].length), a = M(i, function (t) { return t.element() }); return o.insert().afterAll(t, a), [Hs.range(t, 0, r[0].length)].concat(i) }, Lf = function (o, t, e) { var n = q(e, function (t) { return [t.start(), t.finish()] }), i = yf(t, n, function (t, e) { return Sf(o, t.element(), e) }); return M(e, function (t) { var e = bf(i, t.start(), t.finish()), n = M(e, function (t) { return t.element() }), r = M(n, o.property().getText).join(""); return { elements: v(n), word: t.word, exact: v(r) } }) }, Cf = "\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF\ufeff\\u2018\\u2019"; function Nf(t, e, n, r) { return { term: function () { return new RegExp(t, r.getOr("g")) }, prefix: e, suffix: n } } v(Cf), v("[^\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF\ufeff\\u2018\\u2019]"), v("[\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF\ufeff\\u2018\\u2019]"); var Df = function (t) { return Nf(t, v(0), v(0), D.none()) }, Of = function (t) { return Df(t) }, Af = function (t, e) { for (var n = e.term(), r = [], o = n.exec(t); o;) { var i = o.index + e.prefix(o), a = o[0].length - e.prefix(o) - e.suffix(o); r.push({ start: v(i), finish: v(i + a) }), n.lastIndex = i + a, o = n.exec(t) } return r }, _f = function (n, t) { var e, r, o = q(t, function (e) { var t = Af(n, e.pattern()); return M(t, function (t) { return ft(e, { start: t.start, finish: t.finish }) }) }); return e = o, (r = Array.prototype.slice.call(e, 0)).sort(function (t, e) { return t.start() < e.start() ? -1 : e.start() < t.start() ? 1 : 0 }), r }, Pf = function (t, e) { return _f(t, e) }, kf = function (a, t, u, e) { var n = Ef(a, t, e); return q(n, function (t) { var r, e = af(t), n = M(e, a.property().getText).join(""), o = Pf(n, u), i = (r = a, hf(e, function (t, e) { var n = e + r.property().getText(t).length; return D.from(Hs.range(t, e, n)) })); return Lf(a, i, o) }) }, Mf = kf, Rf = function (t, e, n, r) { return Mf(t, e, n, r) }, Ff = { up: v({ selector: sr, closest: lr, predicate: ir, all: Tn }), down: v({ selector: jn, predicate: Fn }), styles: v({ get: Fa, getRaw: Ua, set: Ma, remove: Ba }), attrs: v({ get: me, set: le, remove: ge, copyTo: function (t, e) { var n = j(t.dom().attributes, function (t, e) { return t[e.name] = e.value, t }, {}); de(e, n) } }), insert: v({ before: Dn, after: On, afterAll: kn, append: _n, appendAll: Mn, prepend: An, wrap: Pn }), remove: v({ unwrap: Aa, remove: Oa }), create: v({ nu: Se.fromTag, clone: function (t) { return Se.fromDom(t.dom().cloneNode(!1)) }, text: Se.fromText }), query: v({ comparePosition: function (t, e) { return t.dom().compareDocumentPosition(e.dom()) }, prevSibling: En, nextSibling: wn }), property: v({ children: Sn, name: oe, parent: xn, isText: se, isComment: ue, isElement: ce, getText: us, setText: cs, isBoundary: function (t) { return !!ce(t) && ("body" === oe(t) || P(Ys, oe(t))) }, isEmptyTag: function (t) { return !!ce(t) && P(["br", "img", "hr", "input"], oe(t)) } }), eq: hn, is: yn }, jf = function (t, e, n) { return Rf(Ff, t, e, n) }, Uf = function (t) { return cr(t).isSome() }, Bf = /(?:(?:[A-Za-z]{3,9}:(?:\/\/))(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*|(?:www\.|[-;:&=+$,.\w]+@)[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*)(?::[0-9]+)?(?:\/[-+~=%.()\/\w]*)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g.source, Yf = function (t) { return !lr(t, "a", e).isSome(); var e }, Hf = function (t) { var e = t.indexOf("://"); return 3 <= e && e <= 9 }, Wf = { links: function (t) { var e, n, r = (e = t, n = Le("word", "pattern")("__INTERNAL__", Of(Bf)), jf(e, [n])); R(r, function (t) { var n, e = t.exact(); (e.indexOf("@") < 0 || Hf(e)) && (n = t.elements(), D.from(n[0]).filter(Yf).map(function (t) { var e = Se.fromTag("a"); return Dn(t, e), Mn(e, n), le(e, "href", Fc(e)), e })) }) }, position: function (t) { R(t, function (t) { ce(t) && Ua(t, "position").isSome() && Ba(t, "position") }) }, list: function (t) { var e = F(t, function (t) { return "li" === oe(t) }); if (0 < e.length) { var n = In(e[0]), r = Se.fromTag("ul"); if (Dn(t[0], r), 0 < n.length) { var o = Se.fromTag("li"); _n(r, o), Mn(o, n) } Mn(r, e) } } }, qf = function (t) { var e = Sn(t); R([Wf.links, Wf.position, Wf.list], function (t) { t(e) }) }, $f = function (t, e, n, r, o) { qf(n); var i = Iu(n), a = Bs(o, r, e); return Au(t, i, a) }, Vf = qf, Xf = function (t, e) { var n = Iu(e); return Au(t, n, [Fs.removeMetaTags, Fs.replaceClipboardChangedUrls]) }, Gf = function (t, e) { var n = Iu(e); return Au(t, n, [Fs.removeFragmentComments]) }, zf = ia("simple-adt"), Kf = function (t) { var i = function (t) { return zf + "_" + t }, o = function (t, e) { return t._simpleAdt === i(e) }, a = tt(t), n = {}; R(a, function (e) { n["as" + Qe(e)] = function (t) { return o(t, e) ? D.some(t.data) : D.none() } }); var e = {}; return et(t, function (r, o) { e[o] = function (t) { return { _simpleAdt: i(o), data: (e = r, n = t, 0 === e.length ? {} : De(e, [])(n)), _simpleAdt_data: t }; var e, n } }), st(n, { constructors: e, match: function (e, n) { var t, r = tt(n); if (r.length !== a.length) throw new Error("Partial match"); return La(r, function (t) { return o(e, t) ? D.some(n[t]) : D.none() }).getOrDie("Must find branch for constructor: " + (0 === (t = e._simpleAdt).indexOf(zf) ? t.substring(zf.length + "_".length) : t))(e.data) } }) }, Zf = Kf({ getFromFlash: [], disabled: [], fromClipboard: ["rtf"] }), Jf = { getFromFlash: Zf.constructors.getFromFlash, disabled: Zf.constructors.disabled, fromClipboard: Zf.constructors.fromClipboard, match: Zf.match }, Qf = function (t, e) { var n = new RegExp(e, "i"); return La(t, function (t) { return null !== t.match(n) ? D.some({ type: t, flavor: e }) : D.none() }) }, tl = { isValidData: function (t) { return void 0 !== t && void 0 !== t.types && null !== t.types }, getPreferredFlavor: function (t, e) { return La(t, function (t) { return Qf(e, t) }) }, getFlavor: Qf }, el = Kf({ event: ["nativeEvent"], html: ["container"], word: ["html", "rtf"], text: ["text"], images: ["images"] }), nl = fn.detect().browser, rl = !(nl.isIE() || nl.isEdge() && nl.version.major < 16), ol = ["^image/", "file"], il = function (t) { return Je(t, "<html") && (Je(t, 'xmlns:o="urn:schemas-microsoft-com:office:office"') || Je(t, 'xmlns:x="urn:schemas-microsoft-com:office:excel"')) }, al = function (t) { return Je(t, "<meta") && Je(t, 'id="docs-internal-guid') }, ul = function (t) { return 0 < t.length }, cl = function (e, t) { return tl.getFlavor(e.types, t).map(function (t) { return e.getData(t.type) }).filter(ul) }, sl = function (t) { return cl(t, "html") }, fl = function (t) { return sl(t).filter(al) }, ll = function (t) { return rl ? D.some(t.clipboardData).filter(tl.isValidData) : D.none() }, dl = function (t) { var e = Se.fromTag("div"); Su(e, t); var n = Gf(bn(e), e), r = Se.fromTag("div"); return Su(r, n), el.constructors.html({ container: r }) }, ml = { fromEvent: function (t) { var e = function (e) { return void 0 === e.items ? D.none() : tl.getPreferredFlavor(ol, e.types).map(function (t) { return el.constructors.images({ images: e.items }) }) }, r = function (e) { return La(e.types, function (t) { return "text/plain" === t ? D.some(e.getData(t)).map(function (t) { return el.constructors.text({ text: t }) }) : D.none() }) }; return { getWordData: function () { return ll(t).bind(function (n) { return (t = n, sl(t).filter(il)).map(function (t) { var e = cl(n, "rtf"); return el.constructors.word({ html: t, rtf: e.fold(Jf.getFromFlash, function (t) { return Jf.fromClipboard({ rtf: t }) }) }) }); var t }) }, getGoogleDocsData: function () { return ll(t).bind(fl).map(dl) }, getImage: function () { return ll(t).bind(e) }, getText: function () { return ll(t).fold(function () { var t = y.window.clipboardData; return void 0 !== t ? D.some(el.constructors.text({ text: t.getData("text") })) : D.none() }, r) }, getHtml: function () { return ll(t).bind(sl).map(dl) }, getOnlyText: function () { return ll(t).bind(function (t) { return e = t.types, n = "text/plain", 1 === e.length && e[0] === n ? r(t) : D.none(); var e, n }) }, getNative: function () { return el.constructors.event({ nativeEvent: t }) } } }, fromHtml: function (t) { return { getWordData: function () { return D.some(el.constructors.word({ html: t, rtf: Jf.disabled() })) }, getGoogleDocsData: D.none, getImage: D.none, getHtml: D.none, getText: D.none, getNative: f("There is no native event"), getOnlyText: D.none } }, fromText: function (t) { return { getWordData: D.none, getGoogleDocsData: D.none, getImage: D.none, getHtml: D.none, getText: function () { return D.some(el.constructors.text({ text: t })) }, getNative: f("There is no native event"), getOnlyText: D.none } } }, pl = function () { var t = !1; return { isBlocked: function () { return t }, block: function () { t = !0 }, unblock: function () { t = !1 } } }, gl = function (t, e) { return { control: t, instance: e } }, vl = { tap: function (n) { var r = pl(); return gl(r, function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; r.isBlocked() || n.apply(null, t) }) } }, hl = Gt("ephox-sloth").resolve("bin"), yl = { bin: v(hl) }, bl = fn.detect(), xl = bl.browser.isIE() && bl.browser.version.major <= 10, Tl = xl ? function (t, e, n) { e.control.block(), t.dom().execCommand("paste"), n(), e.control.unblock() } : function (t, e, n) { setTimeout(n, 1) }, El = { willBlock: v(xl), run: function (t, e, n) { return Tl(t, e, n) } }, wl = at([{ before: ["element"] }, { on: ["element", "offset"] }, { after: ["element"] }]), Il = { before: wl.before, on: wl.on, after: wl.after, cata: function (t, e, n, r) { return t.fold(e, n, r) }, getStart: function (t) { return t.fold(l, l, l) } }, Sl = at([{ domRange: ["rng"] }, { relative: ["startSitu", "finishSitu"] }, { exact: ["start", "soffset", "finish", "foffset"] }]), Ll = Le("start", "soffset", "finish", "foffset"), Cl = Sl.relative, Nl = function (t, e, n) { var r, o, i = t.document.createRange(); return r = i, e.fold(function (t) { r.setStartBefore(t.dom()) }, function (t, e) { r.setStart(t.dom(), e) }, function (t) { r.setStartAfter(t.dom()) }), o = i, n.fold(function (t) { o.setEndBefore(t.dom()) }, function (t, e) { o.setEnd(t.dom(), e) }, function (t) { o.setEndAfter(t.dom()) }), i }, Dl = function (t, e, n, r, o) { var i = t.document.createRange(); return i.setStart(e.dom(), n), i.setEnd(r.dom(), o), i }, Ol = at([{ ltr: ["start", "soffset", "finish", "foffset"] }, { rtl: ["start", "soffset", "finish", "foffset"] }]), Al = function (t, e, n) { return e(Se.fromDom(n.startContainer), n.startOffset, Se.fromDom(n.endContainer), n.endOffset) }, _l = function (t, e) { var o, n, r, i = (o = t, e.match({ domRange: function (t) { return { ltr: v(t), rtl: D.none } }, relative: function (t, e) { return { ltr: Ae(function () { return Nl(o, t, e) }), rtl: Ae(function () { return D.some(Nl(o, e, t)) }) } }, exact: function (t, e, n, r) { return { ltr: Ae(function () { return Dl(o, t, e, n, r) }), rtl: Ae(function () { return D.some(Dl(o, n, r, t, e)) }) } } })); return (r = (n = i).ltr()).collapsed ? n.rtl().filter(function (t) { return !1 === t.collapsed }).map(function (t) { return Ol.rtl(Se.fromDom(t.endContainer), t.endOffset, Se.fromDom(t.startContainer), t.startOffset) }).getOrThunk(function () { return Al(0, Ol.ltr, r) }) : Al(0, Ol.ltr, r) }, Pl = (document.caretPositionFromPoint || document.caretRangeFromPoint, function (t, e) { var n = oe(t); return "input" === n ? Il.after(t) : P(["br", "img"], n) ? 0 === e ? Il.before(t) : Il.after(t) : Il.on(t, e) }), kl = function (t, e, n, r, o) { var i, a, u = Dl(t, e, n, r, o); i = t, a = u, D.from(i.getSelection()).each(function (t) { t.removeAllRanges(), t.addRange(a) }) }, Ml = function (t, e, n, r, o) { var i, a, u, c, f, s = (i = r, a = o, u = Pl(e, n), c = Pl(i, a), Cl(u, c)); _l(f = t, s).match({ ltr: function (t, e, n, r) { kl(f, t, e, n, r) }, rtl: function (e, n, r, o) { var t, i, a, u, c, s = f.getSelection(); if (s.setBaseAndExtent) s.setBaseAndExtent(e.dom(), n, r.dom(), o); else if (s.extend) try { i = e, a = n, u = r, c = o, (t = s).collapse(i.dom(), a), t.extend(u.dom(), c) } catch (t) { kl(f, r, o, e, n) } else kl(f, r, o, e, n) } }) }, Rl = function (t) { var e, n, r, o, i, a, u = Se.fromDom(t.anchorNode), c = Se.fromDom(t.focusNode); return e = u, n = t.anchorOffset, r = c, o = t.focusOffset, i = ds(e, n, r, o), a = hn(e, r) && n === o, i.collapsed && !a ? D.some(Ll(Se.fromDom(t.anchorNode), t.anchorOffset, Se.fromDom(t.focusNode), t.focusOffset)) : function (t) { if (0 < t.rangeCount) { var e = t.getRangeAt(0), n = t.getRangeAt(t.rangeCount - 1); return D.some(Ll(Se.fromDom(e.startContainer), e.startOffset, Se.fromDom(n.endContainer), n.endOffset)) } return D.none() }(t) }, Fl = function (t) { return D.from(t.getSelection()).filter(function (t) { return 0 < t.rangeCount }).bind(Rl) }, jl = function (t) { return M(t, function (t) { return t.asset() }) }; function Ul(i, a) { var u = Gn.create({ cancel: Xn([]), error: Xn(["message"]), insert: Xn(["elements", "assets", "correlated", "isInternal"]) }), r = function (t, e, n) { var r = Na.choose(i, a, t); r.capture() && n(); var o = M(r.steps(), function (t) { return t(e) }); Na.run(o, r.input()).get(function (t) { var r = t.bundle().isInternal().getOr(!1); Ta.cata(t.response(), function (t) { u.trigger.error(t) }, function (t, e) { u.trigger.insert(t, jl(e), e, r) }, function () { u.trigger.cancel() }, function (t, e, n) { u.trigger.insert(t, jl(e), e, r), u.trigger.error(n) }) }) }, o = vl.tap(function (n) { Fl(n.target.ownerDocument.defaultView).each(function (t) { if (!we(t.start(), yl.bin())) { var e = ml.fromEvent(n); El.willBlock() && (o.control.block(), n.preventDefault()), r(e, o.control, function () { n.preventDefault() }) } }) }); return { paste: o.instance, pasteCustom: function (t) { var e = vl.tap(C); r(t, e.control, C) }, isBlocked: o.control.isBlocked, destroy: C, events: u.registry } } var Bl = Le("asset", "image"), Yl = function (t, o) { return dt.cata(t, function (t, e, n, r) { return le(o, "src", n), !0 }, d) }, Hl = { assetImage: Bl, createImages: function (t) { var a = [], u = []; return R(t, function (i) { return dt.cata(i, function (t, e, n, r) { var o = Se.fromTag("img"); le(o, "src", n), a.push(o), u.push(Bl(i, o)) }, function (t, e, n) { y.console.error("Internal error: Paste operation produced an image URL instead of a Data URI: ", e) }) }), Ta.paste(a, u) }, findImages: function (t, e) { var i = [], a = q(t, function (t) { return "img" === oe(t) ? [t] : jn(t, "img") }); return R(e, function (o) { dt.cata(o, function (t, e, n, r) { R(a, function (t) { me(t, "src") === n && i.push(Bl(o, t)) }) }, C) }), i }, updateSource: Yl, updateSources: function (t, r) { var o = []; return R(t, function (t, e) { var n = r[e]; Yl(t, n) && o.push(Bl(t, n)) }), o }, browserBlobs: function (t) { return Q(t, function (u) { return K.nu(function (i) { var a = u.dom(); Ft.imageToImageResult(a).then(function (o) { o.toBlob().then(function (t) { var e = tn(a.src, "blob:") ? a.src : y.URL.createObjectURL(t), n = ia("image"), r = dt.blob(n, o, e); i(Bl(r, u)) }) }) }) }) } }, Wl = function (o) { var i = function () { return K.pure(o) }; return dt.cata(o.asset(), function (t, e, n) { return /tiff$/.test(e.getType()) ? (r = e, K.nu(function (e) { var t = Ft.imageResultToBlob(r, "image/png").then(function (t) { pa.single(t).map(D.some).get(e) }); return t.catch.call(t, function (t) { y.console.warn(t), e(D.none()) }) })).map(function (t) { return t.map(function (t) { var e = o.image(); return qn(n), Hl.updateSource(t, e), Hl.assetImage(t, e) }).getOr(o) }) : i(); var r }, i) }; function ql() { return function (t, o) { return Sa.sync(function (n) { var t = function () { Sa.call(n, { response: o.response(), bundle: o.bundle() }) }, r = function (t, e) { Q(t, Wl).get(function (t) { Sa.call(n, { response: e(t), bundle: o.bundle() }) }) }; Ta.cata(o.response(), t, function (e, t) { r(t, function (t) { return Ta.paste(e, t) }) }, t, function (e, t, n) { r(t, function (t) { return Ta.incomplete(e, t, n) }) }) }) } } var $l = function (r) { return function (n) { return function (t, e) { return n.block(), r(t, e).map(function (t) { return n.unblock(), t }) } } }, Vl = function (t) { return v(t) }, Xl = function (n) { var t, e = xt("window.clipboardData.files"), r = void 0 !== (t = n).convertURL ? t.convertURL : void 0 !== t.msConvertURL ? t.msConvertURL : void 0; if (void 0 !== e && void 0 !== r && 0 < e.length) { var o = Q(e, function (t) { var e = Wn(t); return r.apply(n, [t, "specified", e]), pa.singleWithUrl(t, e) }); return D.some(o) } return D.none() }, Gl = function () { var e = D.none(); return { convert: function (t) { e = Xl(t) }, listen: function (t) { return e.fold(function () { return K.nu(function (t) { t([]) }) }, function (t) { return t }).get(t) }, clear: function () { e = D.none() } } }, zl = function (t) { var e = Se.fromTag("div"); return Mn(e, t), jn(e, "img[src]") }, Kl = function (t) { return 0 === t.indexOf("data:") && -1 < t.indexOf("base64") }, Zl = function (t) { return 0 === t.indexOf("blob:") }, Jl = function (t) { var e = me(t, "src"); return Kl(e) || Zl(e) }, Ql = function (t) { return q(zl(t), function (t) { var n, e, r, o, i = me(t, "src"); return Kl(i) ? (r = t, o = i, na(o).map(function (t) { return Hl.assetImage(pa.single(t), r) })).toArray() : Zl(i) ? (n = t, e = i, ra(e).map(function (t) { var e = K.nu(function (e) { t.then(function (t) { pa.single(t).get(e) }) }); return Hl.assetImage(e, n) })).toArray() : [] }) }; function td(l) { return function (t, f) { return Sa.sync(function (u) { var c = function () { Sa.call(u, { response: f.response(), bundle: f.bundle() }) }, s = function (t) { var e, n, r = F(zl(t), Jl); R(r, Oa), Sa.call(u, { response: 0 < r.length ? (e = t, n = F(e, function (t) { return "img" !== oe(t) || !Jl(t) }), Ta.incomplete(n, [], "errors.local.images.disallowed")) : f.response(), bundle: f.bundle() }) }, t = function (t, e, n) { var r, o, i, a; !1 === l.allowLocalImages ? s(t) : 0 === e.length ? (o = Ql(r = t), i = Q(o, function (t) { return t.asset() }), a = M(o, function (t) { return t.image() }), i.get(function (t) { var e = Hl.updateSources(t, a); Sa.call(u, { response: Ta.paste(r, e), bundle: f.bundle() }) })) : c() }; Ta.cata(f.response(), c, t, c, t) }) } } var ed = function (t, e) { if (0 === t.length) throw "Zero length content passed to Hex conversion"; return wt([St(function (t) { for (var e = new Array(t.length / 2), n = 0; n < t.length; n += 2) { var r = t.substr(n, 2); e[Math.floor(n / 2)] = parseInt(r, 16) } return e }(t))], { type: e }) }, nd = at([{ unsupported: ["id", "message", "isEquation"] }, { supported: ["id", "contentType", "blob", "isEquation"] }]), rd = { unsupported: nd.unsupported, supported: nd.supported, cata: function (t, e, n) { return t.fold(e, n) } }, od = function (t, e, n) { return e.indexOf(t, n) }, id = function (t, e, n, r, o, i) { return -1 === t || -1 === e ? D.none() : D.some({ start: t, end: e, bower: n, regex: r, idRef: o, isEquation: i }) }, ad = function (t, e, n) { return t.substring(e, n) }, ud = function (t, e) { if (-1 === e) return e; var n, r, o = 0, i = t.length; do { if ((n = t.indexOf("{", e)) < (r = t.indexOf("}", e)) && -1 !== n ? (e = n + 1, ++o) : (r < n || n < 0) && -1 !== r && (e = r + 1, --o), i < e || -1 === r) return -1 } while (0 < o); return e }, cd = function (t, e, n, r, o) { var i = ad(t, n, r); return id(n, r, i, /[^a-fA-F0-9]([a-fA-F0-9]+)\}$/, "i", o) }, sd = function (t, e, n, r, o) { var i = ad(t, n, r); return id(n, r, i, /([a-fA-F0-9]{64,})(?:\}.*)/, "s", o) }, fd = function (t, e) { var n = od("{\\pict{", t, e), r = ud(t, n), o = od("{\\shp{", t, e), i = ud(t, o), a = od("{\\mmathPict{", t, e), u = ud(t, a), c = -1 !== a && (a < n && r < u || a < o && i < u), s = N(sd, t, e, o, i, c), f = N(cd, t, e, n, r, c); return -1 === n && -1 === o ? D.none() : -1 === n ? s() : -1 === o ? f() : o < n && r < i ? f() : n < o && i < r ? s() : n < o ? f() : o < n ? s() : D.none() }, ld = function (t, e) { return fd(t, e) }, dd = function (t) { return 0 <= t.indexOf("\\pngblip") ? er.value("image/png") : 0 <= t.indexOf("\\jpegblip") ? er.value("image/jpeg") : er.error("errors.imageimport.unsupported") }, md = function (t, e) { var n = t.match(e); return n && n[1] && n[1].length % 2 == 0 ? er.value(n[1]) : er.error("errors.imageimport.invalid") }, pd = function (t) { var e = t.match(/\\shplid(\d+)/); return null !== e ? D.some(e[1]) : D.none() }, gd = function (t) { for (var a = [], e = function () { return t.length }, n = function (t) { var e, r, o, i, n = (r = (e = t).bower, o = e.regex, i = e.isEquation, pd(r).map(function (t) { var n = e.idRef + t; return dd(r).fold(function (t) { return rd.unsupported(n, t, i) }, function (e) { return md(r, o).fold(function (t) { return rd.unsupported(n, t, i) }, function (t) { return rd.supported(n, e, ed(t, e), i) }) }) })); return a = a.concat(n.toArray()), t.end }, r = 0; r < t.length;)r = ld(t, r).fold(e, n); return a }, vd = function (t) { var e = t.replace(/\r/g, "").replace(/\n/g, ""); return gd(e) }, hd = { images: function (t) { return vd(t) }, toId: function (t) { return rd.cata(t, function (t, e, n) { return t }, function (t, e, n, r) { return t }) }, isEquation: function (t) { return rd.cata(t, function (t, e, n) { return n }, function (t, e, n, r) { return r }) }, toBlob: function (t) { return rd.cata(t, function (t, e, n) { return er.error(e) }, function (t, e, n, r) { return er.value(n) }) } }, yd = { convert: function (t, e, n, o) { var i = j(e, function (e, n) { var r = hd.toId(n), o = hd.isEquation(n); return B(e, function (t) { return hd.toId(t) === r && hd.isEquation(t) === o }).fold(function () { return e.concat([n]) }, function (t) { return hd.toBlob(e[t]).isValue() ? e : e.slice(0, t).concat(e.slice(t + 1)).concat([n]) }) }, []), a = [], u = !1, r = q(t, function (e, t) { var n = me(e, "data-image-id"), r = "true" === me(e, "data-ms-equation"); return ge(e, "rtf-data-image"), ge(e, "data-image-id"), ge(e, "data-ms-equation"), "unsupported" === n ? (u = !0, le(e, "alt", o("errors.imageimport.unsupported")), []) : U(i, function (t) { return hd.toId(t) === n && hd.isEquation(t) === r }).fold(function () { return y.console.log("WARNING: unable to find data for image ", e.dom()), [] }, function (t) { return hd.toBlob(t).fold(function (t) { return u = !0, le(e, "alt", o(t)), [] }, function (t) { return a.push(e), [t] }) }) }); pa.multiple(r).get(function (t) { var e = Hl.updateSources(t, a); n(e, u) }) } }, bd = function (t) { return jn(t, "[rtf-data-image]") }, xd = { exists: function (t) { return 0 < bd(t).length }, find: bd }; function Td(t) { var r = t.translations, u = Gn.create({ insert: Xn(["elements", "correlated"]), incomplete: Xn(["elements", "correlated", "message"]) }); return { events: u.registry, processRtf: function (o, i, t, a) { var e = hd.images(t), n = xd.find(o); yd.convert(n, e, function (t, e) { var n = Sn(o), r = t.concat(i); e ? u.trigger.incomplete(n, r, "errors.imageimport.failed") : u.trigger.insert(n, r), a() }, r) } } } function Ed(t, e) { var i, a, u, c, s = (i = t, a = e, u = Gn.create({ insert: Xn(["elements", "correlated"]), incomplete: Xn(["elements", "correlated", "message"]) }), (c = Td(a)).events.incomplete.bind(function (t) { u.trigger.incomplete(t.elements(), t.correlated(), t.message()) }), c.events.insert.bind(function (t) { u.trigger.insert(t.elements(), t.correlated()) }), { events: u.registry, gordon: function (n, r) { var e = function (t) { var e = xd.find(n); R(e, Oa), u.trigger.incomplete(Sn(n), r, t) }, t = function (t) { e(t.message()) }; if (!0 === a.allowLocalImages && !0 === a.enableFlashImport) { var o = i(a); o.events.response.bind(function (t) { c.processRtf(n, r, t.rtf(), t.hide()) }), o.events.cancel.bind(function () { var t = xd.find(n); R(t, Oa), u.trigger.insert(Sn(n), r) }), o.events.failed.bind(t), o.events.error.bind(t), o.open() } else e("errors.local.images.disallowed") } }), f = Ic(D.none()), n = function (e) { f.get().each(function (t) { Sa.call(t, { response: e, bundle: ya.nu({}) }) }) }; return s.events.insert.bind(function (t) { n(Ta.paste(t.elements(), t.correlated())) }), s.events.incomplete.bind(function (t) { n(Ta.incomplete(t.elements(), t.correlated(), t.message())) }), function (t, e) { return Sa.sync(function (o) { var i = function () { Sa.call(o, { response: e.response(), bundle: e.bundle() }) }, t = function (t, e, n) { f.set(D.some(o)); var r = Se.fromTag("div"); Mn(r, t), xd.exists(r) ? s.gordon(r, e, n) : i() }; Ta.cata(e.response(), i, t, i, t) }) } } var wd = function (t) { return t.officeStyles().getOr(!0) }, Id = function (t) { return t.htmlStyles().getOr(!1) }, Sd = function (t) { return t.isWord().getOr(!1) }, Ld = { proxyBin: function (n) { return { handle: function (t, e) { return n.proxyBin().fold(function () { return y.console.error(t), Sa.pure({ response: Ta.cancel(), bundle: ya.nu({}) }) }, e) } } }, backgroundAssets: function (t) { return K.nu(function (e) { t.backgroundAssets().fold(function () { e([]) }, function (t) { t.listen(e) }) }) }, merging: function (t) { var e = Sd(t); return e && wd(t) || !e && Id(t) }, mergeOffice: wd, mergeNormal: Id, isWord: Sd, isGoogleDocs: function (t) { return t.isGoogleDocs().getOr(!1) }, isInternal: function (t) { return t.isInternal().getOr(!1) } }, Cd = { resolve: Gt("ephox-cement").resolve }; function Nd(s, r) { var f = r.translations, l = function (t, e, n) { n(D.some(ft(e, { officeStyles: t, htmlStyles: t }))) }; return { get: function (t, e) { var n = r[t ? "officeStyles" : "htmlStyles"]; "clean" === n ? l(!1, r, e) : "merge" === n ? l(!0, r, e) : function (t, e) { var n = Se.fromTag("div"); Te(n, Cd.resolve("styles-dialog-content")); var r = Se.fromTag("p"), o = Nn(f("cement.dialog.paste.instructions")); Mn(r, o), _n(n, r); var i = { text: f("cement.dialog.paste.clean"), tabindex: 0, className: Cd.resolve("clean-styles"), click: function () { u(), l(!1, t, e) } }, a = { text: f("cement.dialog.paste.merge"), tabindex: 1, className: Cd.resolve("merge-styles"), click: function () { u(), l(!0, t, e) } }, u = function () { c.destroy() }, c = s(!0); c.setTitle(f("cement.dialog.paste.title")), c.setContent(n), c.setButtons([i, a]), c.events.close.bind(function () { e(D.none()), u() }), c.show() }(r, e) }, destroy: C } } var Dd, Od, Ad, _d = function (t, e) { var i = Nd(t, e); return function (t, r) { var e = r.bundle(), o = r.response(); return Sa.sync(function (n) { i.get(Ld.isWord(e), function (t) { var e = t.fold(function () { return { response: Ta.cancel(), bundle: r.bundle() } }, function (t) { return { response: o, bundle: ya.nu({ officeStyles: t.officeStyles, htmlStyles: t.htmlStyles }) } }); Sa.call(n, e) }) }) } }, Pd = _d, kd = function (r, o) { return function (t, e) { var n = function (t) { return Sa.pure({ response: e.response(), bundle: ya.nu({ officeStyles: t, htmlStyles: t }) }) }; return Ld.isInternal(e.bundle()) ? n(!0) : Ld.isGoogleDocs(e.bundle()) ? n(!1) : _d(r, o)(t, e) } }, Md = function (m, p) { return function (t) { if (m(t)) { var e, n, r, o, i, a, u, c = Se.fromDom(t.target), s = function () { t.stopPropagation() }, f = function () { t.preventDefault() }, l = g(f, s), d = (e = c, n = t.clientX, r = t.clientY, o = s, i = f, a = l, u = t, { target: v(e), x: v(n), y: v(r), stop: o, prevent: i, kill: a, raw: v(u) }); p(d) } } }, Rd = function (t, e, n, r) { return o = t, i = e, a = !1, u = Md(n, r), o.dom().addEventListener(i, u, a), { unbind: N(Fd, o, i, u, a) }; var o, i, a, u }, Fd = function (t, e, n, r) { t.dom().removeEventListener(e, n, r) }, jd = v(!0), Ud = function (t, e, n) { return Rd(t, e, jd, n) }, Bd = function (t) { return function (t) { var e = t.dom(); try { var n = e.contentWindow ? e.contentWindow.document : e.contentDocument; return null != n ? D.some(Se.fromDom(n)) : D.none() } catch (t) { return y.console.log("Error reading iframe: ", e), y.console.log("Error was: " + t), D.none() } }(t).fold(function () { return t }, function (t) { return t }) }, Yd = function (t, e) { if (!Rn(t)) throw "Internal error: attempted to write to an iframe that is not in the DOM"; var n = Bd(t).dom(); n.open("text/html", "replace"), n.writeln(e), n.close() }, Hd = function (t) { var e = t.dom().styleSheets; return Array.prototype.slice.call(e) }, Wd = Le("selector", "style", "raw"), qd = function (t) { var e = t.cssRules; return q(e, function (t) { return t.type === y.CSSRule.IMPORT_RULE ? qd(t.styleSheet) : t.type === y.CSSRule.STYLE_RULE ? [function (t) { var e = t.selectorText, n = t.style.cssText; if (void 0 === n) throw "WARNING: Browser does not support cssText property"; return Wd(e, n, t.style) }(t)] : [] }) }, $d = function (t) { return q(t, qd) }, Vd = {}, Xd = { exports: Vd }; Od = Vd, Ad = Xd, Dd = void 0, function (t) { "object" == typeof Od && void 0 !== Ad ? Ad.exports = t() : "function" == typeof Dd && Dd.amd ? Dd([], t) : ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).EphoxContactWrapper = t() }(function () { return function i(a, u, c) { function s(e, t) { if (!u[e]) { if (!a[e]) { var n = !1; if (!t && n) return n(e, !0); if (f) return f(e, !0); var r = new Error("Cannot find module '" + e + "'"); throw r.code = "MODULE_NOT_FOUND", r } var o = u[e] = { exports: {} }; a[e][0].call(o.exports, function (t) { return s(a[e][1][t] || t) }, o, o.exports, i, a, u, c) } return u[e].exports } for (var f = !1, t = 0; t < c.length; t++)s(c[t]); return s }({ 1: [function (t, e, n) { var r, a, o = (r = function (t) { var e, n, r, o, i = []; for (r = 0, o = (e = t.split(",")).length; r < o; r += 1)0 < (n = e[r]).length && i.push(a(n)); return i }, a = function (c) { var t, e, n, s = c, f = { a: 0, b: 0, c: 0 }, l = []; return t = function (t, e) { var n, r, o, i, a, u; if (t.test(s)) for (r = 0, o = (n = s.match(t)).length; r < o; r += 1)f[e] += 1, i = n[r], a = s.indexOf(i), u = i.length, l.push({ selector: c.substr(a, u), type: e, index: a, length: u }), s = s.replace(i, Array(u + 1).join(" ")) }, (e = function (t) { var e, n, r, o; if (t.test(s)) for (n = 0, r = (e = s.match(t)).length; n < r; n += 1)o = e[n], s = s.replace(o, Array(o.length + 1).join("A")) })(/\\[0-9A-Fa-f]{6}\s?/g), e(/\\[0-9A-Fa-f]{1,5}\s/g), e(/\\./g), (n = /:not\(([^\)]*)\)/g).test(s) && (s = s.replace(n, "     $1 ")), function () { var t, e, n, r, o = /{[^]*/gm; if (o.test(s)) for (e = 0, n = (t = s.match(o)).length; e < n; e += 1)r = t[e], s = s.replace(r, Array(r.length + 1).join(" ")) }(), t(/(\[[^\]]+\])/g, "b"), t(/(#[^\#\s\+>~\.\[:]+)/g, "a"), t(/(\.[^\s\+>~\.\[:]+)/g, "b"), t(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi, "c"), t(/(:[\w-]+\([^\)]*\))/gi, "b"), t(/(:[^\s\+>~\.\[:]+)/g, "b"), s = (s = s.replace(/[\*\s\+>~]/g, " ")).replace(/[#\.]/g, " "), t(/([^\s\+>~\.\[:]+)/g, "c"), l.sort(function (t, e) { return t.index - e.index }), { selector: c, specificity: "0," + f.a.toString() + "," + f.b.toString() + "," + f.c.toString(), specificityArray: [0, f.a, f.b, f.c], parts: l } }, { calculate: r, compare: function (t, e) { var n, r, o; if ("string" == typeof t) { if (-1 !== t.indexOf(",")) throw "Invalid CSS selector"; n = a(t).specificityArray } else { if (!Array.isArray(t)) throw "Invalid CSS selector or specificity array"; if (4 !== t.filter(function (t) { return "number" == typeof t }).length) throw "Invalid specificity array"; n = t } if ("string" == typeof e) { if (-1 !== e.indexOf(",")) throw "Invalid CSS selector"; r = a(e).specificityArray } else { if (!Array.isArray(e)) throw "Invalid CSS selector or specificity array"; if (4 !== e.filter(function (t) { return "number" == typeof t }).length) throw "Invalid specificity array"; r = e } for (o = 0; o < 4; o += 1) { if (n[o] < r[o]) return -1; if (n[o] > r[o]) return 1 } return 0 } }); void 0 !== n && (n.calculate = o.calculate, n.compare = o.compare) }, {}], 2: [function (t, e, n) { var r = t("specificity"); e.exports = { boltExport: r } }, { specificity: 1 }] }, {}, [2])(2) }); var Gd = Xd.exports.boltExport, zd = Le("selector", "raw"), Kd = function (e, t) { var n = q(t, function (i) { var t = jn(e, i.selector()); return R(t, function (t) { var n, r, o, e = (n = i.raw(), r = t, o = {}, R(n, function (t) { if (void 0 !== n[t]) { var e = r.dom().style; P(e, t) || (o[t] = n[t]) } }), o); Ra(t, e) }), t }); R(n, function (t) { ge(t, "class") }) }, Zd = function (t, e) { var n = function (t) { return -1 !== t.selector().indexOf(",") }, r = q(F(t, n), function (n) { var t = n.selector().split(","); return M(t, function (t) { var e = t.trim(); return zd(e, n.raw()) }) }), o = F(t, function (t) { return !n(t) }).concat(r); o.sort(function (t, e) { return Gd.compare(t.selector(), e.selector()) }).reverse(), Kd(e, o) }, Jd = function (t, e, r) { var n = Hd(t), o = $d(n).map(function (t) { var e = t.selector(), n = r.hasOwnProperty(e) ? r[e] : e; return zd(n, t.raw()) }); Zd(o, e) }, Qd = function (t, e, n) { var r = Hd(t), o = $d(r), i = F(o, function (t) { return tn(t.selector(), n) }); Zd(i, e) }, tm = { inlineStyles: function (t, e, n) { Jd(t, e, n) }, inlinePrefixedStyles: function (t, e, n) { Qd(t, e, n) } }, em = { p: "p, li[data-converted-paragraph]" }, nm = C, rm = function (f, t) { var l = function (n) { ge(n, "data-list-level"), ge(n, "data-text-indent-alt"), ge(n, "data-border-margin"), Ba(n, "margin-left"), Ba(n, "text-indent"), et(function (t) { var e = {}, n = t.dom(); if (Pa(n)) for (var r = 0; r < n.style.length; r++) { var o = n.style.item(r); e[o] = n.style[o] } return e }(n), function (t, e) { !e.startsWith("border") || "border-image" !== e && "none" !== t.trim() && "initial" !== t.trim() || Ba(n, e) }) }, e = jn(f, "li[data-converted-paragraph]"); if (R(e, function (t) { ge(t, "data-converted-paragraph") }), t) { var n = jn(f, "li"); R(n, function (t) { var e, n, r, o, i, a, u = (e = f, n = Se.fromTag("span"), An(e, n), r = n, { convertToPx: function (t) { var e; return Ma(r, "margin-left", t), e = Fa(r, "margin-left"), parseFloat(e.match(/-?\d+\.?\d*/)[0]) }, destroy: function () { return Oa(r) } }), c = (i = u, a = pe(o = f, "data-tab-interval") ? me(o, "data-tab-interval") : "36pt", i.convertToPx(a)), s = om(t, c, u).getOr({}); l(t), u.destroy(), Ra(t, s) }); var r = jn(f, "ol,ul"); R(r, function (e) { var t = jn(e, "li"); Ua(e, "margin-top").isNone() && D.from(t[0]).each(function (t) { Ma(e, "margin-top", Fa(t, "margin-top")) }), Ua(e, "margin-bottom").isNone() && D.from(t[t.length - 1]).each(function (t) { Ma(e, "margin-bottom", Fa(t, "margin-bottom")) }) }) } ge(f, "data-tab-interval") }, om = function (l, d, m) { var p = function (t) { return pe(t, "data-list-level") ? parseInt(me(t, "data-list-level"), 10) : 1 }; return Ua(l, "text-indent").bind(function (f) { return Ua(l, "margin-left").map(function (t) { var e = Ua(l, "list-style").exists(function (t) { return Je(t, "none") }), n = pe(l, "data-border-margin") ? me(l, "data-border-margin") : "0px", r = e ? p(l) + 1 : p(l), o = m.convertToPx(t) + m.convertToPx(n), i = d * r, a = pe(l, "data-text-indent-alt") ? m.convertToPx(me(l, "data-text-indent-alt")) : m.convertToPx(f), u = {}, c = d / 2 * -1 - a; 0 < c && (u["text-indent"] = c + "px"); var s = o - i - c; return u["margin-left"] = 0 < s ? s + "px" : "0px", u }) }) }, im = function (t, e, n) { var r = n.mergeInline(); (r ? tm.inlineStyles : nm)(t, e, em), rm(e, r) }, am = function (n) { var t, r = (t = Se.fromDom(y.document.body), { play: function (i, a, u) { var c = Se.fromTag("div"), s = Se.fromTag("iframe"); Ra(c, { display: "none" }); var f = Ud(s, "load", function () { f.unbind(), Yd(s, i); var t = s.dom().contentWindow.document; if (void 0 === t) throw "sandbox iframe load event did not fire correctly"; var e = Se.fromDom(t), n = t.body; if (void 0 === n) throw "sandbox iframe does not have a body"; var r = Se.fromDom(n), o = a(e, r); Oa(c), y.setTimeout(N(u, o), 0) }); _n(c, s), _n(t, c) } }); return function (t, e) { r.play(t, function (t, e) { return im(t, e, { mergeInline: v(n) }), Iu(e) }, e) } }, um = function (t, c, e, s) { var n = t.html(); return Sa.sync(function (i) { e.cleanDocument(n, c).get(function (t) { t.fold(function (t) { Sa.call(i, { response: Ta.error("errors.paste.process.failure"), bundle: ya.nu({}) }) }, function (t) { var e, n, a, u, r, o; null == (o = t) || 0 === o.length ? (r = i, Sa.call(r, { response: Ta.paste([], []), bundle: ya.nu({}) })) : (e = i, n = t, a = s, u = function (t) { Sa.call(e, { response: t, bundle: ya.nu({}) }) }, am(c)(n, function (t) { var e = Nn(t), n = function (t) { u(Ta.paste(e, t)) }, r = Se.fromTag("div"); Mn(r, e); var o = gn("img[src]", r); if (0 === o.length) n([]); else if (a) Hl.browserBlobs(o).get(n); else { R(o, Oa); var i = Sn(r); u(Ta.incomplete(i, [], "errors.local.images.disallowed")) } })) }) }) }) }, cm = function (t) { var e = F(t, function (t) { return "file" === t.kind && /image/.test(t.type) }), r = M(e, function (t) { return t.getAsFile() }); return Sa.sync(function (n) { pa.multiple(r).get(function (t) { var e = Hl.createImages(t); Sa.call(n, { response: e, bundle: ya.nu({}) }) }) }) }, sm = fn.detect(), fm = function (t) { try { var e = t(), n = null != e && 0 < e.length ? Nn(e) : []; return er.value(n) } catch (t) { return y.console.error(t), er.error("errors.paste.process.failure") } }, lm = function (t) { return t.fold(function (t) { return Sa.error(t) }, function (t) { return Sa.pure({ response: Ta.paste(t, []), bundle: ya.nu({}) }) }) }, dm = function (t, e, n, r) { return fm(function () { return $f(t, sm, e, n, r) }) }, mm = function (t, e, n) { var r = dm(t, e, n, !1); return lm(r) }, pm = function (t, e) { var n = fm(function () { return Xf(t, e) }); return lm(n) }, gm = function (t, e, n, r, o) { return dm(t, e, r, n).fold(function (t) { return Sa.error(t) }, function (r) { return Sa.sync(function (n) { o.get(function (t) { var e = Hl.findImages(r, t); Sa.call(n, { response: Ta.paste(r, e), bundle: ya.nu({}) }) }) }) }) }, vm = function (t, e, n) { var r = e.findClipboardTags(Sn(n)).getOr([]); R(r, Oa); var o = K.nu(function (t) { t([]) }); return gm(t, n, !1, !0, o) }, hm = function (t, e, n, r, o) { return gm(t, e, r, n, o) }, ym = function (t) { var e, n = Se.fromTag("div"); return e = t, n.dom().textContent = e, Iu(n) }, bm = function (t) { var e = t.trim().split(/\n{2,}|(?:\r\n){2,}/), n = M(e, function (t) { return t.split(/\n|\r\n/).join("<br />") }); return 1 === n.length ? n[0] : M(n, function (t) { return "<p>" + t + "</p>" }).join("") }, xm = function (t) { var a = el.asText(t).getOrDie("Required text input for Text Handler"); return Sa.sync(function (t) { var e, n, r, o, i = 0 < a.text().length ? (e = a.text(), n = ym(e), r = bm(n), o = Nn(r), Ta.paste(o, [])) : Ta.cancel(); Sa.call(t, { response: i, bundle: ya.nu({}) }) }) }, Tm = function (t, e, n) { return xm(t) }, Em = function (t, o) { var e = function (t, e) { var n = Se.fromTag("div"); Mn(n, t), Vf(n); var r = Sn(n); return Sa.pure({ response: Ta.paste(r, e), bundle: o.bundle() }) }, n = N(Sa.pass, o); return Ta.cata(o.response(), n, e, n, e) }, wm = function () { return function (t, e) { return Sa.error("errors.local.images.disallowed") } }, Im = function () { return function (t, e) { var n = el.asImages(t).getOrDie("Must have image data for images handler"); return cm(n.images()) } }, Sm = function (i) { return function (t, e) { var n = el.asHtml(t).getOrDie("Wrong input type for HTML handler"), r = i.findClipboardTags(Sn(n.container())); r.each(function (t) { R(t, Oa) }); var o = r.isSome(); return Sa.pure({ response: e.response(), bundle: ya.nu({ isInternal: o }) }) } }, Lm = function (a, u) { return function (t, e) { var n = el.asHtml(t).getOrDie("Wrong input type for HTML handler").container(), r = bn(u), o = e.bundle(); if (Ld.isInternal(o)) return pm(r, n); a(n); var i = Ld.merging(o); return mm(r, n, i) } }, Cm = function (u, c) { return function (t, e) { var a = e.bundle(); return Ld.proxyBin(a).handle("There was no proxy bin setup. Ensure you have run proxyStep first.", function (t) { var e = Ld.merging(a), n = Ld.isWord(a), r = Ld.isInternal(a), o = Ld.backgroundAssets(a), i = bn(u); return r ? vm(i, c, t) : hm(i, t, e, n, o) }) } }, Nm = function (o, i) { return function (t, e) { var n = el.asWord(t).getOrDie("Wrong input type for Word Import handler"), r = Ld.mergeOffice(e.bundle()); return um(n, r, o, i) } }, Dm = function (r) { return function (t, e) { var n = ya.merge(e.bundle(), ya.nu(r)); return Sa.pure({ response: e.response(), bundle: n }) } }, Om = function (t, e) { return Sa.cancel() }, Am = Cd.resolve("smartpaste-eph-bin"), _m = { binStyle: v(Am) }, Pm = function (t, e) { return zc(t, function (t) { return !!pe(t, "style") && -1 < me(t, "style").indexOf("mso-") }) }, km = function (t, e) { var n = Iu(t); return Ou(n, e) }, Mm = function (t, e) { var n = t.browser; return (n.isIE() && 11 <= n.version.major ? Pm : km)(e, t) }, Rm = fn.detect(); function Fm(r, f, o, l, i) { return function (t, e) { var n = el.asEvent(t).getOrDie("Must pass through event type").nativeEvent(), c = i(), s = e.response(); return Sa.sync(function (u) { var t = r(o); t.events.after.bind(function (t) { var e = t.container(); if (Rm.browser.isSafari() && fr(e, 'img[src^="webkit-fake-url"]').isSome()) { var n = Rm.deviceType.isWebView() ? "webview.imagepaste" : "safari.imagepaste"; Sa.call(u, { response: Ta.error(n), bundle: ya.nu({}) }) } else { f(e), Te(e, _m.binStyle()); var r = Mm(Rm, e), o = Sn(e), i = l.findClipboardTags(o).isSome(), a = k(o, function (t) { return pe(t, "id") && tn(me(t, "id"), "docs-internal-guid") }); Sa.call(u, { response: s, bundle: ya.nu({ isWord: r, isGoogleDocs: a, isInternal: i, proxyBin: e, backgroundAssets: c }) }) } }), c.convert(n), t.run() }) } } var jm = function (t, e) { return t.isSupported() ? e.getWordData() : D.none() }, Um = function (t) { return t.getNative() }, Bm = function (t) { return t.getImage() }, Ym = function (t) { return t.getHtml() }, Hm = function (t) { return t.getText() }, Wm = function (t) { return t.getOnlyText() }, qm = function (t) { return t.getGoogleDocsData() }, $m = function (t, e, n, r) { return { _label: t, label: v(t), getAvailable: e, steps: v(n), capture: v(r) } }, Vm = { wordimport: function (t, e, n, r) { return $m("Word Import pasting", N(jm, t), [Vl(Dm({ isWord: !0 })), Vl(Pd(e, n)), Vl(Nm(t, n.allowLocalImages)), $l((o = n, i = Ed(r, n), a = Td(o), u = Ic(D.none()), c = function (e) { u.get().each(function (t) { Sa.call(t, { response: e, bundle: ya.nu({}) }) }) }, a.events.insert.bind(function (t) { c(Ta.paste(t.elements(), t.correlated())) }), a.events.incomplete.bind(function (t) { c(Ta.incomplete(t.elements(), t.correlated(), t.message())) }), function (e, r) { var t = el.asWord(e).getOrDie("Word input required for rtf data"), n = function (o) { return Sa.sync(function (e) { var t = function () { Sa.call(e, { response: r.response(), bundle: r.bundle() }) }, n = function (t, n) { u.set(D.some(e)); var r = Se.fromTag("div"); Mn(r, t), o.fold(function () { var t, e = xd.find(r); return 0 < e.length ? function () { R(e, Oa); var t = Sn(r); c(Ta.incomplete(t, n, "errors.local.images.disallowed")) }() : (t = Sn(r), void c(Ta.paste(t, n))) }, function (t) { a.processRtf(r, n, t, C) }) }; Ta.cata(r.response(), t, n, t, n) }) }; return Jf.match(t.rtf(), { getFromFlash: function (t) { return i(e, r) }, disabled: function () { return n(D.none()) }, fromClipboard: function (t) { return n(!0 === o.allowLocalImages ? D.some(t.rtf()) : D.none()) } }) })), Vl(ql())], !0); var o, i, a, u, c }, googledocs: function (t, e, n) { return $m(" pasting", qm, [Vl(Dm({ officeStyles: !1, htmlStyles: !1 })), Vl(Lm(e, n)), Vl(td(t)), Vl(ql())], !0) }, image: function (t) { return $m("Image pasting", Bm, [Vl(!1 === t.allowLocalImages ? wm() : Im()), Vl(ql())], !0) }, nativeHtml: function (t, e, n, r) { return $m("Outside of Textbox.io pasting HTML5 API (could be internal)", Ym, [Vl(Sm(e.intraFlag)), Vl(kd(t, e)), Vl(Lm(n, r)), Vl(td(e)), Vl(ql())], !0) }, text: function () { return $m("Plain text pasting", Hm, [Vl(Tm), Vl(Em)], !0) }, onlyText: function () { return $m("Only plain text is available to paste", Wm, [Vl(Tm), Vl(Em)], !0) }, none: function () { return $m("There is no valid way to paste", D.some, [Vl(Om)], !1) }, fallback: function (t, e, n, r, o, i) { return $m("Outside of Textbox.io pasting offscreen (could be internal)", Um, [Vl(Fm(r, n, o, e.intraFlag, Gl)), Vl(kd(t, e)), Vl(Cm(o, e.intraFlag)), $l(Ed(i, e)), Vl(td(e)), Vl(ql())], !1) } }, Xm = function (u) { var c = N(Tt, u); Tt("callbacks", c()); var e = function (t, e) { var n, r, o, i = c(), a = (r = void 0 === (n = i).count ? 0 : n.count, o = "callback_" + r, n.count = r + 1, o); return i.callbacks[a] = function () { e || s(a), t.apply(null, arguments) }, u + ".callbacks." + a }, s = function (t) { var e = t.substring(t.lastIndexOf(".") + 1), n = c(); void 0 !== n.callbacks[e] && delete n.callbacks[e] }; return { ephemeral: function (t) { return e(t, !1) }, permanent: function (t) { return e(t, !0) }, unregister: s } }, Gm = function (t) { t.dom().focus() }, zm = { responsive: function () { var a = Ic(D.none()), u = Gn.create({ crashed: Xn([]), timeout: Xn([]) }); return { start: function (t, e, n, r) { var o = e, i = y.setInterval(function () { n() ? y.clearInterval(i) : o <= 0 ? (u.trigger.timeout(), y.clearInterval(i)) : r() && (y.clearInterval(i), u.trigger.crashed()), o-- }, t); a.set(D.some(i)) }, stop: function () { a.get().each(function (t) { y.clearInterval(t) }) }, events: u.registry } } }; function Km(n, r, o) { var t = !0, e = y.setInterval(function () { var e, t = n.dom(); O(t.PercentLoaded) && 100 === t.PercentLoaded() && (e = t, $(r, function (t) { return O(e[t]) })) && (i(), o()) }, 500), i = function () { t && (y.clearInterval(e), t = !1) }; return { stop: i } } var Zm = Xm("ephox.flash"), Jm = fn.detect(), Qm = D.none(), tp = function (t) { return Se.fromHtml("<p>" + t("cement.dialog.flash.press-escape") + "</p>") }, ep = function (t) { var e = Se.fromTag("div"); Te(e, Cd.resolve("flashbin-helpcopy")); var n = fn.detect().os.isOSX() ? ["\u2318"] : ["Ctrl"], r = Se.fromHtml("<p>" + t("cement.dialog.flash.trigger-paste") + "</p>"), o = Se.fromHtml('<div><span class="ephox-polish-help-kbd">' + n + '</span> + <span class="ephox-polish-help-kbd">V</span></div>'); return Te(o, Cd.resolve("flashbin-helpcopy-kbd")), Mn(e, [r, o, tp(t)]), e }, np = function (t) { var e = Se.fromTag("div"); Te(e, Cd.resolve("flashbin-helpcopy")); var n = Se.fromHtml("<p>" + t("cement.dialog.flash.missing") + "</p>"); return Mn(e, [n, tp(t)]), e }, rp = function (t) { var e = Se.fromTag("div"); Te(e, Cd.resolve("flashbin-loading")); var n = Se.fromTag("div"); Te(n, Cd.resolve("flashbin-loading-spinner")); var r = Se.fromTag("p"), o = t("loading.wait"); return Su(r, o), le(r, "aria-label", o), Mn(e, [n, r]), e }, op = fn.detect(), ip = function () { try { return void 0 !== y.navigator.plugins["Shockwave Flash"] } catch (t) { return !1 } }, ap = function (t, e, n, r) { var o = np(r); return _n(t, o), { reset: C } }, up = function (t, e, n, r) { var o = ep(r), i = rp(r); Mn(t, [i, o, e.element()]); var a = function () { Ma(o, "display", "block"), Ma(i, "display", "none"), n() }; return e.events.spin.bind(function () { Ma(o, "display", "none"), Ma(i, "display", "block"), Ba(i, "height"), Ba(i, "padding"), n() }), e.events.reset.bind(a), e.events.hide.bind(function () { Ra(i, { height: "0", padding: "0" }) }), { reset: a } }; function cp(c, s) { var f = s.translations, l = Gn.create({ response: Xn(["rtf", "hide"]), cancel: Xn([]), error: Xn(["message"]), failed: Xn(["message"]) }); return { open: function () { var t = function (r) { var e = Gn.create({ response: Xn(["rtf"]), spin: Xn([]), cancel: Xn([]), error: Xn(["message"]), reset: Xn([]), hide: Xn([]), failed: Xn(["message"]) }), t = !1, n = Se.fromTag("div"); Te(n, Cd.resolve("flashbin-target")); var o = zm.responsive(); o.events.crashed.bind(function () { e.trigger.failed("flash.crashed") }), o.events.timeout.bind(function () { e.trigger.failed("flash.crashed") }); var i = function () { if (d.stop(), !t) { t = !0; try { var r = f.dom(); et(s, function (t, e) { var n = r[e]; if (void 0 === n) throw 'Flash object does not have the method "' + e + '"'; n.call(r, t) }), e.trigger.reset(), v(), m() } catch (t) { y.console.log("Flash dialog - Error during load: ", t) } } }, a = Zm.permanent(i), u = function () { return !Rn(f) }, c = function () { return !f.dom().SetVariable }, s = { setSpinCallback: Zm.permanent(function () { o.start(1e3, 10, u, c), e.trigger.spin() }), setPasteCallback: Zm.permanent(function (t) { o.stop(), y.setTimeout(function () { "" === t ? e.trigger.error("flash.crashed") : e.trigger.response(unescape(t)) }, 0) }), setEscapeCallback: Zm.permanent(e.trigger.cancel), setErrorCallback: Zm.permanent(function (t) { o.stop(), e.trigger.error(t) }), setStartPasteCallback: Zm.permanent(C) }, f = function () { var t = r.replace(/^https?:\/\//, "//"), e = '    <param name="allowscriptaccess" value="always">    <param name="wmode" value="opaque">    <param name="FlashVars" value="onLoad=' + a + '">'; if (Jm.browser.isIE() && 10 === Jm.browser.version.major) { var n = ia("flash-bin"); return Se.fromHtml('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="' + n + '"><param name="movie" value="' + t + '">' + e + "</object>") } return Se.fromHtml('<object type="application/x-shockwave-flash" data="' + t + '">' + e + "</object>") }(), l = function () { Ra(f, { width: "2px", height: "2px" }) }; l(); var d = Km(f, tt(s), i); _n(n, f); var m = function () { Jm.browser.isFirefox() && y.window.getSelection().removeAllRanges(), Gm(f) }, p = null, g = function () { Te(n, Cd.resolve("flash-activate")), Ba(f, "height"), Ba(f, "width"), e.trigger.hide() }, v = function () { y.clearTimeout(p), Ee(n, Cd.resolve("flash-activate")), l() }, h = function () { Ma(n, "display", "none"), Qm.each(function (t) { R(t, function (t) { t.unbind() }) }) }; return { focus: m, element: function () { return n }, activate: function () { p = y.setTimeout(g, 3e3), e.trigger.spin(), Ma(n, "display", "block"), m() }, deactivate: h, destroy: function () { h(), R(ot(s), function (t) { Zm.unregister(t) }), Zm.unregister(a), d.stop() }, events: e.registry } }(s.swf); t.deactivate(); var e = Se.fromDom(y.window), n = Ud(e, "mouseup", t.focus), r = function () { u() }, o = function () { r(), l.trigger.cancel() }; t.events.cancel.bind(o), t.events.response.bind(function (t) { l.trigger.response(t.rtf(), r) }), t.events.error.bind(function (t) { r(), l.trigger.error(t.message()) }), t.events.failed.bind(function (t) { r(), l.trigger.failed(t.message()) }); var i = c(); i.setTitle(f("cement.dialog.flash.title")); var a = function (t, e, n) { var r = Se.fromTag("div"), o = "flashbin-wrapper-" + (op.os.isOSX() ? "cmd" : "ctrl"); Te(r, Cd.resolve(o)); var i = (ip() ? up : ap)(r, t, e, n.translations); return { element: v(r), reset: i.reset } }(t, i.reflow, s); a.reset(), i.setContent(a.element()), i.events.close.bind(o), i.show(), t.activate(); var u = function () { n.unbind(), t.destroy(), i.destroy() } }, events: l.registry } } function sp() { var o = {}; return { getOrSetIndexed: function (t, e) { return void 0 !== o[t] ? o[t] : (n = t, r = e(), o[n] = r); var n, r }, waitForLoad: function () { var t = ot(o); return J(t) } } } var fp, lp, dp = Xm("ephox.henchman.features"), mp = function (i) { return G.nu(function (e) { var t = function () { r.unbind(), o.unbind() }, n = Se.fromTag("script"); le(n, "src", i), le(n, "type", "text/javascript"), le(n, "async", "async"), le(n, "data-main", dp.ephemeral(function (t) { e(er.value(t)) })); var r = Ud(n, "error", function () { t(), e(er.error("Error loading external script tag " + i)) }), o = Ud(n, "load", t); _n(Se.fromDom(y.document.head), n) }) }, pp = function (t, e) { var n, r, o, i = e || Se.fromDom(y.document), a = Se.fromTag("link", i.dom()); return de(a, { rel: "stylesheet", type: "text/css", href: t }), n = i, r = a, o = Se.fromDom(n.dom().head), _n(o, r), a }, gp = function (o, i) { return G.nu(function (e) { var n = function (t) { R(r, function (t) { t.unbind() }), e(t.fold(function (t) { return er.error(t + 'Unable to download editor stylesheets from "' + o + '"') }, er.value)) }, t = pp(o), r = [Ud(t, "load", function (t) { !function (t) { try { var e = t.target().dom().sheet.cssRules; return I(e) && 0 === e.length } catch (t) { } return !1 }(t) ? i(n) : n(er.error("")) }), Ud(t, "error", N(n, er.error("")))] }) }, vp = (fp = sp(), { preload: function () { lp().get(l) }, addStylesheet: function (t, e) { return fp.getOrSetIndexed(t, function () { return gp(t, e) }) }, addScript: function (t, e) { return fp.getOrSetIndexed(t, function () { return mp(t).map(e) }) }, waitForLoad: lp = function () { return fp.waitForLoad() } }), hp = function (t, e) { return vp.addScript(t, e) }, yp = fn.detect(), bp = yp.deviceType.isiOS() || yp.deviceType.isAndroid(), xp = v({ isSupported: v(!1), cleanDocument: v(Fr("not supported")) }), Tp = bp ? xp : function (t) { var r = hp(t + "/wordimport.js", l); return r.get(function (t) { t.fold(function (t) { y.console.error("Unable to load word import: ", t) }, C) }), { isSupported: v(!0), cleanDocument: function (e, n) { return r.map(function (t) { return t.map(function (t) { return t.cleanDocument(e, n) }) }) } } }; function Ep(t, e, n, r) { var o = hn(t, n) && e === r; return { startContainer: v(t), startOffset: v(e), endContainer: v(n), endOffset: v(r), collapsed: v(o) } } var wp, Ip, Sp = ["b", "i", "u", "sub", "sup", "strike"], Lp = function (t) { R(Sn(t), function (t) { var e; ce(e = t) && !e.dom().hasChildNodes() && P(Sp, oe(e)) && Oa(t) }) }, Cp = function (t, o) { var e = Sn(t); R(e, function (t) { var e, n, r; o(t) && (n = Sn(e = t), r = Se.fromTag("div", bn(e).dom()), Mn(r, n), Dn(e, r), Oa(e)) }) }, Np = { consolidate: function (n, t) { wn(n).filter(t).each(function (t) { var e = Sn(t); Mn(n, e), Oa(t) }), Cp(n, t), Lp(n) } }, Dp = function (t) { return "rtl" === Fa(t, "direction") ? "rtl" : "ltr" }, Op = yl.bin(), Ap = Op + ia(""), _p = (wp = "-100000px", Ip = "100000px", function (t) { return "rtl" === Dp(t) ? Ip : wp }); function Pp(e, t, n) { var r = function (e, t) { var n = Se.fromTag("div"); de(n, t), de(n, { contenteditable: "true", "aria-hidden": "true" }), Ra(n, { position: "fixed", top: "0px", width: "100px", height: "100px", overflow: "hidden", opacity: "0" }), nr(n, [Op, Ap]); var r = function (t) { return we(t, Ap) }; return { attach: function (t) { Da(n), Ma(n, "left", _p(t)), _n(t, n) }, focus: function () { sr(n, "body").each(function (t) { e.toOff(t, n) }) }, contents: function () { return Np.consolidate(n, r), Le("elements", "html", "container")(Sn(n), Iu(n), n) }, container: function () { return n }, detach: function () { Oa(n) } } }(e, n), o = function () { e.cleanup(); var t = r.contents(); r.detach(), a.trigger.after(t.elements(), t.html(), r.container()) }, i = vl.tap(function () { a.trigger.before(), r.attach(t), r.focus(), El.run(bn(t), i, o) }), a = Gn.create({ before: Xn([]), after: Xn(["elements", "html", "container"]) }), u = C; return { instance: v(function () { i.instance() }), destroy: u, events: a.registry } } var kp = function (t) { return { startContainer: t.start, startOffset: t.soffset, endContainer: t.finish, endOffset: t.foffset } }, Mp = { set: function (t, e) { Ml(t, e.startContainer(), e.startOffset(), e.endContainer(), e.endOffset()) }, get: function (t, e) { return Fl(t).map(kp) } }; function Rp(a) { return function (e) { var u, r, o, c, n = Gn.create({ after: Xn(["container"]) }), i = (u = Mp, r = Se.fromTag("br"), o = D.none(), c = function (t) { return bn(t).dom().defaultView }, { cleanup: function () { Oa(r) }, toOn: function (i, t) { var a = c(t); o.each(function (t) { var e = Cn(i), n = hn(i, t.startContainer()) && e < t.startOffset() ? e : t.startOffset, r = hn(i, t.endContainer()) && e < t.endOffset() ? e : t.endOffset, o = Ep(t.startContainer(), n, t.endContainer(), r); u.set(a, o) }) }, toOff: function (t, e) { var n = c(e); _n(e, r), o = u.get(n, Ep), u.set(n, Ep(r, 0, r, 0)) } }), t = Pp(i, e, a); return t.events.after.bind(function (t) { i.toOn(e, t.container()), n.trigger.after(t.container()) }), { run: function () { t.instance()() }, events: n.registry } } } var Fp = "powerpaste-styles", jp = "#" + Fp, Up = { injectStyles: function (t) { if (!Uf(jp)) { var e = "<style>.ephox-cement-flashbin-helpcopy-kbd {font-size: 3em !important; text-align: center !important; vertical-align: middle !important; margin: .5em 0} .ephox-cement-flashbin-helpcopy-kbd .ephox-polish-help-kbd {font-size: 3em !important; vertical-align: middle !important;} .ephox-cement-flashbin-helpcopy a {text-decoration: underline} .ephox-cement-flashbin-loading-spinner {background-image: url(" + t + ") !important; width: 96px !important; height:96px !important; display: block; margin-left: auto !important; margin-right: auto !important; margin-top: 2em !important; margin-bottom: 2em !important;} .ephox-cement-flashbin-loading p {text-align: center !important; margin: 2em 0 !important} .ephox-cement-flashbin-target {height: 1px !important;} .ephox-cement-flashbin-target.ephox-cement-flash-activate {height: 150px !important; width: 100% !important;} .ephox-cement-flashbin-target object {height: 1px !important;} .ephox-cement-flashbin-target.ephox-cement-flash-activate object {height: 150px !important; width: 100% !important;} .ephox-cement-flashbin-helpcopy p {white-space: normal;}</style>", n = Se.fromHtml(e); le(n, "type", "text/css"), le(n, "id", Fp); var r = cr("head").getOrDie("Head element could not be found."); _n(r, n) } }, removeStyles: function () { if (Uf(jp)) { var t = cr("head").getOrDie("Head element could not be found."), e = fr(t, jp).getOrDie("The style element could not be removed"); Oa(e) } } }, Bp = "x-tinymce/html", Yp = "\x3c!-- " + Bp + " --\x3e", Hp = { mark: function (t) { return Yp + t }, unmark: function (t) { return t.replace(Yp, "") }, isMarked: function (t) { return -1 !== t.indexOf(Yp) }, retainContentEditable: function (t) { return t.replace(/ contenteditable="([^"]+)"/g, ' data-mce-contenteditable="$1"') }, restoreContentEditable: function (t) { return t.replace(/ data-mce-contenteditable="([^"]+)"/g, ' contenteditable="$1"') }, internalHtmlMime: v(Bp) }, Wp = function () { }, qp = function (t, e, n) { if (r = t, !1 !== tinymce.Env.iOS || void 0 === r || "function" != typeof r.setData) return !1; try { return t.clearData(), t.setData("text/html", e), t.setData("text/plain", n), t.setData(Hp.internalHtmlMime(), e), !0 } catch (t) { return !1 } var r }, $p = function (t, e, n, r) { qp(t.clipboardData, e.html, e.text) ? (t.preventDefault(), r()) : n(e.html, r) }, Vp = function (a) { return function (t, e) { var n = a.dom.create("div", { contenteditable: "false", "data-mce-bogus": "all" }), r = a.dom.create("div", { contenteditable: "true", "data-mce-bogus": "all" }, t); a.dom.setStyles(n, { position: "fixed", top: "50%", left: "-3000px", width: "1000px", overflow: "hidden" }), n.appendChild(r), a.dom.add(a.getBody(), n); var o = a.selection.getRng(); r.focus(); var i = a.dom.createRng(); i.selectNodeContents(r), a.selection.setRng(i), setTimeout(function () { a.selection.setRng(o), n.parentNode.removeChild(n), e() }, 0) } }, Xp = function (t) { var e = Hp.retainContentEditable(t.selection.getContent({ contextual: !0 })); return { html: Hp.mark(e), text: t.selection.getContent({ format: "text" }) } }, Gp = { register: function (t) { var e, n; t.on("cut", (e = t, function (t) { !1 === e.selection.isCollapsed() && $p(t, Xp(e), Vp(e), function () { setTimeout(function () { e.execCommand("Delete") }, 0) }) })), t.on("copy", (n = t, function (t) { !1 === n.selection.isCollapsed() && $p(t, Xp(n), Vp(n), Wp) })) } }, zp = { nodeToString: function (t) { var e = document.createElement("div"); e.appendChild(t.cloneNode(!0)); var n = e.innerHTML; return e = t = null, n }, restoreStyleAttrs: function (t) { R(M(t.getElementsByTagName("*"), Se.fromDom), function (t) { pe(t, "data-mce-style") && !pe(t, "style") && le(t, "style", me(t, "data-mce-style")) }) } }, Kp = { init: function () { var r = Ic([{ text: "Close", name: "close", type: "custom", ariaLabel: "Close" }]), o = Ic({}); return { setButtons: function (t) { var n = {}, e = M(t, function (t) { var e = t.text; return n[e.toLowerCase()] = t.click, { text: e, name: e.toLowerCase(), type: "custom", ariaLabel: e } }); o.set(n), r.set(e) }, getButtons: r.get, getAction: function (t) { var e = o.get(); return e.hasOwnProperty(t) ? D.some(e[t]) : D.none() } } } }, Zp = Le("url", "html"), Jp = function (t) { return /^https?:\/\/[\w\?\-\/+=.&%@~#]+$/i.test(t) }, Qp = Jp, tg = function (t) { return Jp(t) && /.(gif|jpe?g|png)$/.test(t) }, eg = function (n) { var t = /^<a href="([^"]+)">([^<]+)<\/a>$/.exec(n); return D.from(t).bind(function (t) { var e = Zp(t[1], n); return t[1] === t[2] ? D.some(e) : D.none() }) }, ng = function (t, e, n) { return "extra" in t.undoManager ? (t.undoManager.extra(function () { rg(t, e) }, n), D.some(!0)) : D.none() }, rg = function (t, e) { return t.insertContent(e, { merge: !1 !== t.settings.paste_merge_formats, paste: !0 }), D.some(!0) }, og = { until: function (e, n, t) { return La(t, function (t) { return t(e, n) }) }, linkSelection: function (r, t) { return eg(t).bind(function (t) { var e, n; return !1 === r.selection.isCollapsed() && Qp(t.url()) ? ng(e = r, (n = t).html(), function () { e.execCommand("mceInsertLink", !1, n.url()) }) : D.none() }) }, insertImage: function (r, t) { return eg(t).bind(function (t) { return tg(t.url()) ? ng(e = r, (n = t).html(), function () { e.insertContent('<img src="' + n.url() + '">') }) : D.none(); var e, n }) }, insertContent: rg }, ig = function (t, e) { return t.hasEventListeners(e) }, ag = function (t) { return t.plugins.powerpaste }, ug = { process: function (t, e, n) { var r, o, i, a, u, c, s, f, l, d, m, p, g, v = Hp.unmark(e); return d = v, m = n, o = ig(l = r = t, "PastePreProcess") ? (p = d, g = m, l.fire("PastePreProcess", { internal: g, content: p }).content) : d, i = n, ig(r, "PastePostProcess") ? (u = o, c = i, s = (a = r).dom.add(a.getBody(), "div", { style: "display:none" }, u), f = a.fire("PastePostProcess", { internal: c, node: s }).node.innerHTML, a.dom.remove(s), f) : o }, registerEvents: function (e) { var n = e.settings; n.paste_preprocess && e.on("PastePreProcess", function (t) { n.paste_preprocess.call(e, ag(e), t) }), n.paste_postprocess && e.on("PastePostProcess", function (t) { n.paste_postprocess.call(e, ag(e), t) }) } }; function cg(v, h, t, e, y, b) { var x, T, E, w, I = Ic(D.none()), n = function (t, e) { return t.replace(/\/$/, "") + "/" + e.replace(/^\//, "") }; w = n(e ? e.jsUrl : t, "/js"), T = n(e ? e.swfUrl : t, "/flash/textboxpaste.swf"), E = n(e ? e.imgUrl : t, "/img/spinner_96.gif"); var S = function (t, e, n) { var r, o = !1 !== t.settings.smart_paste ? [og.linkSelection, og.insertImage] : []; og.until(t, e, o.concat([(r = n, function (t, e) { return t.undoManager.transact(function () { og.insertContent(t, e), zp.restoreStyleAttrs(t.getBody()), y.prepareImages(r) }), D.some(!0) })])) }, L = function () { x && v.selection.moveToBookmark(x), x = null }; v.on("init", function (t) { Up.injectStyles(E); var s, a, e, n, r, o, i, u, c, f = { baseUrl: w, swf: T, officeStyles: v.settings.powerpaste_word_import || yo.officeStyles, htmlStyles: v.settings.powerpaste_html_import || yo.htmlStyles, translations: qt.translate, allowLocalImages: !1 !== v.settings.powerpaste_allow_local_images, enableFlashImport: !1 !== v.settings.powerpaste_enable_flash_import, pasteBinAttrs: { "data-mce-bogus": "all" }, intraFlag: { clipboardType: Hp.internalHtmlMime, findClipboardTags: function (t) { var e = F(t, function (t) { return ue(t) && Je(ps(t), Hp.internalHtmlMime()) }); return e.length ? D.some(e) : D.none() } }, preprocessor: function (t) { return K.pure(t) } }, l = b ? (a = v, { createDialog: function () { var n = "", r = null, o = Kp.init(), e = Gn.create({ close: Xn([]) }), i = function (t) { e.trigger.close() }; return { events: e.registry, setTitle: function (t) { return n = t }, setContent: function (t) { return r = t }, setButtons: function (t) { o.setButtons(t) }, show: function () { var t = zp.nodeToString(r.dom()), e = { title: n, body: { type: "panel", items: [{ type: "htmlpanel", name: "contentPanel", html: t }] }, initialData: {}, buttons: o.getButtons(), onCancel: i, onAction: function (e, t) { o.getAction(t.name).each(function (t) { return t(e) }), e.close() } }; a.windowManager.open(e) }, destroy: C, reflow: function () { } } } }) : (s = v, { createDialog: function () { var r, o = "", i = "", a = [], u = null, e = Gn.create({ close: Xn([]) }), c = function (t) { e.trigger.close() }, t = function () { r.off("close", c), r.close("close") }; return { events: e.registry, setTitle: function (t) { o = t }, setContent: function (t) { var e = zp.nodeToString(t.dom()); i = [{ type: "container", html: e }], u = t }, setButtons: function (t) { var r = []; t.forEach(function (t, e, n) { r.push({ text: t.text, ariaLabel: t.text, onclick: t.click }) }), a = r }, show: function () { 0 === a.length && (a = [{ text: "Close", onclick: function () { r.close() } }]); var t = { title: o, spacing: 10, padding: 10, minWidth: 300, minHeight: 100, layout: "flex", items: i, buttons: a }; r = s.windowManager.open(t); var e = Se.fromDom(r.getEl()), n = fr(e, "." + me(u, "class")).getOrDie("We must find this element or we cannot continue"); Dn(n, u), Oa(n), r.on("close", c) }, hide: function () { t() }, destroy: function () { t() }, reflow: function () { } } } }), d = Se.fromDom(v.getBody()), m = (e = d, n = l.createDialog, r = C, i = Tp((o = f).baseUrl), u = N(cp, n), c = Rp(void 0 !== o.pasteBinAttrs ? o.pasteBinAttrs : {}), Ul([Vm.onlyText(), Vm.wordimport(i, n, o, u), Vm.googledocs(o, r, e), Vm.nativeHtml(n, o, r, e), Vm.image(o)], Vm.fallback(n, o, r, c, e, u))), p = Ul([Vm.text()], Vm.none()); R([m, p], function (t) { t.events.cancel.bind(function () { L() }), t.events.error.bind(function (t) { L(), v.notificationManager ? v.notificationManager.open({ text: qt.translate(t.message()), type: "error" }) : $t.showDialog(v, qt.translate(t.message())) }), t.events.insert.bind(function (t) { var e = M(t.elements(), function (t) { return zp.nodeToString(t.dom()) }).join(""), n = Hp.restoreContentEditable(e); v.focus(), y.importImages(t.assets()).get(function () { L(), S(v, ug.process(v, n, t.isInternal()), t.assets()), y.uploadImages(t.assets()) }) }) }), v.addCommand("mceInsertClipboardContent", function (t, e) { void 0 !== e.content ? m.pasteCustom(ml.fromHtml(e.content)) : void 0 !== e.text && p.pasteCustom(ml.fromText(e.text)) }); var g = Ud(d, "paste", function (t) { x || (x = v.selection.getBookmark(1)), (h.isText() ? p : m).paste(t.raw()), h.reset() }); I.set(D.some(g)), Gp.register(v) }), v.on("remove", function (t) { 1 === tinymce.editors.length && Up.removeStyles(), I.get().each(function (t) { return t.unbind() }) }) } var sg = function (t) { return tinymce.util.VK.metaKeyPressed(t) && 86 === t.keyCode && t.shiftKey }, fg = function (r, o) { return function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; var n = r.console; n && o in n && n[o].apply(n, arguments) } }, lg = { log: fg(window, "log"), error: fg(window, "error"), warn: fg(window, "warm") }, dg = function (t, e) { t.dom.bind(e, "drop dragstart dragend dragover dragenter dragleave dragdrop draggesture", function (t) { t.preventDefault(), t.stopImmediatePropagation() }) }, mg = function (e) { e.on("init", function (t) { dg(e, e.getBody()), e.inline || dg(e, e.getDoc()) }) }; function pg(u) { return c(tinymce, "4.0.28") ? (lg.error('The "powerpaste" plugin requires at least 4.0.28 version of TinyMCE.'), function () { }) : function (n, t) { var e, r = !c(tinymce, "5.0.0"), o = function (n, r) { var o = Ic(n.settings.paste_as_text), e = Ic(!1); n.on("keydown", function (t) { sg(t) && (e.set(!0), tinymce.Env.ie && tinymce.Env.ie < 10 && (t.preventDefault(), n.fire("paste", {}))) }); var i = Ht(function () { var t = n.translate("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off."); n.notificationManager.open({ text: t, type: "info" }) }); return { toggle: function (t) { var e = !o.get(); r ? t.setActive(e) : this.active(e), o.set(e), n.fire("PastePlainTextToggle", { state: e }), !0 === e && !1 !== n.settings.paste_plaintext_inform && i(), n.focus() }, reset: function () { e.set(!1) }, isText: function () { return e.get() || o.get() } } }(n, r), i = function (e) { e.setActive(o.isText()); var t = function (t) { e.setActive(t.state) }; return n.on("PastePlainTextToggle", t), function () { return n.off("PastePlainTextToggle", t) } }, a = function () { var e = this; e.active(o.isText()), n.on("PastePlainTextToggle", function (t) { e.active(t.state) }) }; tinymce.Env.ie && tinymce.Env.ie < 10 ? function (e, t, n) { var r, o, i = this, a = ta(e, qt.translate), u = function (e) { return function (t) { e(t) } }; r = vo.getOnPasteFunction(e, a.showDialog, t), e.on("paste", u(r)), o = vo.getOnKeyDownFunction(e, a.showDialog, t), e.on("keydown", u(o)), e.addCommand("mceInsertClipboardContent", function (t, e) { a.showDialog(e.content || e) }), e.settings.paste_preprocess && e.on("PastePreProcess", function (t) { e.settings.paste_preprocess.call(i, i, t) }) }(n, o) : (e = fo(n), cg(n, o, t, u, e, r), ao(n) ? mg(n) : ga(n, 0, 0, e)), ug.registerEvents(n), r ? (n.ui.registry.addToggleButton("pastetext", { icon: "paste-text", tooltip: "Paste as text", onAction: o.toggle, onSetup: i }), n.ui.registry.addToggleMenuItem("pastetext", { icon: "paste-text", text: "Paste as text", selectable: !0, onAction: o.toggle, onSetup: i })) : (n.addButton("pastetext", { icon: "pastetext", tooltip: "Paste as text", onclick: o.toggle, onPostRender: a }), n.addMenuItem("pastetext", { text: "Paste as text", selectable: !0, onclick: o.toggle, onPostRender: a })) } } return function (t) { tinymce.PluginManager.requireLangPack("powerpaste", "ar,ca,cs,da,de,el,es,fa,fi,fr_FR,he_IL,hr,hu_HU,it,ja,kk,ko_KR,nb_NO,nl,pl,pt_BR,pt_PT,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,zh_CN,zh_TW"), tinymce.PluginManager.add("powerpaste", pg(t)) } }(window)();